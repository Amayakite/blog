import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as l,a as n,b as s,d as t,e}from"./app-2d4b26c1.js";const i="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121214051416.png",u="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121223317742.png",r="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121223234108.png",d="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121223249009.png",k="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121223259316.png",m="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121223342782.png",v="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121223410580.png",b="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121230119402.png",g="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121230137950.png",h="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121230153955.png",S="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121230303156.png",f="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121230319911.png",y="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121230429840.png",x="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121233439308.png",w="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/sso-type3-client-index.png",q="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/sso-type3-slo-index.png",_="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121234154695.png",R="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121234818516.png",C="/images/SpringCloud/17-1-Sa-Tokenå•ç‚¹è®¤è¯/image-20220121235128539.png",O={},T=e('<h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°" aria-hidden="true">#</a> æ¦‚è¿°</h2><p>å‡¡æ˜¯ç¨å¾®ä¸Šç‚¹è§„æ¨¡çš„ç³»ç»Ÿï¼Œç»Ÿä¸€è®¤è¯ä¸­å¿ƒéƒ½æ˜¯ç»•ä¸è¿‡å»çš„æ§›ã€‚è€Œå•ç‚¹ç™»å½•â€”â€”ä¾¿æ˜¯æˆ‘ä»¬æ­å»ºç»Ÿä¸€è®¤è¯ä¸­å¿ƒçš„å…³é”®ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯å•ç‚¹ç™»é™†ï¼Œå®ƒèƒ½è§£å†³å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸¾ä¸ªåœºæ™¯ï¼Œå‡è®¾æˆ‘ä»¬çš„ç³»ç»Ÿè¢«åˆ‡å‰²ä¸ºNä¸ªéƒ¨åˆ†ï¼šå•†åŸã€è®ºå›ã€ç›´æ’­ã€ç¤¾äº¤â€¦â€¦ å¦‚æœç”¨æˆ·æ¯è®¿é—®ä¸€ä¸ªæ¨¡å—éƒ½è¦ç™»å½•ä¸€æ¬¡ï¼Œé‚£ä¹ˆç”¨æˆ·å°†ä¼šç–¯æ‰ï¼Œ ä¸ºäº†ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬æ€¥éœ€ä¸€å¥—æœºåˆ¶å°†è¿™Nä¸ªç³»ç»Ÿçš„è®¤è¯æˆæƒäº’é€šå…±äº«ï¼Œè®©ç”¨æˆ·åœ¨ä¸€ä¸ªç³»ç»Ÿç™»å½•ä¹‹åï¼Œä¾¿å¯ä»¥ç•…é€šæ— é˜»çš„è®¿é—®å…¶å®ƒæ‰€æœ‰ç³»ç»Ÿã€‚</p><p>å•ç‚¹ç™»å½•â€”â€”å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿï¼</p><p>ç®€è€Œè¨€ä¹‹ï¼Œå•ç‚¹ç™»å½•å¯ä»¥åšåˆ°ï¼š<strong><code>åœ¨å¤šä¸ªäº’ç›¸ä¿¡ä»»çš„ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åªéœ€ç™»å½•ä¸€æ¬¡ï¼Œå°±å¯ä»¥è®¿é—®æ‰€æœ‰ç³»ç»Ÿã€‚</code></strong></p><p>å¯¹äºå•ç‚¹ç™»å½•ï¼Œç½‘ä¸Šæ•™ç¨‹å¤§å¤šä»¥CASæ¨¡å¼ä¸ºä¸»ï¼Œå…¶å®å¯¹äºä¸åŒçš„ç³»ç»Ÿæ¶æ„ï¼Œå®ç°å•ç‚¹ç™»å½•çš„æ­¥éª¤ä¹Ÿå¤§ä¸ºä¸åŒï¼ŒSa-Token ç”±ç®€å…¥éš¾å°†å…¶åˆ’åˆ†ä¸ºä¸‰ç§æ¨¡å¼ï¼š</p><table><thead><tr><th>ç³»ç»Ÿæ¶æ„</th><th>é‡‡ç”¨æ¨¡å¼</th><th>ç®€ä»‹</th></tr></thead><tbody><tr><td>å‰ç«¯åŒåŸŸ + åç«¯åŒ Redis</td><td>æ¨¡å¼ä¸€</td><td>å…±äº« Cookie åŒæ­¥ä¼šè¯</td></tr><tr><td>å‰ç«¯ä¸åŒåŸŸ + åç«¯åŒ Redis</td><td>æ¨¡å¼äºŒ</td><td>URLé‡å®šå‘ä¼ æ’­ä¼šè¯</td></tr><tr><td>å‰ç«¯ä¸åŒåŸŸ + åç«¯ä¸åŒ Redisï¼ˆClientç«¯æ²¡æœ‰Redisï¼‰</td><td>æ¨¡å¼ä¸‰</td><td>Httpè¯·æ±‚è·å–ä¼šè¯</td></tr></tbody></table>',8),j=n("li",null,[s("å‰ç«¯åŒåŸŸï¼šå°±æ˜¯æŒ‡å¤šä¸ªç³»ç»Ÿå¯ä»¥éƒ¨ç½²åœ¨åŒä¸€ä¸ªä¸»åŸŸåä¹‹ä¸‹ï¼Œæ¯”å¦‚ï¼š"),n("code",null,"c1.domain.com"),s("ã€"),n("code",null,"c2.domain.com"),s("ã€"),n("code",null,"c3.domain.com"),s("ã€‚")],-1),I=n("strong",null,[n("code",null,"[æƒé™ç¼“å­˜ä¸ä¸šåŠ¡ç¼“å­˜åˆ†ç¦»]")],-1),U={href:"http://sa-token.dev33.cn/doc/index.html#/plugin/alone-redis",target:"_blank",rel:"noopener noreferrer"},H=n("li",null,"å¦‚æœæ—¢æ— æ³•åšåˆ°å‰ç«¯åŒåŸŸï¼Œä¹Ÿæ— æ³•åšåˆ°åç«¯åŒRedisï¼Œé‚£ä¹ˆåªèƒ½èµ°æ¨¡å¼ä¸‰ï¼ŒHttpè¯·æ±‚è·å–ä¼šè¯ï¼ˆSa-Tokenå¯¹SSOæä¾›äº†å®Œæ•´çš„å°è£…ï¼Œä½ åªéœ€è¦æŒ‰ç…§ç¤ºä¾‹ä»æ–‡æ¡£ä¸Šå¤åˆ¶å‡ æ®µä»£ç ä¾¿å¯ä»¥è½»æ¾é›†æˆï¼‰ã€‚",-1),L=n("li",null,"æŠ€æœ¯é€‰å‹ä¸€å®šè¦æ ¹æ®ç³»ç»Ÿæ¶æ„å¯¹ç—‡ä¸‹è¯ï¼Œåˆ‡ä¸å¯èƒ¡ä¹±é€‰æ‹©ã€‚",-1),A=e(`<h2 id="ğŸ‰ç»Ÿä¸€è®¤è¯ä¸­å¿ƒsso-server" tabindex="-1"><a class="header-anchor" href="#ğŸ‰ç»Ÿä¸€è®¤è¯ä¸­å¿ƒsso-server" aria-hidden="true">#</a> ğŸ‰ç»Ÿä¸€è®¤è¯ä¸­å¿ƒSSO-Server</h2><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªåœ°æ–¹æ¥ç»Ÿä¸€å¤„ç†ç”¨æˆ·çš„æƒé™æ ¡éªŒå€¼ç±»çš„ï¼Œæ‰€ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ªmodule</p><h3 id="ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–" aria-hidden="true">#</a> ä¾èµ–</h3><p>é™¤äº† <strong>sa-token-spring-boot-starter</strong> ä»¥å¤–ï¼Œå…¶å®ƒåŒ…éƒ½æ˜¯å¯é€‰çš„ï¼š</p><ul><li>åœ¨SSOæ¨¡å¼ä¸‰æ—¶ Redis ç›¸å…³åŒ…æ˜¯å¯é€‰çš„</li><li>åœ¨å‰åç«¯åˆ†ç¦»æ¨¡å¼ä¸‹å¯ä»¥åˆ é™¤ thymeleaf ç›¸å…³åŒ…</li><li>åœ¨ä¸éœ€è¦SSOæ¨¡å¼ä¸‰å•ç‚¹æ³¨é”€çš„æƒ…å†µä¸‹å¯ä»¥åˆ é™¤ http å·¥å…·åŒ…</li></ul><p>å»ºè®®å…ˆå®Œæ•´æµ‹è¯•ä¸‰ç§æ¨¡å¼ä¹‹åå†å¯¹pomä¾èµ–è¿›è¡Œé…Œæƒ…åˆ å‡ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- Sa-Token æƒé™è®¤è¯, åœ¨çº¿æ–‡æ¡£ï¼šhttp://sa-token.dev33.cn/ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.28.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Sa-Token æ•´åˆ Redis (ä½¿ç”¨ jackson åºåˆ—åŒ–æ–¹å¼) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-dao-redis-jackson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.28.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Sa-Tokenæ’ä»¶ï¼šæƒé™ç¼“å­˜ä¸ä¸šåŠ¡ç¼“å­˜åˆ†ç¦» è¿™ä¸ªå¯é€‰ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-alone-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.28.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- è§†å›¾å¼•æ“ï¼ˆåœ¨å‰åç«¯ä¸åˆ†ç¦»æ¨¡å¼ä¸‹æä¾›è§†å›¾æ”¯æŒï¼‰ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Httpè¯·æ±‚å·¥å…·ï¼ˆåœ¨æ¨¡å¼ä¸‰çš„å•ç‚¹æ³¨é”€åŠŸèƒ½ä¸‹ç”¨åˆ°ï¼Œå¦‚ä¸éœ€è¦å¯ä»¥æ³¨é‡Šæ‰ï¼‰ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ejlchina<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>okhttps<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--        åŸºç¡€å†…å®¹--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> é…ç½®æ–‡ä»¶</h3><p>ä¸‹é¢çš„æ ¹æ®è‡ªå·±ç”¨åˆ°çš„å¯¹åº”çš„æ¨¡å¼å¼€å¯</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># ç«¯å£</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span>

<span class="token comment"># Sa-Token é…ç½®</span>
<span class="token key atrule">sa-token</span><span class="token punctuation">:</span>
  <span class="token comment"># é¦–å…ˆæ˜¯æ ‡å‡†é…ç½®</span>
  <span class="token comment"># tokenåç§° (åŒæ—¶ä¹Ÿæ˜¯cookieåç§°)</span>
  <span class="token key atrule">token-name</span><span class="token punctuation">:</span> satoken
  <span class="token comment"># tokenæœ‰æ•ˆæœŸï¼Œå•ä½s é»˜è®¤30å¤©, -1ä»£è¡¨æ°¸ä¸è¿‡æœŸ</span>
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">2592000</span>
  <span class="token comment"># tokenä¸´æ—¶æœ‰æ•ˆæœŸ (æŒ‡å®šæ—¶é—´å†…æ— æ“ä½œå°±è§†ä¸ºtokenè¿‡æœŸ) å•ä½: ç§’</span>
  <span class="token key atrule">activity-timeout</span><span class="token punctuation">:</span> <span class="token number">-1</span>
  <span class="token comment"># æ˜¯å¦å…è®¸åŒä¸€è´¦å·å¹¶å‘ç™»å½• (ä¸ºtrueæ—¶å…è®¸ä¸€èµ·ç™»å½•, ä¸ºfalseæ—¶æ–°ç™»å½•æŒ¤æ‰æ—§ç™»å½•)</span>
  <span class="token key atrule">is-concurrent</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># åœ¨å¤šäººç™»å½•åŒä¸€è´¦å·æ—¶ï¼Œæ˜¯å¦å…±ç”¨ä¸€ä¸ªtoken (ä¸ºtrueæ—¶æ‰€æœ‰ç™»å½•å…±ç”¨ä¸€ä¸ªtoken, ä¸ºfalseæ—¶æ¯æ¬¡ç™»å½•æ–°å»ºä¸€ä¸ªtoken)</span>
  <span class="token key atrule">is-share</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># tokené£æ ¼</span>
  <span class="token key atrule">token-style</span><span class="token punctuation">:</span> uuid
  <span class="token comment"># æ˜¯å¦è¾“å‡ºæ“ä½œæ—¥å¿—</span>
  <span class="token key atrule">is-log</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

  <span class="token comment"># -------------- SSO-æ¨¡å¼ä¸€ç›¸å…³é…ç½®  (éæ¨¡å¼ä¸€ä¸éœ€è¦é…ç½®) å‰ç«¯åŒåŸŸ + åç«¯åŒ Redis</span>
  <span class="token comment"># cookie:</span>
  <span class="token comment"># é…ç½®Cookieä½œç”¨åŸŸ  è¿™é‡Œä¼šå½ªé»„ï¼Œä¸å½±å“ï¼Œæ³¨æ„ï¼Œæ˜¯è¦åœ¨cookieçš„ä¸‹åæ–¹</span>
  <span class="token comment"># domain: stp.com</span>

    <span class="token comment"># ------- SSO-æ¨¡å¼äºŒç›¸å…³é…ç½®  å‰ç«¯ä¸åŒåŸŸ + åç«¯åŒ Redis</span>
  <span class="token key atrule">sso</span><span class="token punctuation">:</span>
    <span class="token comment"># Ticketæœ‰æ•ˆæœŸ (å•ä½: ç§’)ï¼Œé»˜è®¤äº”åˆ†é’Ÿ</span>
    <span class="token key atrule">ticket-timeout</span><span class="token punctuation">:</span> <span class="token number">300</span>
    <span class="token comment"># æ‰€æœ‰å…è®¸çš„æˆæƒå›è°ƒåœ°å€</span>
    <span class="token key atrule">allow-url</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
    <span class="token comment"># æ˜¯å¦æ‰“å¼€å•ç‚¹æ³¨é”€åŠŸèƒ½</span>
    <span class="token key atrule">is-slo</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

    <span class="token comment"># ------- SSO-æ¨¡å¼ä¸‰ç›¸å…³é…ç½® å‰ç«¯ä¸åŒåŸŸ + åç«¯ä¸åŒ Redis</span>
    <span class="token comment">#ï¼ˆä¸‹é¢çš„é…ç½®åœ¨SSOæ¨¡å¼ä¸‰å¹¶ä¸” is-slo=true æ—¶æ‰“å¼€ï¼‰</span>
    <span class="token comment"># æ˜¯å¦æ‰“å¼€æ¨¡å¼ä¸‰</span>
    <span class="token key atrule">isHttp</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># æ¥å£è°ƒç”¨ç§˜é’¥ï¼ˆç”¨äºSSOæ¨¡å¼ä¸‰çš„å•ç‚¹æ³¨é”€åŠŸèƒ½ï¼‰</span>
    <span class="token key atrule">secretkey</span><span class="token punctuation">:</span> kQwIOrYvnXmSDkwEiFngrKidMcdrgKor
    <span class="token comment"># ---- é™¤äº†ä»¥ä¸Šé…ç½®é¡¹ï¼Œä½ è¿˜éœ€è¦ä¸º Sa-Token é…ç½®httpè¯·æ±‚å¤„ç†å™¨ï¼ˆæ–‡æ¡£æœ‰æ­¥éª¤è¯´æ˜ï¼‰</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># Redisé…ç½® ï¼ˆSSOæ¨¡å¼ä¸€å’Œæ¨¡å¼äºŒä½¿ç”¨Redisæ¥åŒæ­¥ä¼šè¯ï¼‰</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment"># Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token comment"># RedisæœåŠ¡å™¨åœ°å€</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> myserver
    <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">13355</span>
    <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> amayakite
    <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">200</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è®¾ç½®ç™»é™†controller" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®ç™»é™†controller" aria-hidden="true">#</a> è®¾ç½®ç™»é™†Controller</h3><blockquote><p>æ³¨ï¼šåœ¨<code>setDoLoginHandle</code>å‡½æ•°é‡Œå¦‚æœè¦è·å–name, pwdä»¥å¤–çš„å‚æ•°</p><p>å¯é€šè¿‡<code>SaHolder.getRequest().getParam(&quot;xxx&quot;)</code>æ¥è·å–</p><p>ä¸‹é¢çš„Controllerå»ºè®®ç›´æ¥å¤åˆ¶ï¼Œå½“ç„¶é‚£ä¸ªssoå¯ä»¥æ¢æˆåˆ«çš„</p></blockquote>`,12),M=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token annotation punctuation"},"@RestController"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"SsoServiceController"),s(),n("span",{class:"token punctuation"},"{"),s(`


    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * SSO-Serverç«¯ï¼šå¤„ç†æ‰€æœ‰SSOç›¸å…³çš„è¯·æ±‚ï¼Œä¹‹åçš„ç« èŠ‚ä¼šè¯´æ˜å®ƒçš„ä½œç”¨
     *
     * `),n("span",{class:"token keyword"},"@return"),s(`
     */`)]),s(`
    `),n("span",{class:"token annotation punctuation"},"@RequestMapping"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/sso/*"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"Object"),s(),n("span",{class:"token function"},"ssoRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaSsoHandle"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"serverRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


    `),n("span",{class:"token annotation punctuation"},"@Autowired"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"configSso"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"SaTokenConfig"),s(" cfg"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token comment"},"//        é…ç½®ï¼šæœªç™»å½•çš„æ—¶å€™è¿”å›çš„view"),s(`
        cfg`),n("span",{class:"token punctuation"},"."),s("sso"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setNotLoginView"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token class-name"},"String"),s(" msg "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"å½“å‰ä¼šè¯åœ¨SSO-Serverç«¯å°šæœªç™»å½•ï¼Œè¯·å…ˆè®¿é—®"'),s(`
                    `),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},`"<a href='/sso/doLogin?name=user&pwd=123456' target='_blank'> doLoginç™»å½• </a>"`),s(`
                    `),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'"è¿›è¡Œç™»å½•ä¹‹åï¼Œåˆ·æ–°é¡µé¢å¼€å§‹æˆæƒ"'),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"return"),s(" msg"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"//        é…ç½®ï¼šå¤„ç†ç™»é™†å‡½æ•°"),s(`
        cfg`),n("span",{class:"token punctuation"},"."),s("sso"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setDoLoginHandle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("name"),n("span",{class:"token punctuation"},","),s(" pwd"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token comment"},"//           TODO ç›®å‰åªæ˜¯æ¨¡æ‹Ÿç™»é™†ï¼ŒçœŸå®ç™»é™†çš„è¯ï¼Œè¦è¯¥æ”¹æˆé€šè¿‡æ•°æ®åº“æ¥éªŒè¯"),s(`
            `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"user"'),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"equals"),n("span",{class:"token punctuation"},"("),s("name"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token string"},'"123456"'),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"equals"),n("span",{class:"token punctuation"},"("),s("pwd"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token comment"},"//                 æ³¨æ„ è¿™ä¸ªloginéå¸¸éå¸¸éå¸¸é‡è¦ï¼Œä¸€å®šä¸èƒ½å¿˜äº†ã€‚ã€‚"),s(`
                `),n("span",{class:"token class-name"},"StpUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"login"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10001"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"//                è¿™é‡Œè¿”å›å•¥éƒ½è¡Œï¼ˆæ¥æ”¶Objectï¼Œè¿™ä¸ªSaResultç›¸å½“äºæˆ‘ä»¬è‡ªå·±çš„æ‰‹åŠ¨æ“ä¸€ä¸ªè¿”å›å€¼æ¨¡æ¿ä¸€æ ·ï¼‰"),s(`
                `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaResult"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ç™»é™†æˆåŠŸ"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setData"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StpUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getTokenValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaResult"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ç™»é™†å¤±è´¥"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"//        é…ç½®HTTPå¤„ç†è¯·æ±‚ï¼ˆåœ¨æ¨¡å¼ä¸‰(å‰ç«¯ä¸åŒåŸŸ + åç«¯ä¸åŒ Redis)çš„å•ç‚¹æ³¨é”€åŠŸèƒ½ä¸‹ç”¨åˆ°ï¼Œå¦‚ä¸éœ€è¦å¯ä»¥æ³¨é‡Šæ‰ï¼‰"),s(`
`),n("span",{class:"token comment"},"//        cfg.sso.setSendHttp(url -> {"),s(`
`),n("span",{class:"token comment"},"//            return OkHttps.sync(url).get().getBody().toString();"),s(`
`),n("span",{class:"token comment"},"//        });"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=e(`<h3 id="é…ç½®å…¨å±€å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#é…ç½®å…¨å±€å¼‚å¸¸å¤„ç†" aria-hidden="true">#</a> é…ç½®å…¨å±€å¼‚å¸¸å¤„ç†</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * å…¨å±€å¼‚å¸¸æ‹¦æˆª
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token keyword">public</span> <span class="token class-name">SaResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•" aria-hidden="true">#</a> æµ‹è¯•</h3><p>å®Œæˆä¸Šé¢çš„å†…å®¹åï¼Œä½ æ‰‹åŠ¨å†™ä¸€ä¸ªç®€ç®€å•å•çš„mainï¼Œç„¶åå¼€å¯</p>`,4),P={href:"http://localhost:9000/sso/auth",target:"_blank",rel:"noopener noreferrer"},F=e('<p>æ³¨æ„ï¼Œè¿™é‡Œåƒä¸‡ä¸è¦å¼€ä¾‹å¦‚<code>Cla**</code>ä¹‹ç±»çš„ä»£ç†ï¼Œä¸ç„¶ä½ ç»å¯¹è®¿é—®ä¸æˆåŠŸï¼ˆMDæ‰¾äº†åŠå¤©BUGï¼‰</p><p>å¦‚æœè¯´ä½ å‰é¢éƒ½æ˜¯æ­£å¸¸é…ç½®çš„è¯ï¼Œè¿™é‡Œåº”è¯¥æ˜¯è¿™æ ·çš„</p><figure><img src="'+i+'" alt="image-20220121214051416" tabindex="0" loading="lazy"><figcaption>image-20220121214051416</figcaption></figure><p>ç‚¹å‡»åï¼Œå¯ä»¥çœ‹åˆ°</p><figure><img src="'+u+`" alt="image-20220121223317742" tabindex="0" loading="lazy"><figcaption>image-20220121223317742</figcaption></figure><p>æ³¨æ„ å¦‚æœæ²¡æœ‰è¿™ä¸ªtokençš„è¯ï¼Œè¡¨ç¤ºç™»é™†å¤±è´¥</p><h3 id="ğŸ‰ssoè·¯å¾„ä¸‹çš„apiåˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#ğŸ‰ssoè·¯å¾„ä¸‹çš„apiåˆ—è¡¨" aria-hidden="true">#</a> ğŸ‰ssoè·¯å¾„ä¸‹çš„APIåˆ—è¡¨</h3><p>å¦‚æœä½ ä»…ä»…ä½¿ç”¨ Sa-Token æ­å»º SSO-Server ç«¯ï¼Œè€Œ Client ç«¯ä½¿ç”¨å…¶å®ƒæ¡†æ¶çš„è¯ï¼Œé‚£ä¹ˆä¸‹é¢çš„ API åˆ—è¡¨å°†ç»™ä½ çš„å¯¹æ¥æ­¥éª¤åšä¸€ä»½å‚è€ƒã€‚</p><p>å¦‚æœä½ åœ¨ Client ç«¯ä¹Ÿç”¨åˆ°äº† Sa-Token æ¡†æ¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€‰æ‹©è·³è¿‡æœ¬å°èŠ‚ï¼ŒSa-Token å¯¹ Client ç«¯ä¹Ÿæä¾›äº†ç›¸åº”çš„å°è£…ï¼Œ</p><blockquote><p>å•ç‚¹ç™»é™†æˆæƒåœ°å€</p></blockquote><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>http://{host}:{port}/sso/auth
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥æ”¶å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>redirect</td><td>æ˜¯</td><td>ç™»å½•æˆåŠŸåçš„é‡å®šå‘åœ°å€ï¼Œä¸€èˆ¬å¡«å†™ location.hrefï¼ˆä»å“ªæ¥å›å“ªå»ï¼‰</td></tr><tr><td>mode</td><td>å¦</td><td>æˆæƒæ¨¡å¼ï¼Œå–å€¼ [simple, ticket]ï¼Œsimple=ç™»å½•åç›´æ¥é‡å®šå‘ï¼Œticket=å¸¦ç€ticketå‚æ•°é‡å®šå‘ï¼Œé»˜è®¤å€¼ä¸ºticket</td></tr></tbody></table><p>è®¿é—®æ¥å£åæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>æƒ…å†µä¸€ï¼šå½“å‰ä¼šè¯åœ¨ SSO è®¤è¯ä¸­å¿ƒæœªç™»å½•ï¼Œä¼šè¿›å…¥ç™»å½•é¡µå¼€å§‹ç™»å½•ã€‚</li><li>æƒ…å†µäºŒï¼šå½“å‰ä¼šè¯åœ¨ SSO è®¤è¯ä¸­å¿ƒå·²ç™»å½•ï¼Œä¼šè¢«é‡å®šå‘è‡³ <code>redirect</code> åœ°å€ï¼Œå¹¶æºå¸¦ <code>ticket</code> å‚æ•°ã€‚</li></ul><blockquote><p>ç™»é™†æ¥å£</p></blockquote><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>http://{host}:{port}/sso/doLogin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥æ”¶å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>name</td><td>æ˜¯</td><td>ç”¨æˆ·å</td></tr><tr><td>pwd</td><td>æ˜¯</td><td>å¯†ç </td></tr></tbody></table><p>æ­¤æ¥å£å±äº RestAPI (ä½¿ç”¨ajaxè®¿é—®)ï¼Œä¼šè¿›å…¥åç«¯é…ç½®çš„ <code>setDoLoginHandle</code> å‡½æ•°ä¸­ï¼Œå¦å¤–éœ€è¦æ³¨æ„ï¼š æ­¤æ¥å£å¹¶éåªèƒ½æºå¸¦ nameã€pwd å‚æ•°ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨ setDoLoginHandle å‡½æ•°é‡Œé€šè¿‡ <code>SaHolder.getRequest().getParam(&quot;xxx&quot;)</code> æ¥è·å–å…¶å®ƒå‚æ•°ã€‚</p><blockquote><p>Ticketæ ¡éªŒæ¥å£</p></blockquote><p>æ­¤æ¥å£ä»…é…ç½®æ¨¡å¼ä¸‰ <code>(isHttp=true)</code> æ—¶æ‰“å¼€</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>http://{host}:{port}/sso/checkTicket
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥æ”¶å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ticket</td><td>æ˜¯</td><td>åœ¨æ­¥éª¤ 5.1 ä¸­æˆæƒé‡å®šå‘æ—¶çš„ ticket å‚æ•°</td></tr><tr><td>ssoLogoutCall</td><td>å¦</td><td>å•ç‚¹æ³¨é”€æ—¶çš„å›è°ƒé€šçŸ¥åœ°å€ï¼Œåªåœ¨SSOæ¨¡å¼ä¸‰å•ç‚¹æ³¨é”€æ—¶éœ€è¦æºå¸¦æ­¤å‚æ•°</td></tr></tbody></table><p>è¿”å›å€¼åœºæ™¯ï¼š</p><ul><li>è¿”å›ç©ºï¼Œä»£è¡¨æ ¡éªŒå¤±è´¥ã€‚</li><li>è¿”å›å…·ä½“çš„ loginIdï¼Œä¾‹å¦‚10001ï¼Œä»£è¡¨æ ¡éªŒæˆåŠŸï¼Œå€¼ä¸ºæ­¤ ticket ç ä»£è¡¨çš„ç”¨æˆ·idã€‚</li></ul><blockquote><p>å•ç‚¹æ³¨é”€æ¥å£</p></blockquote><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>http://{host}:{port}/sso/logout 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥å—å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>loginId</td><td>å¦</td><td>è¦æ³¨é”€çš„è´¦å·id</td></tr><tr><td>secretkey</td><td>å¦</td><td>æ¥å£é€šä¿¡ç§˜é’¥</td></tr><tr><td>back</td><td>å¦</td><td>æ³¨é”€æˆåŠŸåçš„é‡å®šå‘åœ°å€</td></tr></tbody></table><p>æ­¤æ¥å£æœ‰ä¸¤ç§è°ƒç”¨æ–¹å¼</p><ol><li><p>åœ¨ Client çš„å‰ç«¯é¡µé¢å¼•å¯¼ç”¨æˆ·ç›´æ¥è·³è½¬ï¼Œå¹¶å¸¦æœ‰ back å‚æ•°</p><ul><li>ä¾‹å¦‚ï¼š<code>http://{host}:{port}/sso/logout?back=xxx</code>ï¼Œä»£è¡¨ç”¨æˆ·æ³¨é”€æˆåŠŸåè¿”å›backåœ°å€</li></ul></li><li><p>åœ¨ Client çš„åç«¯é€šè¿‡ http å·¥å…·æ¥è°ƒç”¨</p><ul><li><p>ä¾‹å¦‚ï¼š<code>http://{host}:{port}/sso/logout?loginId={value}&amp;secretkey={value}</code></p></li><li><p>ä»£è¡¨æ³¨é”€ è´¦å·=loginId çš„è´¦å·ï¼Œè¿”å›jsonæ•°æ®ç»“æœï¼Œå½¢å¦‚ï¼š</p><ul><li><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>    <span class="token comment">// 200è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œé200æ ‡è¯†è¯·æ±‚å¤±è´¥</span>
    <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;å•ç‚¹æ³¨é”€æˆåŠŸ&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul></li></ol><p>SSO è®¤è¯ä¸­å¿ƒåªæœ‰è¿™å››ä¸ªæ¥å£ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ Client ç«¯çš„å¯¹æ¥æµç¨‹</p><h2 id="å‰ç«¯åŒåŸŸ-åç«¯åŒ-redis" tabindex="-1"><a class="header-anchor" href="#å‰ç«¯åŒåŸŸ-åç«¯åŒ-redis" aria-hidden="true">#</a> å‰ç«¯åŒåŸŸ + åç«¯åŒ Redis</h2><h3 id="æ€è·¯" tabindex="-1"><a class="header-anchor" href="#æ€è·¯" aria-hidden="true">#</a> æ€è·¯</h3><p>é¦–å…ˆæˆ‘ä»¬åˆ†æä¸€ä¸‹å¤šä¸ªç³»ç»Ÿä¹‹é—´ï¼Œä¸ºä»€ä¹ˆæ— æ³•åŒæ­¥ç™»å½•çŠ¶æ€ï¼Ÿ</p><ol><li>å‰ç«¯çš„ <code>Token</code> æ— æ³•åœ¨å¤šä¸ªç³»ç»Ÿä¸‹å…±äº«ã€‚</li><li>åç«¯çš„ <code>Session</code> æ— æ³•åœ¨å¤šä¸ªç³»ç»Ÿé—´å…±äº«ã€‚</li></ol><p>æ‰€ä»¥å•ç‚¹ç™»å½•ç¬¬ä¸€æ‹›ï¼Œå°±æ˜¯å¯¹ç—‡ä¸‹è¯ï¼š</p><ol><li>ä½¿ç”¨ <code>å…±äº«Cookie</code> æ¥è§£å†³ Token å…±äº«é—®é¢˜ã€‚</li><li>ä½¿ç”¨ <code>Redis</code> æ¥è§£å†³ Session å…±äº«é—®é¢˜ã€‚</li></ol><p>æ‰€è°“å…±äº«Cookieï¼Œå°±æ˜¯ä¸»åŸŸåCookieåœ¨äºŒçº§åŸŸåä¸‹çš„å…±äº«ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><ul><li>å†™åœ¨çˆ¶åŸŸå<code>stp.com</code>ä¸‹çš„Cookieï¼Œåœ¨<code>s1.stp.com</code>ã€<code>s2.stp.com</code>ç­‰å­åŸŸåéƒ½æ˜¯å¯ä»¥å…±äº«è®¿é—®çš„ã€‚</li></ul>`,42),z=n("strong",null,"[æƒé™ç¼“å­˜ä¸ä¸šåŠ¡ç¼“å­˜åˆ†ç¦»]",-1),D={href:"https://sa-token.dev33.cn/doc/index.html#/plugin/alone-redis",target:"_blank",rel:"noopener noreferrer"},B=e(`<p>è¿™ä¸ªæ’ä»¶ä½¿ç”¨è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œ è£…å³ç”¨</p><h3 id="å‡†å¤‡å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡å·¥ä½œ" aria-hidden="true">#</a> å‡†å¤‡å·¥ä½œ</h3><p>é¦–å…ˆä¿®æ”¹hostsæ–‡ä»¶<code>(C:\\windows\\system32\\drivers\\etc\\hosts)</code>ï¼Œæ·»åŠ ä»¥ä¸‹IPæ˜ å°„ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>127.0.0.1 sso.stp.com
127.0.0.1 s1.stp.com
127.0.0.1 s2.stp.com
127.0.0.1 s3.stp.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),N={href:"https://github.com/oldj/SwitchHosts/releases",target:"_blank",rel:"noopener noreferrer"},V=e(`<h3 id="æŒ‡å®šcookieçš„ä½œç”¨åŸŸ" tabindex="-1"><a class="header-anchor" href="#æŒ‡å®šcookieçš„ä½œç”¨åŸŸ" aria-hidden="true">#</a> æŒ‡å®šCookieçš„ä½œç”¨åŸŸ</h3><p>åœ¨<code>sso.stp.com</code>è®¿é—®æœåŠ¡å™¨ï¼Œå…¶Cookieä¹Ÿåªèƒ½å†™å…¥åˆ°<code>sso.stp.com</code>ä¸‹ï¼Œä¸ºäº†å°†Cookieå†™å…¥åˆ°å…¶çˆ¶çº§åŸŸå<code>stp.com</code>ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹ SSO-Server ç«¯çš„ yml é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">sa-token</span><span class="token punctuation">:</span>
    <span class="token key atrule">cookie</span><span class="token punctuation">:</span>
        <span class="token comment"># é…ç½®Cookieä½œç”¨åŸŸ  ä¼šå½ªé»„ï¼Œä¸å½±å“</span>
        <span class="token key atrule">domain</span><span class="token punctuation">:</span> stp.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªé…ç½®åŸæœ¬æ˜¯è¢«æ³¨é‡Šæ‰çš„ï¼Œç°åœ¨å°†å…¶æ‰“å¼€ã€‚å¦å¤–æˆ‘ä»¬æ ¼å¤–éœ€è¦æ³¨æ„ï¼š åœ¨SSOæ¨¡å¼ä¸€æµ‹è¯•å®Œæ¯•ä¹‹åï¼Œä¸€å®šè¦å°†è¿™ä¸ªé…ç½®å†æ¬¡æ³¨é‡Šæ‰ï¼Œå› ä¸ºæ¨¡å¼ä¸€ä¸æ¨¡å¼äºŒä¸‰ä½¿ç”¨ä¸åŒçš„æˆæƒæµç¨‹ï¼Œè¿™è¡Œé…ç½®ä¼šå½±å“åˆ°æˆ‘ä»¬æ¨¡å¼äºŒå’Œæ¨¡å¼ä¸‰çš„æ­£å¸¸è¿è¡Œã€‚</p><h3 id="æ­å»ºclienté¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#æ­å»ºclienté¡¹ç›®" aria-hidden="true">#</a> æ­å»ºClienté¡¹ç›®</h3><p>åˆ›å»ºä¸ªï¼š<code> sa-token-demo-sso1-client</code>é¡¹ç›®ï¼Œä¾èµ–å¦‚ä¸‹</p><h4 id="ä¾èµ–å‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–å‡†å¤‡" aria-hidden="true">#</a> ä¾èµ–å‡†å¤‡</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- Sa-Token æƒé™è®¤è¯, åœ¨çº¿æ–‡æ¡£ï¼šhttp://sa-token.dev33.cn/ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${sa-token-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Sa-Token æ•´åˆredis (ä½¿ç”¨jacksonåºåˆ—åŒ–æ–¹å¼) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-dao-redis-jackson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${sa-token-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Sa-Tokenæ’ä»¶ï¼šæƒé™ç¼“å­˜ä¸ä¸šåŠ¡ç¼“å­˜åˆ†ç¦» --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-alone-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${sa-token-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="controlleræ§åˆ¶å™¨" tabindex="-1"><a class="header-anchor" href="#controlleræ§åˆ¶å™¨" aria-hidden="true">#</a> Controlleræ§åˆ¶å™¨</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SsoClientController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> authUrl <span class="token operator">=</span> <span class="token class-name">SaManager</span><span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSso</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> solUrl <span class="token operator">=</span> <span class="token class-name">SaManager</span><span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSso</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSloUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;&lt;h2&gt;Sa-Token SSO-Client åº”ç”¨ç«¯&lt;/h2&gt;&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;&lt;p&gt;å½“å‰ä¼šè¯æ˜¯å¦ç™»å½•ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/p&gt;&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;&lt;p&gt;&lt;a href=\\&quot;javascript:location.href=&#39;&quot;</span> <span class="token operator">+</span> authUrl <span class="token operator">+</span> <span class="token string">&quot;?mode=simple&amp;redirect=&#39; + encodeURIComponent(location.href);\\&quot;&gt;ç™»å½•&lt;/a&gt; &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;&lt;a href=\\&quot;javascript:location.href=&#39;&quot;</span> <span class="token operator">+</span> solUrl <span class="token operator">+</span> <span class="token string">&quot;?back=&#39; + encodeURIComponent(location.href);\\&quot;&gt;æ³¨é”€&lt;/a&gt; &lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å…¨å±€å¼‚å¸¸æ‹¦æˆª
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token keyword">public</span> <span class="token class-name">SaResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="application-ymlé…ç½®" tabindex="-1"><a class="header-anchor" href="#application-ymlé…ç½®" aria-hidden="true">#</a> application.ymlé…ç½®</h4><p>è¿™é‡Œå«Œéº»çƒ¦çš„è¯â€¦å¯ä»¥ç”¨Nacosçš„é…ç½®ä¸­å¿ƒæ¥ä¸€æ­¥åˆ°ä½â€¦</p>`,12),K={href:"https://sa-token.dev33.cn/doc/index.html#/plugin/alone-redis",target:"_blank",rel:"noopener noreferrer"},Q=e(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># ç«¯å£</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token comment"># sa-tokené…ç½®</span>
<span class="token key atrule">sa-token</span><span class="token punctuation">:</span>
  <span class="token comment"># SSO-ç›¸å…³é…ç½®</span>
  <span class="token key atrule">sso</span><span class="token punctuation">:</span>
    <span class="token comment"># SSO-Serverç«¯-å•ç‚¹ç™»å½•æˆæƒåœ°å€</span>
    <span class="token key atrule">auth-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sso.stp.com<span class="token punctuation">:</span>9000/sso/auth
    <span class="token comment"># SSO-Serverç«¯-å•ç‚¹æ³¨é”€åœ°å€</span>
    <span class="token key atrule">slo-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sso.stp.com<span class="token punctuation">:</span>9000/sso/logout

    

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># Redisé…ç½® ï¼ˆSSOæ¨¡å¼ä¸€å’Œæ¨¡å¼äºŒä½¿ç”¨Redisæ¥åŒæ­¥ä¼šè¯ï¼‰</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment"># Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token comment"># RedisæœåŠ¡å™¨åœ°å€</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> myserver
    <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">13355</span>
    <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> amayakite
    <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">200</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯åŠ¨ç±»" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨ç±»" aria-hidden="true">#</a> å¯åŠ¨ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * SSOæ¨¡å¼ä¸€ï¼ŒClientç«¯ Demo 
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaSsoClientApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SaSsoClientApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\\nSa-Token SSOæ¨¡å¼ä¸€ Clientç«¯å¯åŠ¨æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è®¿é—®æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#è®¿é—®æµ‹è¯•" aria-hidden="true">#</a> è®¿é—®æµ‹è¯•</h3><p>å¯åŠ¨é¡¹ç›®ï¼Œä¾æ¬¡è®¿é—®ä¸‰ä¸ªåº”ç”¨ç«¯ï¼š</p>`,5),X={href:"http://s1.stp.com:9001/",target:"_blank",rel:"noopener noreferrer"},Y={href:"http://s2.stp.com:9002/",target:"_blank",rel:"noopener noreferrer"},G={href:"http://s3.stp.com:9003/",target:"_blank",rel:"noopener noreferrer"},W=e('<p>ä½ ç›´æ¥è®¿é—®ï¼Œæ˜¯è¿™ä¸ªå†…å®¹</p><figure><img src="'+r+'" alt="image-20220121223234108" tabindex="0" loading="lazy"><figcaption>image-20220121223234108</figcaption></figure><p>ç‚¹å‡»ç™»å½•åï¼Œä¼šè·³è½¬åˆ°</p><figure><img src="'+d+'" alt="image-20220121223249009" tabindex="0" loading="lazy"><figcaption>image-20220121223249009</figcaption></figure><p>ç™»å½•</p><figure><img src="'+k+'" alt="image-20220121223259316" tabindex="0" loading="lazy"><figcaption>image-20220121223259316</figcaption></figure><p>ç„¶åè¿”å›</p><figure><img src="'+m+'" alt="image-20220121223342782" tabindex="0" loading="lazy"><figcaption>image-20220121223342782</figcaption></figure><p>èƒ½å‘ç°ç™»å½•æˆåŠŸäº†ï¼Œå¹¶ä¸”ä½ è®¿é—®å…¶ä»–ä¸¤ä¸ªä¹Ÿä¼šå‘ç°ç™»é™†æˆåŠŸ</p><figure><img src="'+v+'" alt="image-20220121223410580" tabindex="0" loading="lazy"><figcaption>image-20220121223410580</figcaption></figure><p>å¥½äº†ï¼Œæ¨¡å¼1å°±åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯éå¸¸ç®€å•â€¦.</p><h2 id="ğŸ‰å‰ç«¯ä¸åŒåŸŸ-åç«¯åŒ-redis" tabindex="-1"><a class="header-anchor" href="#ğŸ‰å‰ç«¯ä¸åŒåŸŸ-åç«¯åŒ-redis" aria-hidden="true">#</a> ğŸ‰å‰ç«¯ä¸åŒåŸŸ + åç«¯åŒ Redis</h2><p>å¦‚æœæˆ‘ä»¬çš„å¤šä¸ªç³»ç»Ÿï¼šéƒ¨ç½²åœ¨ä¸åŒçš„åŸŸåä¹‹ä¸‹ï¼Œä½†æ˜¯åç«¯å¯ä»¥è¿æ¥åŒä¸€ä¸ªRedisï¼Œé‚£ä¹ˆä¾¿å¯ä»¥ä½¿ç”¨ <strong><code>[URLé‡å®šå‘ä¼ æ’­ä¼šè¯]</code></strong> çš„æ–¹å¼åšåˆ°å•ç‚¹ç™»å½•ã€‚</p><h3 id="æ€è·¯-1" tabindex="-1"><a class="header-anchor" href="#æ€è·¯-1" aria-hidden="true">#</a> æ€è·¯</h3><p>é¦–å…ˆæˆ‘ä»¬å†æ¬¡å¤ä¹ ä¸€ä¸‹ï¼Œå¤šä¸ªç³»ç»Ÿä¹‹é—´ä¸ºä»€ä¹ˆæ— æ³•åŒæ­¥ç™»å½•çŠ¶æ€ï¼Ÿ</p><ol><li>å‰ç«¯çš„<code>Token</code>æ— æ³•åœ¨å¤šä¸ªç³»ç»Ÿä¸‹å…±äº«ã€‚</li><li>åç«¯çš„<code>Session</code>æ— æ³•åœ¨å¤šä¸ªç³»ç»Ÿé—´å…±äº«ã€‚</li></ol>',16),$={href:"https://sa-token.dev33.cn/doc/index.html#/plugin/alone-redis",target:"_blank",rel:"noopener noreferrer"},J=e(`<blockquote><p>è€Œç¬¬ä¸€ç‚¹ï¼Œæ‰æ˜¯æˆ‘ä»¬è§£å†³é—®é¢˜çš„å…³é”®æ‰€åœ¨ï¼Œåœ¨è·¨åŸŸæ¨¡å¼ä¸‹ï¼Œæ„å‘³ç€ &quot;å…±äº«Cookieæ–¹æ¡ˆ&quot; çš„å¤±æ•ˆï¼Œæˆ‘ä»¬å¿…é¡»é‡‡ç”¨ä¸€ç§æ–°çš„æ–¹æ¡ˆæ¥ä¼ é€’Tokenã€‚</p></blockquote><ol><li>ç”¨æˆ·åœ¨ å­ç³»ç»Ÿ ç‚¹å‡» <code>[ç™»å½•]</code> æŒ‰é’®ã€‚</li><li>ç”¨æˆ·è·³è½¬åˆ°å­ç³»ç»Ÿç™»å½•æ¥å£ <code>/sso/login</code>ï¼Œå¹¶æºå¸¦ <code>backå‚æ•°</code> è®°å½•åˆå§‹é¡µé¢URLã€‚ <ul><li>å½¢å¦‚ï¼š<code>http://{sso-client}/sso/login?back=xxx</code></li></ul></li><li>å­ç³»ç»Ÿæ£€æµ‹åˆ°æ­¤ç”¨æˆ·å°šæœªç™»å½•ï¼Œå†æ¬¡å°†å…¶é‡å®šå‘è‡³SSOè®¤è¯ä¸­å¿ƒï¼Œå¹¶æºå¸¦<code>redirectå‚æ•°</code>è®°å½•å­ç³»ç»Ÿçš„ç™»å½•é¡µURLã€‚ <ul><li>å½¢å¦‚ï¼š<code>http://{sso-server}/sso/auth?redirect=xxx?back=xxx</code></li></ul></li><li>ç”¨æˆ·è¿›å…¥äº† SSOè®¤è¯ä¸­å¿ƒ çš„ç™»å½•é¡µé¢ï¼Œå¼€å§‹ç™»å½•ã€‚ <ul><li>å½¢å¦‚ï¼š<code>http://{sso-client}/sso/login?back=xxx&amp;ticket=xxxxxxxxx</code></li></ul></li><li>ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç  å¹¶ ç™»å½•æˆåŠŸï¼ŒSSOè®¤è¯ä¸­å¿ƒå†æ¬¡å°†ç”¨æˆ·é‡å®šå‘è‡³å­ç³»ç»Ÿçš„ç™»å½•æ¥å£<code>/sso/login</code>ï¼Œå¹¶æºå¸¦<code>ticketç </code>å‚æ•°ã€‚</li><li>å­ç³»ç»Ÿæ ¹æ® <code>ticketç </code> ä» <code>SSO-Redis</code> ä¸­è·å–è´¦å·idï¼Œå¹¶åœ¨å­ç³»ç»Ÿç™»å½•æ­¤è´¦å·ä¼šè¯ã€‚</li><li>å­ç³»ç»Ÿå°†ç”¨æˆ·å†æ¬¡é‡å®šå‘è‡³æœ€åˆå§‹çš„ <code>back</code> é¡µé¢ã€‚</li></ol><p>æ•´ä¸ªè¿‡ç¨‹ï¼Œé™¤äº†ç¬¬å››æ­¥ç”¨æˆ·åœ¨SSOè®¤è¯ä¸­å¿ƒç™»å½•æ—¶ä¼šè¢«æ‰“æ–­ï¼Œå…¶ä½™è¿‡ç¨‹å‡æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œå½“ç”¨æˆ·åœ¨å¦ä¸€ä¸ªå­ç³»ç»Ÿå†æ¬¡ç‚¹å‡»<code>[ç™»å½•]</code>æŒ‰é’®ï¼Œç”±äºæ­¤ç”¨æˆ·åœ¨SSOè®¤è¯ä¸­å¿ƒå·²æœ‰ä¼šè¯å­˜åœ¨ï¼Œ æ‰€ä»¥ç¬¬å››æ­¥ä¹Ÿå°†è‡ªåŠ¨åŒ–ï¼Œä¹Ÿå°±æ˜¯å•ç‚¹ç™»å½•çš„æœ€ç»ˆç›®çš„ â€”â€” <strong>ä¸€æ¬¡ç™»å½•ï¼Œå¤„å¤„é€šè¡Œ</strong>ã€‚</p><h3 id="å‡†å¤‡å·¥ä½œ-ä¿®æ”¹hosts" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡å·¥ä½œ-ä¿®æ”¹hosts" aria-hidden="true">#</a> å‡†å¤‡å·¥ä½œ-ä¿®æ”¹Hosts</h3><p>è¯¥hostï¼Œæ–¹ä¾¿æµ‹è¯•</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>127.0.0.1 sa-sso-server.com
127.0.0.1 sa-sso-client1.com
127.0.0.1 sa-sso-client2.com
127.0.0.1 sa-sso-client3.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ­å»ºclient" tabindex="-1"><a class="header-anchor" href="#æ­å»ºclient" aria-hidden="true">#</a> æ­å»ºClient</h3><h4 id="å»é™¤sso-serverä¸­çš„cookieä½œç”¨åŸŸé…ç½®" tabindex="-1"><a class="header-anchor" href="#å»é™¤sso-serverä¸­çš„cookieä½œç”¨åŸŸé…ç½®" aria-hidden="true">#</a> å»é™¤SSO-Serverä¸­çš„cookieä½œç”¨åŸŸé…ç½®</h4><p>åœ¨SSOæ¨¡å¼ä¸€ç« èŠ‚ä¸­æˆ‘ä»¬æ‰“å¼€äº†é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">sa-token</span><span class="token punctuation">:</span> 
<span class="token comment"># ä¸‹é¢çš„è¦æ³¨é‡Šæ‰</span>
    <span class="token comment">#cookie:</span>
        <span class="token comment"># é…ç½®Cookieä½œç”¨åŸŸ</span>
        <span class="token comment">#domain: stp.com</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤ä¸ºæ¨¡å¼ä¸€ä¸“å±é…ç½®ï¼Œç°åœ¨æˆ‘ä»¬å°†å…¶æ³¨é‡Šæ‰ï¼Œå¹¶æŒ‰ç…§æ³¨é‡Šæç¤ºæ‰“å¼€å…¶ä»–ç›¸åº”çš„æ³¨é‡Š</p><p>Clientçš„ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- Sa-Token æƒé™è®¤è¯, åœ¨çº¿æ–‡æ¡£ï¼šhttp://sa-token.dev33.cn/ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.28.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Sa-Token æ•´åˆredis (ä½¿ç”¨jacksonåºåˆ—åŒ–æ–¹å¼) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-dao-redis-jackson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.28.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Sa-Tokenæ’ä»¶ï¼šæƒé™ç¼“å­˜ä¸ä¸šåŠ¡ç¼“å­˜åˆ†ç¦» å¯é€‰ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.dev33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sa-token-alone-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.28.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- è§†å›¾å¼•æ“ï¼ˆåœ¨å‰åç«¯ä¸åˆ†ç¦»æ¨¡å¼ä¸‹æä¾›è§†å›¾æ”¯æŒï¼‰ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="controller" tabindex="-1"><a class="header-anchor" href="#controller" aria-hidden="true">#</a> Controller</h4><p>åŒ SSO-Server ä¸€æ ·ï¼ŒSa-Token ä¸º SSO-Client ç«¯æ‰€éœ€ä»£ç ä¹Ÿæä¾›äº†å®Œæ•´çš„å°è£…ï¼Œä½ åªéœ€æä¾›ä¸€ä¸ªè®¿é—®å…¥å£ï¼Œæ¥å…¥ Sa-Token çš„æ–¹æ³•å³å¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * Sa-Token-SSO Clientç«¯ Controller 
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SsoClientController</span> <span class="token punctuation">{</span>

    <span class="token comment">// é¦–é¡µ </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;&lt;h2&gt;Sa-Token SSO-Client åº”ç”¨ç«¯&lt;/h2&gt;&quot;</span> <span class="token operator">+</span> 
                    <span class="token string">&quot;&lt;p&gt;å½“å‰ä¼šè¯æ˜¯å¦ç™»å½•ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/p&gt;&quot;</span> <span class="token operator">+</span> 
                    <span class="token string">&quot;&lt;p&gt;&lt;a href=\\&quot;javascript:location.href=&#39;/sso/login?back=&#39; + encodeURIComponent(location.href);\\&quot;&gt;ç™»å½•&lt;/a&gt; &quot;</span> <span class="token operator">+</span> 
                    <span class="token string">&quot;&lt;a href=&#39;/sso/logout?back=self&#39;&gt;æ³¨é”€&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
     * SSO-Clientç«¯ï¼šå¤„ç†æ‰€æœ‰SSOç›¸å…³è¯·æ±‚ 
     
     *         http://{host}:{port}/sso/login         
     -- Clientç«¯ç™»å½•åœ°å€ï¼Œæ¥å—å‚æ•°ï¼šback=ç™»å½•åçš„è·³è½¬åœ°å€ 
     *         http://{host}:{port}/sso/logout        
     -- Clientç«¯å•ç‚¹æ³¨é”€åœ°å€ï¼ˆisSlo=trueæ—¶æ‰“å¼€ï¼‰ï¼Œæ¥å—å‚æ•°ï¼šback=æ³¨é”€åçš„è·³è½¬åœ°å€ 
     *         http://{host}:{port}/sso/logoutCall    
     -- Clientç«¯å•ç‚¹æ³¨é”€å›è°ƒåœ°å€ï¼ˆisSlo=trueæ—¶æ‰“å¼€ï¼‰ï¼Œæ­¤æ¥å£ä¸ºæ¡†æ¶å›è°ƒï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒ
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/*&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">ssoRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SaSsoHandle</span><span class="token punctuation">.</span><span class="token function">clientRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é…ç½®ssoè®¤è¯ä¸­å¿ƒåœ°å€-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#é…ç½®ssoè®¤è¯ä¸­å¿ƒåœ°å€-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> é…ç½®SSOè®¤è¯ä¸­å¿ƒåœ°å€ï¼ˆé…ç½®æ–‡ä»¶ï¼‰</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># ç«¯å£</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token comment"># sa-tokené…ç½® </span>
<span class="token key atrule">sa-token</span><span class="token punctuation">:</span>
  <span class="token comment"># SSO-ç›¸å…³é…ç½®</span>
  <span class="token key atrule">sso</span><span class="token punctuation">:</span>
    <span class="token comment"># SSO-Serverç«¯ ç»Ÿä¸€è®¤è¯åœ°å€ </span>
    <span class="token key atrule">auth-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sa<span class="token punctuation">-</span>sso<span class="token punctuation">-</span>server.com<span class="token punctuation">:</span>9000/sso/auth
    <span class="token comment"># æ‰“å¼€å•ç‚¹æ³¨é”€åŠŸèƒ½ </span>
    <span class="token key atrule">is-slo</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

    <span class="token comment"># é…ç½®Sa-Tokenå•ç‹¬ä½¿ç”¨çš„Redisè¿æ¥ ï¼ˆæ­¤å¤„éœ€è¦å’ŒSSO-Serverç«¯è¿æ¥åŒä¸€ä¸ªRedisï¼‰</span>
    <span class="token comment"># å¦‚æœä½ é‚£å•¥è£…äº†aloneçš„è¯</span>
    <span class="token key atrule">alone-redis</span><span class="token punctuation">:</span> 
        <span class="token comment"># Redisæ•°æ®åº“ç´¢å¼• (é»˜è®¤ä¸º0)</span>
        <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token comment"># RedisæœåŠ¡å™¨åœ°å€</span>
        <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
        <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
        <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span>
        <span class="token key atrule">password</span><span class="token punctuation">:</span> 

<span class="token comment"># å¦‚æœæ²¡æœ‰è£…çš„è¯</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># Redisé…ç½® ï¼ˆSSOæ¨¡å¼ä¸€å’Œæ¨¡å¼äºŒä½¿ç”¨Redisæ¥åŒæ­¥ä¼šè¯ï¼‰</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment"># Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token comment"># RedisæœåŠ¡å™¨åœ°å€</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> myserver
    <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">13355</span>
    <span class="token comment"># RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> amayakite
    <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">200</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æµ‹è¯•è®¿é—®" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•è®¿é—®" aria-hidden="true">#</a> æµ‹è¯•è®¿é—®</h3><p>å¯åŠ¨ç±»ç…§å¸¸å†™å³å¯</p><p>ä¾æ¬¡å¯åŠ¨ <code>SSO-Server</code> ä¸ <code>SSO-Client</code>ï¼ˆClientå¯åŠ¨ä¸‰ä¸ª 9001 9002 9003ï¼‰</p>`,21),Z={href:"http://sa-sso-client1.com:9001/",target:"_blank",rel:"noopener noreferrer"},nn=n("p",null,"ç¬¬ä¸€æ¬¡è®¿é—®çš„è¯ ç™¾åˆ†ä¹‹ä¸€åƒæ˜¯false",-1),sn=n("figure",null,[n("img",{src:b,alt:"image-20220121230119402",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20220121230119402")],-1),an=n("p",null,"ç„¶åä½ èµ°ä¸€éç™»é™†æµç¨‹",-1),tn=n("p",null,"å˜æˆtrueäº†",-1),en=n("figure",null,[n("img",{src:g,alt:"image-20220121230137950",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20220121230137950")],-1),pn={href:"http://sa-sso-client1.com:9002/",target:"_blank",rel:"noopener noreferrer"},on=e('<figure><img src="'+h+'" alt="image-20220121230153955" tabindex="0" loading="lazy"><figcaption>image-20220121230153955</figcaption></figure><p>åœ¨è®¿é—®ä¸‹ä¸åŒåŸŸåä¸‹çš„9003</p><figure><img src="'+S+'" alt="image-20220121230303156" tabindex="0" loading="lazy"><figcaption>image-20220121230303156</figcaption></figure><p>ä½ ä¼šå‘ç°æ˜¯falseä½†æ˜¯ï¼Œå½“ç‚¹å‡»ç™»å½•æŒ‰é’®ä¹‹å</p><figure><img src="'+f+'" alt="image-20220121230319911" tabindex="0" loading="lazy"><figcaption>image-20220121230319911</figcaption></figure><p>ç«‹åˆ»å˜æˆtrueäº†ï¼ˆå°±æ˜¯ç‚¹äº†ä¸‹æŒ‰é’®ï¼‰</p><blockquote><p>å¯ä»¥çœ‹å‡ºï¼Œé™¤äº†åœ¨<code>Client1</code>ç«¯æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç™»å½•ä¸€æ¬¡ä¹‹å¤–ï¼Œåœ¨<code>Client2ç«¯</code>å’Œ<code>Client3ç«¯</code>éƒ½æ˜¯å¯ä»¥æ— éœ€å†æ¬¡è®¤è¯ï¼Œç›´æ¥ç™»å½•æˆåŠŸçš„ã€‚</p><p>ä½ å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°è¯·æ±‚è¿‡ç¨‹</p><figure><img src="'+y+`" alt="image-20220121230429840" tabindex="0" loading="lazy"><figcaption>image-20220121230429840</figcaption></figure></blockquote><p>ä»¥ä¸Šæµç¨‹è§£å†³äº†è·¨åŸŸæ¨¡å¼ä¸‹çš„å•ç‚¹ç™»å½•ï¼Œä½†æ˜¯åç«¯ä»ç„¶é‡‡ç”¨äº†å…±äº«Redisæ¥åŒæ­¥ä¼šè¯ï¼Œå¦‚æœæˆ‘ä»¬çš„æ¶æ„è®¾è®¡ä¸­Clientç«¯ä¸Serverç«¯æ— æ³•å…±äº«Redisï¼Œåˆè¯¥æ€ä¹ˆå®Œæˆå•ç‚¹ç™»å½•ï¼Ÿ</p><h2 id="ğŸ‰ğŸ‰åç«¯ä¸åŒ-redis-clientç«¯æ²¡æœ‰redis" tabindex="-1"><a class="header-anchor" href="#ğŸ‰ğŸ‰åç«¯ä¸åŒ-redis-clientç«¯æ²¡æœ‰redis" aria-hidden="true">#</a> ğŸ‰ğŸ‰åç«¯ä¸åŒ Redisï¼ˆClientç«¯æ²¡æœ‰Redisï¼‰</h2><p>å¦‚æœæ—¢æ— æ³•åšåˆ°å‰ç«¯åŒåŸŸï¼Œä¹Ÿæ— æ³•åšåˆ°åç«¯åŒRedisï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ¨¡å¼ä¸‰å®Œæˆå•ç‚¹ç™»å½•</p><blockquote><p>é˜…è¯»æœ¬ç¯‡ä¹‹å‰è¯·åŠ¡å¿…å…ˆç†Ÿè¯»SSOæ¨¡å¼äºŒï¼å› ä¸ºæ¨¡å¼ä¸‰ä»…ä»…å±äºæ¨¡å¼äºŒçš„ä¸€ä¸ªç‰¹æ®Šåœºæ™¯ï¼Œç†Ÿè¯»æ¨¡å¼äºŒæœ‰åŠ©äºæ‚¨å¿«é€Ÿç†è§£æœ¬ç« å†…å®¹</p></blockquote><h3 id="é—®é¢˜åˆ†æ" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜åˆ†æ" aria-hidden="true">#</a> é—®é¢˜åˆ†æ</h3><p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹ï¼Œå½“åç«¯ä¸ä½¿ç”¨å…±äº« Redis æ—¶ï¼Œä¼šå¯¹æ¶æ„äº§ç”Ÿå“ªäº›å½±å“ï¼š</p><ol><li>Client ç«¯æ— æ³•ç›´è¿ Redis æ ¡éªŒ ticketï¼Œå–å‡ºè´¦å·idã€‚</li><li>Client ç«¯æ— æ³•ä¸ Server ç«¯å…±ç”¨ä¸€å¥—ä¼šè¯ï¼Œéœ€è¦è‡ªè¡Œç»´æŠ¤å­ä¼šè¯ã€‚</li><li>ç”±äºä¸æ˜¯ä¸€å¥—ä¼šè¯ï¼Œæ‰€ä»¥æ— æ³•â€œä¸€æ¬¡æ³¨é”€ï¼Œå…¨ç«¯ä¸‹çº¿â€ï¼Œéœ€è¦é¢å¤–ç¼–å†™ä»£ç å®Œæˆå•ç‚¹æ³¨é”€ã€‚</li></ol><p>æ‰€ä»¥æ¨¡å¼ä¸‰çš„ä¸»è¦ç›®æ ‡ï¼šä¹Ÿå°±æ˜¯åœ¨ æ¨¡å¼äºŒçš„åŸºç¡€ä¸Š è§£å†³ä¸Šè¿° ä¸‰ä¸ªéš¾é¢˜</p><h3 id="åœ¨clientç«¯æ›´è¯¥tickeræ ¡éªŒæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#åœ¨clientç«¯æ›´è¯¥tickeræ ¡éªŒæ–¹å¼" aria-hidden="true">#</a> åœ¨Clientç«¯æ›´è¯¥Tickeræ ¡éªŒæ–¹å¼</h3><h4 id="ä¿®æ”¹sso-serverçš„é…ç½®" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹sso-serverçš„é…ç½®" aria-hidden="true">#</a> ä¿®æ”¹SSO-Serverçš„é…ç½®</h4><p>æ‰“å¼€ä¸€ä¸ªï¼Œæ¨¡å¼äºŒä¸å…³</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">sa-token</span><span class="token punctuation">:</span> 
    <span class="token key atrule">sso</span><span class="token punctuation">:</span> 
        <span class="token comment"># æ‰“å¼€æ¨¡å¼ä¸‰ï¼ˆä½¿ç”¨Httpè¯·æ±‚æ ¡éªŒticketï¼‰</span>
        <span class="token key atrule">is-http</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment"># SSO-Serverç«¯ ticketæ ¡éªŒåœ°å€ </span>
        <span class="token key atrule">check-ticket-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sa<span class="token punctuation">-</span>sso<span class="token punctuation">-</span>server.com<span class="token punctuation">:</span>9000/sso/checkTicket

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€ç»ˆåº”è¯¥æ˜¯è¿™æ ·çš„</p><p>æ³¨æ„ è¿™é‡Œé¢å¤–æ·»åŠ äº†ä¸€ä¸ªç§˜é’¥ï¼Œä¹‹åä¼šç”¨åˆ°</p>`,21),cn=n("div",{class:"language-yaml line-numbers-mode","data-ext":"yml"},[n("pre",{yaml:"",class:"language-yaml"},[n("code",null,[n("span",{class:"token comment"},"# ç«¯å£"),s(`
`),n("span",{class:"token key atrule"},"server"),n("span",{class:"token punctuation"},":"),s(`
  `),n("span",{class:"token key atrule"},"port"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"9000"),s(`

`),n("span",{class:"token comment"},"# Sa-Token é…ç½®"),s(`
`),n("span",{class:"token key atrule"},"sa-token"),n("span",{class:"token punctuation"},":"),s(`
  `),n("span",{class:"token comment"},"# é¦–å…ˆæ˜¯æ ‡å‡†é…ç½®"),s(`
  `),n("span",{class:"token comment"},"# tokenåç§° (åŒæ—¶ä¹Ÿæ˜¯cookieåç§°)"),s(`
  `),n("span",{class:"token key atrule"},"token-name"),n("span",{class:"token punctuation"},":"),s(` satoken
  `),n("span",{class:"token comment"},"# tokenæœ‰æ•ˆæœŸï¼Œå•ä½s é»˜è®¤30å¤©, -1ä»£è¡¨æ°¸ä¸è¿‡æœŸ"),s(`
  `),n("span",{class:"token key atrule"},"timeout"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"2592000"),s(`
  `),n("span",{class:"token comment"},"# tokenä¸´æ—¶æœ‰æ•ˆæœŸ (æŒ‡å®šæ—¶é—´å†…æ— æ“ä½œå°±è§†ä¸ºtokenè¿‡æœŸ) å•ä½: ç§’"),s(`
  `),n("span",{class:"token key atrule"},"activity-timeout"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"-1"),s(`
  `),n("span",{class:"token comment"},"# æ˜¯å¦å…è®¸åŒä¸€è´¦å·å¹¶å‘ç™»å½• (ä¸ºtrueæ—¶å…è®¸ä¸€èµ·ç™»å½•, ä¸ºfalseæ—¶æ–°ç™»å½•æŒ¤æ‰æ—§ç™»å½•)"),s(`
  `),n("span",{class:"token key atrule"},"is-concurrent"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"true"),s(`
  `),n("span",{class:"token comment"},"# åœ¨å¤šäººç™»å½•åŒä¸€è´¦å·æ—¶ï¼Œæ˜¯å¦å…±ç”¨ä¸€ä¸ªtoken (ä¸ºtrueæ—¶æ‰€æœ‰ç™»å½•å…±ç”¨ä¸€ä¸ªtoken, ä¸ºfalseæ—¶æ¯æ¬¡ç™»å½•æ–°å»ºä¸€ä¸ªtoken)"),s(`
  `),n("span",{class:"token key atrule"},"is-share"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"false"),s(`
  `),n("span",{class:"token comment"},"# tokené£æ ¼"),s(`
  `),n("span",{class:"token key atrule"},"token-style"),n("span",{class:"token punctuation"},":"),s(` uuid
  `),n("span",{class:"token comment"},"# æ˜¯å¦è¾“å‡ºæ“ä½œæ—¥å¿—"),s(`
  `),n("span",{class:"token key atrule"},"is-log"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"false"),s(`
  `),n("span",{class:"token comment"},"# -------------- SSO-æ¨¡å¼ä¸€ç›¸å…³é…ç½®  (éæ¨¡å¼ä¸€ä¸éœ€è¦é…ç½®) å‰ç«¯åŒåŸŸ + åç«¯åŒ Redis"),s(`
  `),n("span",{class:"token comment"},"# cookie:"),s(`
  `),n("span",{class:"token comment"},"# é…ç½®Cookieä½œç”¨åŸŸ  è¿™é‡Œä¼šå½ªé»„ï¼Œä¸å½±å“ï¼Œæ³¨æ„ï¼Œæ˜¯è¦åœ¨cookieçš„ä¸‹åæ–¹"),s(`
  `),n("span",{class:"token comment"},"# domain: stp.com"),s(`

  `),n("span",{class:"token comment"},"# ------- SSO-æ¨¡å¼äºŒç›¸å…³é…ç½®  å‰ç«¯ä¸åŒåŸŸ + åç«¯åŒ Redis"),s(`
  `),n("span",{class:"token key atrule"},"sso"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Ticketæœ‰æ•ˆæœŸ (å•ä½: ç§’)ï¼Œé»˜è®¤äº”åˆ†é’Ÿ"),s(`
    `),n("span",{class:"token key atrule"},"ticket-timeout"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"300"),s(`
    `),n("span",{class:"token comment"},"# æ‰€æœ‰å…è®¸çš„æˆæƒå›è°ƒåœ°å€"),s(`
    `),n("span",{class:"token key atrule"},"allow-url"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"*"'),s(`
    `),n("span",{class:"token comment"},"# æ˜¯å¦æ‰“å¼€å•ç‚¹æ³¨é”€åŠŸèƒ½"),s(`
    `),n("span",{class:"token key atrule"},"is-slo"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"true"),s(`

    `),n("span",{class:"token comment"},"# ------- SSO-æ¨¡å¼ä¸‰ç›¸å…³é…ç½® å‰ç«¯ä¸åŒåŸŸ + åç«¯ä¸åŒ Redis"),s(`
    `),n("span",{class:"token comment"},"#ï¼ˆä¸‹é¢çš„é…ç½®åœ¨SSOæ¨¡å¼ä¸‰å¹¶ä¸” is-slo=true æ—¶æ‰“å¼€ï¼‰"),s(`
    `),n("span",{class:"token comment"},"# æ˜¯å¦æ‰“å¼€æ¨¡å¼ä¸‰"),s(`
    `),n("span",{class:"token key atrule"},"isHttp"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"true"),s(`
    `),n("span",{class:"token comment"},"# æ¥å£è°ƒç”¨ç§˜é’¥ï¼ˆç”¨äºSSOæ¨¡å¼ä¸‰çš„å•ç‚¹æ³¨é”€åŠŸèƒ½ï¼‰"),s(`
    `),n("span",{class:"token key atrule"},"secretkey"),n("span",{class:"token punctuation"},":"),s(` kQwIOrYvnXmSDkwEiFngrKidMcdrgKor
    `),n("span",{class:"token comment"},"# ---- é™¤äº†ä»¥ä¸Šé…ç½®é¡¹ï¼Œä½ è¿˜éœ€è¦ä¸º Sa-Token é…ç½®httpè¯·æ±‚å¤„ç†å™¨ï¼ˆæ–‡æ¡£æœ‰æ­¥éª¤è¯´æ˜ï¼‰"),s(`

`),n("span",{class:"token key atrule"},"spring"),n("span",{class:"token punctuation"},":"),s(`
  `),n("span",{class:"token comment"},"# Redisé…ç½® ï¼ˆSSOæ¨¡å¼ä¸€å’Œæ¨¡å¼äºŒä½¿ç”¨Redisæ¥åŒæ­¥ä¼šè¯ï¼‰"),s(`
  `),n("span",{class:"token key atrule"},"redis"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰"),s(`
    `),n("span",{class:"token key atrule"},"database"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"1"),s(`
    `),n("span",{class:"token comment"},"# RedisæœåŠ¡å™¨åœ°å€"),s(`
    `),n("span",{class:"token key atrule"},"host"),n("span",{class:"token punctuation"},":"),s(` myserver
    `),n("span",{class:"token comment"},"# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£"),s(`
    `),n("span",{class:"token key atrule"},"port"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"13355"),s(`
    `),n("span",{class:"token comment"},"# RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰"),s(`
    `),n("span",{class:"token key atrule"},"password"),n("span",{class:"token punctuation"},":"),s(` amayakite
    `),n("span",{class:"token comment"},"# è¿æ¥è¶…æ—¶æ—¶é—´"),s(`
    `),n("span",{class:"token key atrule"},"timeout"),n("span",{class:"token punctuation"},":"),s(` 10s
    `),n("span",{class:"token key atrule"},"lettuce"),n("span",{class:"token punctuation"},":"),s(`
      `),n("span",{class:"token key atrule"},"pool"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token comment"},"# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°"),s(`
        `),n("span",{class:"token key atrule"},"max-active"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"200"),s(`
        `),n("span",{class:"token comment"},"# è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰"),s(`
        `),n("span",{class:"token key atrule"},"max-wait"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token punctuation"},"-"),s(`1ms
        `),n("span",{class:"token comment"},"# è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥"),s(`
        `),n("span",{class:"token key atrule"},"max-idle"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"10"),s(`
        `),n("span",{class:"token comment"},"# è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥"),s(`
        `),n("span",{class:"token key atrule"},"min-idle"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"0"),s(`

`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),ln=n("h4",{id:"ä¿®æ”¹sso-serverç«¯çš„controller",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ä¿®æ”¹sso-serverç«¯çš„controller","aria-hidden":"true"},"#"),s(" ä¿®æ”¹SSO-Serverç«¯çš„Controller")],-1),un=n("p",null,"æ–°å¢ä¸€ä¸ªå†…å®¹",-1),rn=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token annotation punctuation"},"@RestController"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"SsoServiceController"),s(),n("span",{class:"token punctuation"},"{"),s(`


    `),n("span",{class:"token annotation punctuation"},"@RequestMapping"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/sso/*"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"Object"),s(),n("span",{class:"token function"},"ssoRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaSsoHandle"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"serverRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


    `),n("span",{class:"token annotation punctuation"},"@Autowired"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"configSso"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"SaTokenConfig"),s(" cfg"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token comment"},"//        é…ç½®ï¼šæœªç™»å½•çš„æ—¶å€™è¿”å›çš„view"),s(`
        cfg`),n("span",{class:"token punctuation"},"."),s("sso"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setNotLoginView"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token class-name"},"String"),s(" msg "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"å½“å‰ä¼šè¯åœ¨SSO-Serverç«¯å°šæœªç™»å½•ï¼Œè¯·å…ˆè®¿é—®"'),s(`
                    `),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},`"<a href='/sso/doLogin?name=user&pwd=123456' target='_blank'> doLoginç™»å½• </a>"`),s(`
                    `),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'"è¿›è¡Œç™»å½•ä¹‹åï¼Œåˆ·æ–°é¡µé¢å¼€å§‹æˆæƒ"'),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"return"),s(" msg"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"//        é…ç½®ï¼šå¤„ç†ç™»é™†å‡½æ•°"),s(`
        cfg`),n("span",{class:"token punctuation"},"."),s("sso"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setDoLoginHandle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("name"),n("span",{class:"token punctuation"},","),s(" pwd"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token comment"},"//           TODO ç›®å‰åªæ˜¯æ¨¡æ‹Ÿç™»é™†ï¼ŒçœŸå®ç™»é™†çš„è¯ï¼Œè¦è¯¥æ”¹æˆé€šè¿‡æ•°æ®åº“æ¥éªŒè¯"),s(`
            `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"user"'),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"equals"),n("span",{class:"token punctuation"},"("),s("name"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token string"},'"123456"'),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"equals"),n("span",{class:"token punctuation"},"("),s("pwd"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token comment"},"//                 æ³¨æ„ è¿™ä¸ªloginéå¸¸éå¸¸éå¸¸é‡è¦ï¼Œä¸€å®šä¸èƒ½å¿˜äº†ã€‚ã€‚"),s(`
                `),n("span",{class:"token class-name"},"StpUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"login"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10001"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"//                è¿™é‡Œè¿”å›å•¥éƒ½è¡Œï¼ˆæ¥æ”¶Objectï¼Œè¿™ä¸ªSaResultç›¸å½“äºæˆ‘ä»¬è‡ªå·±çš„æ‰‹åŠ¨æ“ä¸€ä¸ªè¿”å›å€¼æ¨¡æ¿ä¸€æ ·ï¼‰"),s(`
                `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaResult"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ç™»é™†æˆåŠŸ"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setData"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StpUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getTokenValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaResult"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ç™»é™†å¤±è´¥"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        
`),n("span",{class:"token comment"},"//        é…ç½®HTTPå¤„ç†è¯·æ±‚ï¼ˆåœ¨æ¨¡å¼ä¸‰(å‰ç«¯ä¸åŒåŸŸ + åç«¯ä¸åŒ Redis)çš„å•ç‚¹æ³¨é”€åŠŸèƒ½ä¸‹ç”¨åˆ°ï¼Œå¦‚ä¸éœ€è¦å¯ä»¥æ³¨é‡Šæ‰ï¼‰"),s(`
        cfg`),n("span",{class:"token punctuation"},"."),s("sso"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setSendHttp"),n("span",{class:"token punctuation"},"("),s("url "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"OkHttps"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sync"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBody"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),dn=n("h4",{id:"clientç«¯-controlleræ–°å¢å†…å®¹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#clientç«¯-controlleræ–°å¢å†…å®¹","aria-hidden":"true"},"#"),s(" Clientç«¯-Controlleræ–°å¢å†…å®¹")],-1),kn=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token annotation punctuation"},"@RestController"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"SsoClientController"),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token annotation punctuation"},"@RequestMapping"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"String"),s(),n("span",{class:"token function"},"index"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" str "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"<h2>Sa-Token SSO-Client åº”ç”¨ç«¯</h2>"'),s(),n("span",{class:"token operator"},"+"),s(`
                `),n("span",{class:"token string"},'"<p>å½“å‰ä¼šè¯æ˜¯å¦ç™»å½•ï¼š"'),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token class-name"},"StpUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isLogin"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'"</p>"'),s(),n("span",{class:"token operator"},"+"),s(`
                `),n("span",{class:"token string"},`"<p><a href=\\"javascript:location.href='/sso/login?back=' + encodeURIComponent(location.href);\\">ç™»å½•</a> "`),s(),n("span",{class:"token operator"},"+"),s(`
                `),n("span",{class:"token string"},`"<a href='/sso/logout?back=self'>æ³¨é”€</a></p>"`),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" str"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


    `),n("span",{class:"token annotation punctuation"},"@RequestMapping"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/sso/*"'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"Object"),s(),n("span",{class:"token function"},"ssoRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaSsoHandle"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"clientRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token comment"},"// é…ç½®SSOç›¸å…³å‚æ•°"),s(`
    `),n("span",{class:"token annotation punctuation"},"@Autowired"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"configSso"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"SaTokenConfig"),s(" cfg"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// ... å…¶ä»–ä»£ç "),s(`

        `),n("span",{class:"token comment"},"// é…ç½® Http è¯·æ±‚å¤„ç†å™¨"),s(`
        cfg`),n("span",{class:"token punctuation"},"."),s("sso"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setSendHttp"),n("span",{class:"token punctuation"},"("),s("url "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"OkHttps"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sync"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBody"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


    `),n("span",{class:"token doc-comment comment"},`/**
     * å¼‚å¸¸å¤„ç†
     */`),s(`
    `),n("span",{class:"token annotation punctuation"},"@ExceptionHandler"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"SaResult"),s(),n("span",{class:"token function"},"handlerException"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Exception"),s(" e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        e`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"printStackTrace"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"SaResult"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),s("e"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getMessage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),mn=e(`<h4 id="clientç«¯-yamlé…ç½®" tabindex="-1"><a class="header-anchor" href="#clientç«¯-yamlé…ç½®" aria-hidden="true">#</a> Clientç«¯-yamlé…ç½®</h4><p>é¦–å…ˆåœ¨ymlä¸­æ–°å¢æˆ–è€…å˜åŠ¨æˆå¦‚ä¸‹å†…å®¹ è¿™é‡Œä½ å¯ä»¥æŠŠç›¸å…³çš„å’ŒSa-Tokençš„Redisä¹‹ç±»ä¾èµ–å’Œé…ç½®çš„å»æ‰äº†</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">sa-token</span><span class="token punctuation">:</span>
  <span class="token comment"># SSO-ç›¸å…³é…ç½®</span>
  <span class="token key atrule">sso</span><span class="token punctuation">:</span>
    <span class="token comment"># SSO-Serverç«¯ ç»Ÿä¸€è®¤è¯åœ°å€ </span>
    <span class="token key atrule">auth-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sa<span class="token punctuation">-</span>sso<span class="token punctuation">-</span>server.com<span class="token punctuation">:</span>9000/sso/auth
    <span class="token comment"># ä½¿ç”¨Httpè¯·æ±‚æ ¡éªŒticket </span>
    <span class="token key atrule">is-http</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># SSO-Serverç«¯ ticketæ ¡éªŒåœ°å€ </span>
    <span class="token key atrule">check-ticket-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sa<span class="token punctuation">-</span>sso<span class="token punctuation">-</span>server.com<span class="token punctuation">:</span>9000/sso/checkTicket
    <span class="token comment"># æ‰“å¼€å•ç‚¹æ³¨é”€åŠŸèƒ½ </span>
    <span class="token key atrule">is-slo</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># å•ç‚¹æ³¨é”€åœ°å€ </span>
    <span class="token key atrule">slo-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sa<span class="token punctuation">-</span>sso<span class="token punctuation">-</span>server.com<span class="token punctuation">:</span>9000/sso/logout
     <span class="token comment"># æ¥å£è°ƒç”¨ç§˜é’¥  è¿™ä¸ªåˆ«å¿˜äº†é…</span>
    <span class="token key atrule">secretkey</span><span class="token punctuation">:</span> kQwIOrYvnXmSDkwEiFngrKidMcdrgKor
    <span class="token comment"># SSO-Serverç«¯ æŸ¥è¯¢userinfoåœ°å€ è¿™ä¸ªä¸‹é¢è¦ç”¨åˆ° </span>
    <span class="token key atrule">userinfo-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sa<span class="token punctuation">-</span>sso<span class="token punctuation">-</span>server.com<span class="token punctuation">:</span>9000/sso/userinfo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ–°å¢controller" tabindex="-1"><a class="header-anchor" href="#æ–°å¢controller" aria-hidden="true">#</a> æ–°å¢Controller</h4><p>æ³¨æ„ ç¡®ä¿ä¸Šé¢çš„userinfoé…ç½®å¥½äº†</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æŸ¥è¯¢æˆ‘çš„è´¦å·ä¿¡æ¯ </span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/myinfo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">myinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> userinfo <span class="token operator">=</span> <span class="token class-name">SaSsoUtil</span><span class="token punctuation">.</span><span class="token function">getUserinfo</span><span class="token punctuation">(</span><span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">getLoginId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;--------infoï¼š&quot;</span> <span class="token operator">+</span> userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> userinfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),vn={href:"http://sa-sso-client1.com:9001/sso/myinfo",target:"_blank",rel:"noopener noreferrer"},bn=n("figure",null,[n("img",{src:x,alt:"image-20220121233439308",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20220121233439308")],-1),gn=n("p",null,"è¿™æ ·è¡¨ç¤ºæˆåŠŸ",-1),hn=n("h3",{id:"å¯åŠ¨å¹¶æµ‹è¯•",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#å¯åŠ¨å¹¶æµ‹è¯•","aria-hidden":"true"},"#"),s(" å¯åŠ¨å¹¶æµ‹è¯•")],-1),Sn={href:"http://sa-sso-client1.com:9001/",target:"_blank",rel:"noopener noreferrer"},fn=n("code",null,"å•ç‚¹æ³¨é”€",-1),yn=e('<figure><img src="'+w+'" alt="sso-type3-client-index.png" tabindex="0" loading="lazy"><figcaption>sso-type3-client-index.png</figcaption></figure><p>ç‚¹å‡» <strong><code>[æ³¨é”€]</code></strong> æŒ‰é’®ï¼Œå³å¯å•ç‚¹æ³¨é”€æˆåŠŸã€‚</p><figure><img src="'+q+'" alt="sso-type3-slo-index.png" tabindex="0" loading="lazy"><figcaption>sso-type3-slo-index.png</figcaption></figure><blockquote><p>PSï¼šè¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œä½¿ç”¨çš„æ˜¯è¶…é“¾æ¥è·³é¡µé¢çš„å½¢å¼ï¼Œ<strong>æ­£å¼é¡¹ç›®ä¸­ä½¿ç”¨ Ajax è°ƒç”¨æ¥å£å³å¯åšåˆ°æ— åˆ·å•ç‚¹ç™»å½•é€€å‡º</strong></p></blockquote><figure><img src="'+_+'" alt="image-20220121234154695" tabindex="0" loading="lazy"><figcaption>image-20220121234154695</figcaption></figure><h2 id="ä¸‰ç§é…ç½®æ¨¡å¼çš„æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ä¸‰ç§é…ç½®æ¨¡å¼çš„æ€»ç»“" aria-hidden="true">#</a> ä¸‰ç§é…ç½®æ¨¡å¼çš„æ€»ç»“</h2><p>å½“æˆ‘ä»¬ç†Ÿè¯»ä¸‰ç§æ¨¡å¼çš„å•ç‚¹ç™»å½•ä¹‹åï¼Œå…¶å®ä¸éš¾å‘ç°ï¼šæ‰€è°“å•ç‚¹ç™»å½•ï¼Œå…¶æœ¬è´¨å°±æ˜¯å¤šä¸ªç³»ç»Ÿä¹‹é—´çš„ä¼šè¯å…±äº«ã€‚</p><p>å½“æˆ‘ä»¬ç†è§£è¿™ä¸€ç‚¹ä¹‹åï¼Œä¸‰ç§æ¨¡å¼çš„å·¥ä½œåŸç†ä¹Ÿæµ®å‡ºæ°´é¢ï¼š</p><ul><li>æ¨¡å¼ä¸€ï¼šé‡‡ç”¨å…±äº« Cookie æ¥åšåˆ°å‰ç«¯ Token çš„å…±äº«ï¼Œä»è€Œè¾¾åˆ°åç«¯çš„ Session ä¼šè¯å…±äº«ã€‚ <ul><li>è¿™ä¸ªæ²¡å¤šå°‘äººç”¨äº†</li></ul></li><li>æ¨¡å¼äºŒï¼šé‡‡ç”¨ URL é‡å®šå‘ï¼Œä»¥ ticket ç ä¸ºæˆæƒä¸­ä»‹ï¼Œåšåˆ°å¤šä¸ªç³»ç»Ÿé—´çš„ä¼šè¯ä¼ æ’­ã€‚ <ul><li>è¿™ä¸ªä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ çš„å¾®æœåŠ¡æ„¿æ„æ¥å—å…¨éƒ½è£…ä¸Šé‚£å•¥Sa-Tokençš„è¯å°±å¯ä»¥</li></ul></li><li>æ¨¡å¼ä¸‰ï¼šé‡‡ç”¨ Http è¯·æ±‚ä¸»åŠ¨æŸ¥è¯¢ä¼šè¯ï¼Œåšåˆ° Client ç«¯ä¸ Server ç«¯çš„ä¼šè¯åŒæ­¥ã€‚ <ul><li>å½“ä½  å¾®æœåŠ¡çš„æœåŠ¡ç«¯ä¸æƒ³è£…ä¸Šå’ŒSa-Tokené…å¥—çš„Redisçš„æ—¶å€™ç”¨è¿™ä¸ª</li></ul></li></ul><h2 id="ğŸ‰é…ç½®åŸŸåæ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#ğŸ‰é…ç½®åŸŸåæ ¡éªŒ" aria-hidden="true">#</a> ğŸ‰é…ç½®åŸŸåæ ¡éªŒ</h2><h3 id="ç›®å‰å­˜åœ¨çš„æ¼æ´" tabindex="-1"><a class="header-anchor" href="#ç›®å‰å­˜åœ¨çš„æ¼æ´" aria-hidden="true">#</a> ç›®å‰å­˜åœ¨çš„æ¼æ´</h3><p>åœ¨å‰é¢ç« èŠ‚çš„ SSO-Server ç¤ºä¾‹ä¸­ï¼Œé…ç½®é¡¹ <code>sa-token.sso.allow-url=*</code> æ„ä¸ºé…ç½®æ‰€æœ‰å…è®¸çš„Clientç«¯æˆæƒåœ°å€ï¼Œä¸åœ¨æ­¤é…ç½®é¡¹ä¸­çš„URLå°†æ— æ³•å•ç‚¹ç™»å½•æˆåŠŸ</p><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œä¸Šè¿°ä»£ç å°†å…¶é…ç½®ä¸º<code>*</code>ï¼Œä½†æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ­¤é…ç½®é¡¹ç»å¯¹ä¸èƒ½é…ç½®ä¸º * ï¼Œå¦åˆ™ä¼šæœ‰è¢« Ticket åŠ«æŒçš„é£é™©</p><p>å‡è®¾æ”»å‡»è€…æ ¹æ®æ¨¡ä»¿æˆ‘ä»¬çš„æˆæƒåœ°å€ï¼Œå·§å¦™çš„æ„é€ ä¸€ä¸ªURL</p>',14),xn={href:"http://sa-sso-server.com:9000/sso/auth?redirect=https://www.baidu.com/",target:"_blank",rel:"noopener noreferrer"},wn=e('<p>è¿™ä¸ªæ—¶å€™ä¸çŸ¥æƒ…çš„ç”¨æˆ·è®¿é—®åˆ°äº†è¿™ä¸ªURLçš„æ—¶å€™ï¼Œå®ƒå°†è¢«é‡å®šå‘è‡³ç™¾åº¦é¦–é¡µ</p><figure><img src="'+R+'" alt="image-20220121234818516" tabindex="0" loading="lazy"><figcaption>image-20220121234818516</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä»£è¡¨ç€ç”¨æˆ·èº«ä»½çš„ Ticket ç ä¹Ÿæ˜¾ç°åˆ°äº†URLä¹‹ä¸­ï¼Œå€Ÿæ­¤æ¼æ´ï¼Œæ”»å‡»è€…å®Œå…¨å¯ä»¥æ„å»ºä¸€ä¸ªURLå°†å°çº¢çš„ Ticket ç è‡ªåŠ¨æäº¤åˆ°æ”»å‡»è€…è‡ªå·±çš„æœåŠ¡å™¨ï¼Œä¼ªé€ å°çº¢èº«ä»½ç™»å½•ç½‘ç«™</p><h3 id="é˜²èŒƒæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#é˜²èŒƒæ–¹æ³•" aria-hidden="true">#</a> é˜²èŒƒæ–¹æ³•</h3><p>é€ æˆæ­¤æ¼æ´çš„ç›´æ¥åŸå› å°±æ˜¯SSO-Serverè®¤è¯ä¸­å¿ƒæ²¡æœ‰å¯¹ <code>redirectåœ°å€</code> è¿›è¡Œä»»ä½•çš„é™åˆ¶ï¼Œé˜²èŒƒçš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å¯¹<code>redirectå‚æ•°</code>è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœå…¶ä¸åœ¨æŒ‡å®šçš„URLåˆ—è¡¨ä¸­æ—¶ï¼Œæ‹’ç»ä¸‹æ”¾ticket</p><p>æˆ‘ä»¬å°†å…¶é…ç½®ä¸ºä¸€ä¸ªå…·ä½“çš„URLï¼š<code>allow-url=http://sa-sso-client1.com:9001/sso/login</code></p>',6),qn=n("div",{class:"language-yaml line-numbers-mode","data-ext":"yml"},[n("pre",{yaml:"",class:"language-yaml"},[n("code",null,[n("span",{class:"token comment"},"# serverç«¯"),s(`
`),n("span",{class:"token comment"},"# ç«¯å£"),s(`
`),n("span",{class:"token key atrule"},"server"),n("span",{class:"token punctuation"},":"),s(`
  `),n("span",{class:"token key atrule"},"port"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"9000"),s(`

`),n("span",{class:"token comment"},"# Sa-Token é…ç½®"),s(`
`),n("span",{class:"token key atrule"},"sa-token"),n("span",{class:"token punctuation"},":"),s(`
  `),n("span",{class:"token comment"},"# é¦–å…ˆæ˜¯æ ‡å‡†é…ç½®"),s(`
  `),n("span",{class:"token comment"},"# tokenåç§° (åŒæ—¶ä¹Ÿæ˜¯cookieåç§°)"),s(`
  `),n("span",{class:"token key atrule"},"token-name"),n("span",{class:"token punctuation"},":"),s(` satoken
  `),n("span",{class:"token comment"},"# tokenæœ‰æ•ˆæœŸï¼Œå•ä½s é»˜è®¤30å¤©, -1ä»£è¡¨æ°¸ä¸è¿‡æœŸ"),s(`
  `),n("span",{class:"token key atrule"},"timeout"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"2592000"),s(`
  `),n("span",{class:"token comment"},"# tokenä¸´æ—¶æœ‰æ•ˆæœŸ (æŒ‡å®šæ—¶é—´å†…æ— æ“ä½œå°±è§†ä¸ºtokenè¿‡æœŸ) å•ä½: ç§’"),s(`
  `),n("span",{class:"token key atrule"},"activity-timeout"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"-1"),s(`
  `),n("span",{class:"token comment"},"# æ˜¯å¦å…è®¸åŒä¸€è´¦å·å¹¶å‘ç™»å½• (ä¸ºtrueæ—¶å…è®¸ä¸€èµ·ç™»å½•, ä¸ºfalseæ—¶æ–°ç™»å½•æŒ¤æ‰æ—§ç™»å½•)"),s(`
  `),n("span",{class:"token key atrule"},"is-concurrent"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"true"),s(`
  `),n("span",{class:"token comment"},"# åœ¨å¤šäººç™»å½•åŒä¸€è´¦å·æ—¶ï¼Œæ˜¯å¦å…±ç”¨ä¸€ä¸ªtoken (ä¸ºtrueæ—¶æ‰€æœ‰ç™»å½•å…±ç”¨ä¸€ä¸ªtoken, ä¸ºfalseæ—¶æ¯æ¬¡ç™»å½•æ–°å»ºä¸€ä¸ªtoken)"),s(`
  `),n("span",{class:"token key atrule"},"is-share"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"false"),s(`
  `),n("span",{class:"token comment"},"# tokené£æ ¼"),s(`
  `),n("span",{class:"token key atrule"},"token-style"),n("span",{class:"token punctuation"},":"),s(` uuid
  `),n("span",{class:"token comment"},"# æ˜¯å¦è¾“å‡ºæ“ä½œæ—¥å¿—"),s(`
  `),n("span",{class:"token key atrule"},"is-log"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"false"),s(`

  `),n("span",{class:"token comment"},"# ------- SSO-æ¨¡å¼äºŒç›¸å…³é…ç½®  å‰ç«¯ä¸åŒåŸŸ + åç«¯åŒ Redis"),s(`
  `),n("span",{class:"token key atrule"},"sso"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Ticketæœ‰æ•ˆæœŸ (å•ä½: ç§’)ï¼Œé»˜è®¤äº”åˆ†é’Ÿ"),s(`
    `),n("span",{class:"token key atrule"},"ticket-timeout"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"300"),s(`
    `),n("span",{class:"token comment"},"# æ‰€æœ‰å…è®¸çš„æˆæƒå›è°ƒåœ°å€"),s(`
    `),n("span",{class:"token key atrule"},"allow-url"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"http://sa-sso-client1.com:9001"'),s(`
    `),n("span",{class:"token comment"},"# æ˜¯å¦æ‰“å¼€å•ç‚¹æ³¨é”€åŠŸèƒ½"),s(`
    `),n("span",{class:"token key atrule"},"is-slo"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"true"),s(`

    `),n("span",{class:"token comment"},"# ------- SSO-æ¨¡å¼ä¸‰ç›¸å…³é…ç½® å‰ç«¯ä¸åŒåŸŸ + åç«¯ä¸åŒ Redis"),s(`
    `),n("span",{class:"token comment"},"#ï¼ˆä¸‹é¢çš„é…ç½®åœ¨SSOæ¨¡å¼ä¸‰å¹¶ä¸” is-slo=true æ—¶æ‰“å¼€ï¼‰"),s(`
    `),n("span",{class:"token comment"},"# æ˜¯å¦æ‰“å¼€æ¨¡å¼ä¸‰"),s(`
    `),n("span",{class:"token key atrule"},"isHttp"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean important"},"true"),s(`
    `),n("span",{class:"token comment"},"# æ¥å£è°ƒç”¨ç§˜é’¥ï¼ˆç”¨äºSSOæ¨¡å¼ä¸‰çš„å•ç‚¹æ³¨é”€åŠŸèƒ½ï¼‰"),s(`
    `),n("span",{class:"token key atrule"},"secretkey"),n("span",{class:"token punctuation"},":"),s(` kQwIOrYvnXmSDkwEiFngrKidMcdrgKor
    `),n("span",{class:"token comment"},"# ---- é™¤äº†ä»¥ä¸Šé…ç½®é¡¹ï¼Œä½ è¿˜éœ€è¦ä¸º Sa-Token é…ç½®httpè¯·æ±‚å¤„ç†å™¨ï¼ˆæ–‡æ¡£æœ‰æ­¥éª¤è¯´æ˜ï¼‰"),s(`

`),n("span",{class:"token key atrule"},"spring"),n("span",{class:"token punctuation"},":"),s(`
  `),n("span",{class:"token comment"},"# Redisé…ç½® ï¼ˆSSOæ¨¡å¼ä¸€å’Œæ¨¡å¼äºŒä½¿ç”¨Redisæ¥åŒæ­¥ä¼šè¯ï¼‰"),s(`
  `),n("span",{class:"token key atrule"},"redis"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token comment"},"# Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰"),s(`
    `),n("span",{class:"token key atrule"},"database"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"1"),s(`
    `),n("span",{class:"token comment"},"# RedisæœåŠ¡å™¨åœ°å€"),s(`
    `),n("span",{class:"token key atrule"},"host"),n("span",{class:"token punctuation"},":"),s(` myserver
    `),n("span",{class:"token comment"},"# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£"),s(`
    `),n("span",{class:"token key atrule"},"port"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"13355"),s(`
    `),n("span",{class:"token comment"},"# RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰"),s(`
    `),n("span",{class:"token key atrule"},"password"),n("span",{class:"token punctuation"},":"),s(` amayakite
    `),n("span",{class:"token comment"},"# è¿æ¥è¶…æ—¶æ—¶é—´"),s(`
    `),n("span",{class:"token key atrule"},"timeout"),n("span",{class:"token punctuation"},":"),s(` 10s
    `),n("span",{class:"token key atrule"},"lettuce"),n("span",{class:"token punctuation"},":"),s(`
      `),n("span",{class:"token key atrule"},"pool"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token comment"},"# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°"),s(`
        `),n("span",{class:"token key atrule"},"max-active"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"200"),s(`
        `),n("span",{class:"token comment"},"# è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰"),s(`
        `),n("span",{class:"token key atrule"},"max-wait"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token punctuation"},"-"),s(`1ms
        `),n("span",{class:"token comment"},"# è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥"),s(`
        `),n("span",{class:"token key atrule"},"max-idle"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"10"),s(`
        `),n("span",{class:"token comment"},"# è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥"),s(`
        `),n("span",{class:"token key atrule"},"min-idle"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token number"},"0"),s(`

`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_n=n("p",null,"å†æ¬¡è®¿é—®ä¸Šè¿°è¿æ¥ï¼š",-1),Rn={href:"http://sa-sso-server.com:9000/sso/auth?redirect=https://www.baidu.com/",target:"_blank",rel:"noopener noreferrer"},Cn=e('<p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹</p><figure><img src="'+C+`" alt="image-20220121235128539" tabindex="0" loading="lazy"><figcaption>image-20220121235128539</figcaption></figure><p>åŸŸåæ²¡æœ‰é€šè¿‡æ ¡éªŒï¼Œæ‹’ç»æˆæƒ</p><h3 id="ğŸ‰é…ç½®å®‰å…¨æ€§å‚è€ƒè¡¨" tabindex="-1"><a class="header-anchor" href="#ğŸ‰é…ç½®å®‰å…¨æ€§å‚è€ƒè¡¨" aria-hidden="true">#</a> ğŸ‰é…ç½®å®‰å…¨æ€§å‚è€ƒè¡¨</h3><table><thead><tr><th>é…ç½®æ–¹å¼</th><th>ä¸¾ä¾‹</th><th>å®‰å…¨æ€§</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>é…ç½®ä¸º*</td><td><code>*</code></td><td>ä½</td><td><strong>ç¦æ­¢åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨</strong></td></tr><tr><td>é…ç½®åˆ°åŸŸå</td><td><code>http://sa-sso-client1.com/*</code></td><td>ä¸­</td><td>ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨</td></tr><tr><td>é…ç½®åˆ°è¯¦ç»†åœ°å€</td><td><code>http://sa-sso-client1.com:9001/sso/login</code></td><td>é«˜</td><td>å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨</td></tr></tbody></table><blockquote><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥å›ä¼ -tokenï¼Œè€Œæ˜¯å…ˆå›ä¼ -ticketï¼Œå†ç”¨-ticket-å»æŸ¥è¯¢å¯¹åº”çš„è´¦å·idï¼Ÿ</p><p>Token ä½œä¸ºé•¿æ—¶é—´æœ‰æ•ˆçš„ä¼šè¯å‡­è¯ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½ä¸åº”è¯¥ç›´æ¥æš´éœ²åœ¨ URL ä¹‹ä¸­ï¼ˆè™½ç„¶ Token ç›´æ¥çš„æš´éœ²æœ¬èº«ä¸ä¼šé€ æˆå®‰å…¨æ¼æ´ï¼Œä½†ä¼šä¸ºå¾ˆå¤šæ¼æ´æä¾›å¯ä¹˜ä¹‹æœºï¼‰</p><p>ä¸ºäº†ä¸è®©ç³»ç»Ÿå®‰å…¨å¤„äºäºšå¥åº·çŠ¶æ€ï¼ŒSa-Token-SSO é€‰æ‹©å…ˆå›ä¼  Ticketï¼Œå†ç”± Ticket è·å–è´¦å·idï¼Œä¸” Ticket ä¸€æ¬¡æ€§ç”¨å®Œå³åºŸï¼Œæé«˜å®‰å…¨æ€§ã€‚</p></blockquote><h2 id="å®šåˆ¶åŒ–ç™»é™†ç•Œé¢" tabindex="-1"><a class="header-anchor" href="#å®šåˆ¶åŒ–ç™»é™†ç•Œé¢" aria-hidden="true">#</a> å®šåˆ¶åŒ–ç™»é™†ç•Œé¢</h2><h3 id="ä½•æ—¶å¼•å¯¼ç”¨æˆ·å»ç™»é™†" tabindex="-1"><a class="header-anchor" href="#ä½•æ—¶å¼•å¯¼ç”¨æˆ·å»ç™»é™†" aria-hidden="true">#</a> ä½•æ—¶å¼•å¯¼ç”¨æˆ·å»ç™»é™†</h3><h4 id="å‰ç«¯æŒ‰é’®è·³è½¬" tabindex="-1"><a class="header-anchor" href="#å‰ç«¯æŒ‰é’®è·³è½¬" aria-hidden="true">#</a> å‰ç«¯æŒ‰é’®è·³è½¬</h4><p>å‰ç«¯é¡µé¢å‡†å¤‡ä¸€ä¸ª**<code>[ç™»å½•]</code>**æŒ‰é’®ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œè·³è½¬åˆ°ç™»å½•æ¥å£</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:location.href=&#39;/sso/login?back=&#39; + encodeURIComponent(location.href);<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç™»å½•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åç«¯æ‹¦æˆªé‡å®šå‘" tabindex="-1"><a class="header-anchor" href="#åç«¯æ‹¦æˆªé‡å®šå‘" aria-hidden="true">#</a> åç«¯æ‹¦æˆªé‡å®šå‘</h4><p>åœ¨åç«¯æ³¨å†Œå…¨å±€è¿‡æ»¤å™¨ï¼ˆæˆ–æ‹¦æˆªå™¨ã€æˆ–å…¨å±€å¼‚å¸¸å¤„ç†ï¼‰ï¼Œæ‹¦æˆªéœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®çš„é¡µé¢èµ„æºï¼Œå°†æœªç™»å½•çš„è®¿é—®é‡å®šå‘è‡³ç™»å½•æ¥å£</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Sa-Token é…ç½®ç±» 
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaTokenConfigure</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** æ³¨å†Œ [Sa-Tokenå…¨å±€è¿‡æ»¤å™¨] */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SaServletFilter</span> <span class="token function">getSaServletFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SaServletFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addInclude</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addExclude</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/favicon.ico&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setAuth</span><span class="token punctuation">(</span>obj <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> back <span class="token operator">=</span> <span class="token class-name">SaFoxUtil</span><span class="token punctuation">.</span><span class="token function">joinParam</span><span class="token punctuation">(</span><span class="token class-name">SaHolder</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SpringMVCUtil</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">SaHolder</span><span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/login?back=&quot;</span> <span class="token operator">+</span> <span class="token class-name">SaFoxUtil</span><span class="token punctuation">.</span><span class="token function">encodeUrl</span><span class="token punctuation">(</span>back<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">SaRouter</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ‰æ¨è-åç«¯æ‹¦æˆª-å‰ç«¯è·³è½¬" tabindex="-1"><a class="header-anchor" href="#ğŸ‰æ¨è-åç«¯æ‹¦æˆª-å‰ç«¯è·³è½¬" aria-hidden="true">#</a> ğŸ‰æ¨èï¼šåç«¯æ‹¦æˆª-å‰ç«¯è·³è½¬</h4><p>é¦–å…ˆï¼Œåç«¯ä»éœ€è¦æä¾›æ‹¦æˆªï¼Œä½†æ˜¯ä¸ç›´æ¥å¼•å¯¼ç”¨æˆ·é‡å®šå‘ï¼Œè€Œæ˜¯è¿”å›æœªç™»å½•çš„æç¤ºä¿¡æ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Sa-Token é…ç½®ç±» 
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaTokenConfigure</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** æ³¨å†Œ [Sa-Tokenå…¨å±€è¿‡æ»¤å™¨] */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SaServletFilter</span> <span class="token function">getSaServletFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SaServletFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addInclude</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addExclude</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/favicon.ico&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setAuth</span><span class="token punctuation">(</span>obj <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// ä¸å‰ç«¯çº¦å®šå¥½ï¼Œcode=401æ—¶ä»£è¡¨ä¼šè¯æœªç™»å½• </span>
                        <span class="token class-name">SaRouter</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰ç«¯æ¥å—åˆ°è¿”å›ç»“æœ <code>code=401</code> æ—¶ï¼Œå¼€å§‹è·³è½¬è‡³ç™»å½•æ¥å£</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&#39;/sso/login?back=&#39;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒé€‚åˆä»¥ Ajax è®¿é—®çš„ RestAPI æ¥å£é‡å®šå‘</p><h3 id="å¦‚ä½•è‡ªå®šä¹‰ç™»é™†apiçš„åœ°å€" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è‡ªå®šä¹‰ç™»é™†apiçš„åœ°å€" aria-hidden="true">#</a> å¦‚ä½•è‡ªå®šä¹‰ç™»é™†APIçš„åœ°å€</h3><h4 id="å¦‚æœåªæ˜¯æƒ³åœ¨-setdologinhandle-å‡½æ•°é‡Œè·å–é™¤-nameã€pwd-ä»¥å¤–çš„å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å¦‚æœåªæ˜¯æƒ³åœ¨-setdologinhandle-å‡½æ•°é‡Œè·å–é™¤-nameã€pwd-ä»¥å¤–çš„å‚æ•°" aria-hidden="true">#</a> å¦‚æœåªæ˜¯æƒ³åœ¨-setdologinhandle-å‡½æ•°é‡Œè·å–é™¤-nameã€pwd-ä»¥å¤–çš„å‚æ•°</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åœ¨ä»»æ„ä»£ç å¤„è·å–å‰ç«¯æäº¤çš„å‚æ•° </span>
<span class="token class-name">String</span> xxx <span class="token operator">=</span> <span class="token class-name">SaHolder</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParam</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æƒ³å®Œå…¨è‡ªå®šä¹‰ä¸€ä¸ªæ¥å£æ¥æ¥å—å‰ç«¯ç™»å½•è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#æƒ³å®Œå…¨è‡ªå®šä¹‰ä¸€ä¸ªæ¥å£æ¥æ¥å—å‰ç«¯ç™»å½•è¯·æ±‚" aria-hidden="true">#</a> æƒ³å®Œå…¨è‡ªå®šä¹‰ä¸€ä¸ªæ¥å£æ¥æ¥å—å‰ç«¯ç™»å½•è¯·æ±‚</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ç›´æ¥å®šä¹‰ä¸€ä¸ªæ‹¦æˆªè·¯ç”±ä¸º \`/sso/doLogin\` çš„æ¥å£å³å¯ </span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/doLogin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SaResult</span> <span class="token function">ss</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------ è¯·æ±‚è¿›å…¥äº†è‡ªå®šä¹‰çš„APIæ¥å£ ---------- &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;sa&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;ç™»å½•æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ç™»å½•å¤±è´¥ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ‰è‡ªå®šä¹‰apiçš„è·¯ç”±" tabindex="-1"><a class="header-anchor" href="#ğŸ‰è‡ªå®šä¹‰apiçš„è·¯ç”±" aria-hidden="true">#</a> ğŸ‰è‡ªå®šä¹‰APIçš„è·¯ç”±</h2><h3 id="ä¿®æ”¹å…¨å±€å˜é‡çš„æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹å…¨å±€å˜é‡çš„æ–¹å¼" aria-hidden="true">#</a> ä¿®æ”¹å…¨å±€å˜é‡çš„æ–¹å¼</h3><p>åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•æ­å»ºä¸€ä¸ªSSOè®¤è¯ä¸­å¿ƒ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Sa-Token-SSO Serverç«¯ Controller 
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SsoServerController</span> <span class="token punctuation">{</span>

    <span class="token comment">// SSO-Serverç«¯ï¼šå¤„ç†æ‰€æœ‰SSOç›¸å…³è¯·æ±‚ </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/*&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">ssoRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SaSsoHandle</span><span class="token punctuation">.</span><span class="token function">serverRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ... å…¶å®ƒä»£ç </span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§å†™æ³•é›†æˆç®€å•ä½†å´ä¸å¤Ÿçµæ´»ã€‚ä¾‹å¦‚è®¤è¯ä¸­å¿ƒåœ°å€åªèƒ½æ˜¯ï¼š<code>http://{host}:{port}/sso/auth</code>ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰å…¶APIåœ°å€ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>`,30),On={href:"https://gitee.com/dromara/sa-token/blob/master/sa-token-core/src/main/java/cn/dev33/satoken/sso/SaSsoConsts.java",target:"_blank",rel:"noopener noreferrer"},Tn=n("code",null,"final",-1),jn=e(`<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Main æ–¹æ³•å¯åŠ¨ç±»æˆ–è€… SSO é…ç½®æ–¹æ³•ä¸­ä¿®æ”¹å˜é‡å€¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// é…ç½®SSOç›¸å…³å‚æ•° </span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">configSso</span><span class="token punctuation">(</span><span class="token class-name">SaTokenConfig</span> cfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è‡ªå®šä¹‰APIåœ°å€</span>
    <span class="token class-name">SaSsoConsts<span class="token punctuation">.</span>Api</span><span class="token punctuation">.</span>ssoAuth <span class="token operator">=</span> <span class="token string">&quot;/sso/auth2&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// ... </span>

    <span class="token comment">// SSO ç›¸å…³é…ç½®</span>
    cfg<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>setXxx <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨é¡¹ç›®ï¼Œç»Ÿä¸€è®¤è¯åœ°å€å°±è¢«æˆ‘ä»¬ä¿®æ”¹æˆäº†ï¼š<code>http://{host}:{port}/sso/auth2</code></p><h3 id="æ‹†åˆ†è·¯ç”±å…¥å£çš„æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#æ‹†åˆ†è·¯ç”±å…¥å£çš„æ–¹å¼" aria-hidden="true">#</a> æ‹†åˆ†è·¯ç”±å…¥å£çš„æ–¹å¼</h3><p>æ ¹æ®ä¸Šè¿°è·¯ç”±å…¥å£ï¼š<code>@RequestMapping(&quot;/sso/*&quot;)</code>ï¼Œæˆ‘ä»¬ç»™å®ƒèµ·ä¸€ä¸ªåˆé€‚çš„åå­— â€”â€” èšåˆå¼è·¯ç”±ã€‚</p><p>ä¸ä¹‹å¯¹åº”çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¿®æ”¹ä¸ºæ‹†åˆ†å¼è·¯ç”±ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Sa-Token-SSO Serverç«¯ Controller 
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SsoServerController</span> <span class="token punctuation">{</span>

    <span class="token comment">// SSO-Serverï¼šç»Ÿä¸€è®¤è¯åœ°å€ </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/auth&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">ssoAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SaSsoHandle</span><span class="token punctuation">.</span><span class="token function">ssoAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// SSO-Serverï¼šRestAPI ç™»å½•æ¥å£ </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/doLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">ssoDoLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SaSsoHandle</span><span class="token punctuation">.</span><span class="token function">ssoDoLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// SSO-Serverï¼šæ ¡éªŒticket è·å–è´¦å·id </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/checkTicket&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">ssoCheckTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SaSsoHandle</span><span class="token punctuation">.</span><span class="token function">ssoCheckTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// SSO-Serverï¼šå•ç‚¹æ³¨é”€ </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sso/logout&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">ssoLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SaSsoHandle</span><span class="token punctuation">.</span><span class="token function">ssoServerLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ... å…¶å®ƒæ–¹æ³• </span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‹†åˆ†å¼è·¯ç”± ä¸ èšåˆå¼è·¯ç”± åœ¨åŠŸèƒ½ä¸Šå®Œå…¨ç­‰ä»·ï¼Œä¸”æä¾›äº†æ›´ä¸ºç»†è‡´çš„è·¯ç”±ç®¡æ§ã€‚</p><h2 id="ğŸ‰å‰åç«¯åˆ†ç¦»çš„æ•´åˆæ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ‰å‰åç«¯åˆ†ç¦»çš„æ•´åˆæ–¹æ¡ˆ" aria-hidden="true">#</a> ğŸ‰å‰åç«¯åˆ†ç¦»çš„æ•´åˆæ–¹æ¡ˆ</h2><p>ä¹‹å‰çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯å‰åç«¯ä¸åˆ†ç¦»ï¼šæœåŠ¡å™¨æ¸²æŸ“äº†htmlé¡µé¢</p><p>è¿™é‡Œä»¥æ”¹é€ æ¡ˆä¾‹2(Clientç«¯)ä¸ºä¾‹</p><h3 id="æ–°å¢h5controlleræ¥å£" tabindex="-1"><a class="header-anchor" href="#æ–°å¢h5controlleræ¥å£" aria-hidden="true">#</a> æ–°å¢H5Controlleræ¥å£</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å‰åå°åˆ†ç¦»æ¶æ„ä¸‹é›†æˆSSOæ‰€éœ€çš„ä»£ç  
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">H5Controller</span> <span class="token punctuation">{</span>

    <span class="token comment">// å½“å‰æ˜¯å¦ç™»å½• </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/isLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¿”å›SSOè®¤è¯ä¸­å¿ƒç™»å½•åœ°å€ </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/getSsoAuthUrl&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SaResult</span> <span class="token function">getSsoAuthUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> clientLoginUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> serverAuthUrl <span class="token operator">=</span> <span class="token class-name">SaSsoUtil</span><span class="token punctuation">.</span><span class="token function">buildServerAuthUrl</span><span class="token punctuation">(</span>clientLoginUrl<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>serverAuthUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ ¹æ®ticketè¿›è¡Œç™»å½• </span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/doLoginByTicket&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SaResult</span> <span class="token function">doLoginByTicket</span><span class="token punctuation">(</span><span class="token class-name">String</span> ticket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> loginId <span class="token operator">=</span> <span class="token class-name">SaSsoHandle</span><span class="token punctuation">.</span><span class="token function">checkTicket</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span> <span class="token string">&quot;/doLoginByTicket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>loginId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>loginId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">getTokenValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ— æ•ˆticketï¼š&quot;</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// å…¨å±€å¼‚å¸¸æ‹¦æˆª </span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token keyword">public</span> <span class="token class-name">SaResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¢åŠ è·¨åŸŸè¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#å¢åŠ è·¨åŸŸè¿‡æ»¤å™¨" aria-hidden="true">#</a> å¢åŠ è·¨åŸŸè¿‡æ»¤å™¨</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>pj<span class="token punctuation">.</span>h5</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">Filter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * è·¨åŸŸè¿‡æ»¤å™¨
 * <span class="token keyword">@author</span> kong 
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

	<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">OPTIONS</span> <span class="token operator">=</span> <span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
		<span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span>
		
		<span class="token comment">// å…è®¸æŒ‡å®šåŸŸè®¿é—®è·¨åŸŸèµ„æº</span>
		response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// å…è®¸æ‰€æœ‰è¯·æ±‚æ–¹å¼</span>
		response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST, GET, OPTIONS, DELETE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// æœ‰æ•ˆæ—¶é—´</span>
		response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Max-Age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3600&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// å…è®¸çš„headerå‚æ•°</span>
		response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;x-requested-with,satoken&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// å¦‚æœæ˜¯é¢„æ£€è¯·æ±‚ï¼Œç›´æ¥è¿”å›</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">OPTIONS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=======================æµè§ˆå™¨å‘æ¥äº†OPTIONSé¢„æ£€è¯·æ±‚==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// System.out.println(&quot;*********************************è¿‡æ»¤å™¨è¢«ä½¿ç”¨**************************&quot;);</span>
		chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ”¹é€ serverç«¯" tabindex="-1"><a class="header-anchor" href="#æ”¹é€ serverç«¯" aria-hidden="true">#</a> æ”¹é€ Serverç«¯</h3><p>ç–‘é—®ï¼šä¸Šè¿°ä»£ç éƒ½æ˜¯é’ˆå¯¹ Client ç«¯è¿›è¡Œæ‹†åˆ†ï¼Œå¦‚æœæˆ‘æƒ³åœ¨ SSO-Server ç«¯ä¹Ÿè¿›è¡Œå‰åå°åˆ†ç¦»æ”¹é€ ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ</p><blockquote><p>ç­”ï¼šè§£å†³æ€è·¯éƒ½æ˜¯å¤§åŒå°å¼‚çš„ï¼Œä¸Clientä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠåŸæœ¬åœ¨ â€œåç«¯å¤„ç†çš„æˆæƒé‡å®šå‘é€»è¾‘â€ æ‹¿åˆ°å‰ç«¯æ¥å®ç°</p></blockquote><p>è·¨åŸŸå’Œä¸Šé¢ä½ çš„ä¸€æ ·ï¼Œæ”¹ä¸€æ”¹Controller</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">H5Controller</span> <span class="token punctuation">{</span>
	
	<span class="token doc-comment comment">/**
	 * è·å– redirectUrl 
	 */</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/getRedirectUrl&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">getRedirectUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> redirect<span class="token punctuation">,</span> <span class="token class-name">String</span> mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// æœªç™»å½•æƒ…å†µä¸‹ï¼Œè¿”å› code=401 </span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å·²ç™»å½•æƒ…å†µä¸‹ï¼Œæ„å»º redirectUrl </span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">SaSsoConsts</span><span class="token punctuation">.</span><span class="token constant">MODE_SIMPLE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// æ¨¡å¼ä¸€ </span>
			<span class="token class-name">SaSsoUtil</span><span class="token punctuation">.</span><span class="token function">checkRedirectUrl</span><span class="token punctuation">(</span><span class="token class-name">SaFoxUtil</span><span class="token punctuation">.</span><span class="token function">decoderUrl</span><span class="token punctuation">(</span>redirect<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>redirect<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// æ¨¡å¼äºŒæˆ–æ¨¡å¼ä¸‰ </span>
			<span class="token class-name">String</span> redirectUrl <span class="token operator">=</span> <span class="token class-name">SaSsoUtil</span><span class="token punctuation">.</span><span class="token function">buildRedirectUrl</span><span class="token punctuation">(</span><span class="token class-name">StpUtil</span><span class="token punctuation">.</span><span class="token function">getLoginId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> redirect<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>redirectUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// å…¨å±€å¼‚å¸¸æ‹¦æˆª </span>
	<span class="token annotation punctuation">@ExceptionHandler</span>
	<span class="token keyword">public</span> <span class="token class-name">SaResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token keyword">return</span> <span class="token class-name">SaResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæ›´è¯¥ä¸‹clientç«¯çš„é…ç½®å³å¯</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">sa-token</span><span class="token punctuation">:</span>
    <span class="token key atrule">sso</span><span class="token punctuation">:</span> 
        <span class="token comment"># SSO-Serverç«¯ ç»Ÿä¸€è®¤è¯åœ°å€ </span>
        <span class="token key atrule">auth-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8848/ä½ çš„æœ€ç»ˆé…ç½®
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç›¸å…³çš„é…ç½®è¡¨" tabindex="-1"><a class="header-anchor" href="#ç›¸å…³çš„é…ç½®è¡¨" aria-hidden="true">#</a> ç›¸å…³çš„é…ç½®è¡¨</h2><h3 id="serverç«¯" tabindex="-1"><a class="header-anchor" href="#serverç«¯" aria-hidden="true">#</a> Serverç«¯</h3>`,24),In=n("thead",null,[n("tr",null,[n("th",null,"å‚æ•°åç§°"),n("th",null,"ç±»å‹"),n("th",null,"é»˜è®¤å€¼"),n("th",null,"è¯´æ˜")])],-1),Un=n("tr",null,[n("td",null,"ticketTimeout"),n("td",null,"long"),n("td",null,"300"),n("td",null,"ticket æœ‰æ•ˆæœŸ ï¼ˆå•ä½: ç§’ï¼‰")],-1),Hn=n("td",null,"allowUrl",-1),Ln=n("td",null,"String",-1),An=n("td",null,"*",-1),Mn={href:"https://sa-token.dev33.cn/doc/index.html#/sso/sso-check-domain",target:"_blank",rel:"noopener noreferrer"},En=n("tr",null,[n("td",null,"isSlo"),n("td",null,"Boolean"),n("td",null,"false"),n("td",null,"æ˜¯å¦æ‰“å¼€å•ç‚¹æ³¨é”€åŠŸèƒ½")],-1),Pn=n("tr",null,[n("td",null,"isHttp"),n("td",null,"Boolean"),n("td",null,"false"),n("td",null,"æ˜¯å¦æ‰“å¼€æ¨¡å¼ä¸‰ï¼ˆæ­¤å€¼ä¸º true æ—¶å°†ä½¿ç”¨ http è¯·æ±‚ï¼šæ ¡éªŒticketå€¼ã€å•ç‚¹æ³¨é”€ã€è·å–userinfoï¼‰")],-1),Fn=n("tr",null,[n("td",null,"secretkey"),n("td",null,"String"),n("td",null,"null"),n("td",null,"è°ƒç”¨ç§˜é’¥ ï¼ˆç”¨äºSSOæ¨¡å¼ä¸‰å•ç‚¹æ³¨é”€çš„æ¥å£é€šä¿¡èº«ä»½æ ¡éªŒï¼‰")],-1),zn=e(`<h3 id="client-ç«¯" tabindex="-1"><a class="header-anchor" href="#client-ç«¯" aria-hidden="true">#</a> Client ç«¯</h3><table><thead><tr><th>å‚æ•°åç§°</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>authUrl</td><td>String</td><td>null</td><td>é…ç½® Server ç«¯å•ç‚¹ç™»å½•æˆæƒåœ°å€</td></tr><tr><td>isSlo</td><td>Boolean</td><td>false</td><td>æ˜¯å¦æ‰“å¼€å•ç‚¹æ³¨é”€åŠŸèƒ½</td></tr><tr><td>isHttp</td><td>Boolean</td><td>false</td><td>æ˜¯å¦æ‰“å¼€æ¨¡å¼ä¸‰ï¼ˆæ­¤å€¼ä¸º true æ—¶å°†ä½¿ç”¨ http è¯·æ±‚ï¼šæ ¡éªŒticketå€¼ã€å•ç‚¹æ³¨é”€ã€è·å–userinfoï¼‰</td></tr><tr><td>checkTicketUrl</td><td>String</td><td>null</td><td>é…ç½® Server ç«¯çš„ ticket æ ¡éªŒåœ°å€</td></tr><tr><td>userinfoUrl</td><td>String</td><td>null</td><td>é…ç½® Server ç«¯æŸ¥è¯¢ userinfo åœ°å€</td></tr><tr><td>sloUrl</td><td>String</td><td>null</td><td>é…ç½® Server ç«¯å•ç‚¹æ³¨é”€åœ°å€</td></tr><tr><td>ssoLogoutCall</td><td>String</td><td>null</td><td>é…ç½®å½“å‰ Client ç«¯çš„å•ç‚¹æ³¨é”€å›è°ƒURL ï¼ˆä¸ºç©ºæ—¶è‡ªåŠ¨è·å–ï¼‰</td></tr><tr><td>secretkey</td><td>String</td><td>null</td><td>æ¥å£è°ƒç”¨ç§˜é’¥ ï¼ˆç”¨äºSSOæ¨¡å¼ä¸‰å•ç‚¹æ³¨é”€çš„æ¥å£é€šä¿¡èº«ä»½æ ¡éªŒï¼‰</td></tr></tbody></table><h3 id="é…ç½®ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç¤ºä¾‹" aria-hidden="true">#</a> é…ç½®ç¤ºä¾‹</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># Sa-Token é…ç½®</span>
<span class="token key atrule">sa-token</span><span class="token punctuation">:</span> 
    <span class="token comment"># SSO-ç›¸å…³é…ç½®</span>
    <span class="token key atrule">sso</span><span class="token punctuation">:</span> 
        <span class="token comment"># SSO-Serverç«¯ å•ç‚¹ç™»å½•æˆæƒåœ°å€ </span>
        <span class="token key atrule">auth-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//sa<span class="token punctuation">-</span>sso<span class="token punctuation">-</span>server.com<span class="token punctuation">:</span>9000/sso/auth

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4);function Dn(Bn,Nn){const a=o("ExternalLinkIcon");return c(),l("div",null,[T,n("ol",null,[j,n("li",null,[s("åç«¯åŒRedisï¼šå°±æ˜¯æŒ‡å¤šä¸ªç³»ç»Ÿå¯ä»¥è¿æ¥åŒä¸€ä¸ªRedisï¼Œå…¶å®ƒçš„ç¼“å­˜æ•°æ®ä¸­å¿ƒäº¦å¯ã€‚PSï¼šè¿™é‡Œå¹¶ä¸éœ€è¦æŠŠæ‰€æœ‰é¡¹ç›®çš„æ•°æ®éƒ½æ”¾åœ¨åŒä¸€ä¸ªRedisä¸­ï¼ŒSa-Tokenæä¾›äº† "),I,s(" çš„è§£å†³æ–¹æ¡ˆï¼Œè¯¦æƒ…æˆ³ï¼š"),n("a",U,[s("Aloneç‹¬ç«‹Redisæ’ä»¶"),t(a)]),s("ã€‚")]),H,L]),A,M,E,n("p",null,[s("æ¥ç€è®¿é—®"),n("a",P,[s("http://localhost:9000/sso/auth"),t(a)])]),F,n("p",null,[s("è€Œå…±äº«Redisï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬æŠŠæ‰€æœ‰é¡¹ç›®çš„æ•°æ®éƒ½æ”¾åœ¨åŒä¸€ä¸ªRedisä¸­ï¼ŒSa-Tokenæä¾›äº† "),z,s(" çš„è§£å†³æ–¹æ¡ˆï¼Œè¯¦æƒ…æˆ³ï¼š"),n("a",D,[s("Aloneç‹¬ç«‹Redisæ’ä»¶"),t(a)])]),B,n("p",null,[s("PS:è¿™é‡Œå»ºè®®ä½¿ç”¨"),n("a",N,[s("SwitchHosts"),t(a)]),s("æ¥è¿›è¡Œç®¡ç†ï¼ˆPSï¼šå®‰è£…åå³é”®å›¾æ ‡ï¼Œè®¾ç½®ä¸‹ä¸€ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰")]),V,n("p",null,[s("å¦‚æœè¯´ä½ çš„æœåŠ¡ç«¯é…ç½®å¥½äº†ç‹¬ç«‹çš„"),n("a",K,[s("Redisæ’ä»¶"),t(a)]),s("çš„è¯ï¼Œè¿™é‡Œä¹Ÿè¦å¯¹åº”çš„é…ç½®ä¸‹ï¼Œæˆ‘è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†")]),Q,n("ul",null,[n("li",null,[n("a",X,[s("http://s1.stp.com:9001/"),t(a)])]),n("li",null,[n("a",Y,[s("http://s2.stp.com:9002/"),t(a)])]),n("li",null,[n("a",G,[s("http://s3.stp.com:9003/"),t(a)])])]),W,n("p",null,[s("å…³äºç¬¬äºŒç‚¹ï¼Œä½¿ç”¨ "),n("a",$,[s("Aloneç‹¬ç«‹Redisæ’ä»¶"),t(a)]),s(" åšåˆ°æƒé™ç¼“å­˜ç›´è¿ SSO-Redis æ•°æ®ä¸­å¿ƒï¼Œæˆ–è€…ç›´æ¥é…ç½®é€šç”¨Redisï¼Œåæ­£æ¨ªç«–éƒ½è§£å†³äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°")]),J,n("p",null,[s("ç„¶åä»æµè§ˆå™¨è®¿é—®ï¼š"),n("a",Z,[s("http://sa-sso-client1.com:9001/"),t(a)])]),nn,sn,an,tn,en,n("p",null,[s("æ¥ç€ä½ è®¿é—®ä¸‹åŒåŸŸåä¸‹çš„9002"),n("a",pn,[s("http://sa-sso-client1.com:9002/"),t(a)])]),on,cn,ln,un,rn,dn,kn,mn,n("p",null,[s("è®¿é—®æµ‹è¯•ï¼š"),n("a",vn,[s("http://sa-sso-client1.com:9001/sso/myinfo"),t(a)])]),bn,gn,hn,n("p",null,[s("é‡å¯é¡¹ç›®ï¼Œè®¿é—®æµ‹è¯•ï¼š"),n("a",Sn,[s("http://sa-sso-client1.com:9001/"),t(a)]),s("ï¼Œ æˆ‘ä»¬ä¸»è¦çš„æµ‹è¯•ç‚¹åœ¨äº "),fn,s("ï¼Œæ­£å¸¸ç™»å½•å³å¯ã€‚")]),yn,n("blockquote",null,[n("p",null,[n("a",xn,[s("http://sa-sso-server.com:9000/sso/auth?redirect=https://www.baidu.com/"),t(a)])])]),wn,qn,_n,n("p",null,[n("a",Rn,[s("http://sa-sso-server.com:9000/sso/auth?redirect=https://www.baidu.com/"),t(a)])]),Cn,n("p",null,[s("æˆ‘ä»¬å¯ä»¥æ‰“å¼€SSOæ¨¡å—ç›¸å…³æºç ï¼Œæœ‰å…³ API çš„è®¾è®¡éƒ½å®šä¹‰åœ¨ï¼š"),n("a",On,[s("SaSsoConsts.java"),t(a)]),s(" ä¸­ï¼Œè¿™äº›å€¼ä»æ¶æ„è®¾è®¡ä¸Šæ¥è®²å±äºå¸¸é‡å´å¹¶æœªä½¿ç”¨ "),Tn,s(" ä¿®é¥°ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¯¹å…¶äºŒæ¬¡ä¿®æ”¹ã€‚")]),jn,n("table",null,[In,n("tbody",null,[Un,n("tr",null,[Hn,Ln,An,n("td",null,[s("æ‰€æœ‰å…è®¸çš„æˆæƒå›è°ƒåœ°å€ï¼Œå¤šä¸ªç”¨é€—å·éš”å¼€ï¼ˆä¸åœ¨æ­¤åˆ—è¡¨ä¸­çš„URLå°†ç¦æ­¢ä¸‹æ”¾ticketï¼‰ï¼Œå‚è€ƒï¼š"),n("a",Mn,[s("SSOæ•´åˆï¼šé…ç½®åŸŸåæ ¡éªŒ"),t(a)])])]),En,Pn,Fn])]),zn])}const Qn=p(O,[["render",Dn],["__file","17-1-Sa-Tokenå•ç‚¹è®¤è¯.html.vue"]]);export{Qn as default};
