---
title: 21-Mysql
date: 2021-11-21 21:56:18
category: JavaSE
tag:
 - Java
 - JavaSE
 - Mysql
---

## åŸºæœ¬ä»‹ç»

â€‹  æ•°æ®åº“å˜›ï¼Œæ‡‚å¾—éƒ½æ‡‚ï¼Œåœ¨æˆ‘å­¦ä¹ Javaä¹‹å‰ï¼Œå·²ç»æ¥è§¦è¿‡Mysqläº†ï¼Œå¹¶ä½¿ç”¨Nodejsã€Koaã€Vue3ã€ElementUIæ­å»ºäº†ä¸€ä¸ªä¸ªäººåšå®¢ï¼Œä½¿ç”¨çš„æ•°æ®åº“å°±æ˜¯Mysqlï¼Œå½“ç„¶åœ¨å­¦ä¹ Javaä¹‹å‰Mysqlä¸ºæˆ‘å­˜å–äº†è¶…å¤šçš„å›¾ç‰‡ï¼š

![image-20211119220054247](/images/JavaSE/21-MySql/image-20211119220054247.png)

â€‹  è¿™å¤§æ¦‚æ˜¯çˆ¬å–äº†ä¸‰å¤©çš„ç»“æœï¼Œå…±åœ¨æ•°æ®åº“å†…ç®€å†äº†å…«åƒå¤šæ¡ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¥åèƒ½å¤Ÿéšæ„è°ƒç”¨è¿™äº›æ•°æ®hhhh~

â€‹  æ€»ä¹‹ï¼ŒMysqlä¸­æœ€ä¸ºæ ¸å¿ƒçš„å°±æ˜¯CRUP(å¢åˆ æ”¹æŸ¥)ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯æŸ¥ï¼Œå®é™…é¡¹ç›®ä¸­å¾€å¾€ç»å¤§éƒ¨åˆ†é¡¹ç›®éƒ½æ˜¯å­˜åœ¨sqlæ•°æ®åº“ä¸­ï¼Œä¾‹å¦‚ï¼šç½‘é¡µçš„sabbarï¼Œç½‘é¡µçš„èœå•ï¼Œç”¨æˆ·çš„ä¿¡æ¯ï¼Œç”¨æˆ·çš„å‘è¨€ï¼Œç”¨æˆ·æ‰€æ‹¥æœ‰çš„ä¸œè¥¿ç­‰ç­‰

â€‹  è¿™é‡Œå¼€å§‹ï¼Œå­¦çš„ä¹Ÿåªæ˜¯åŸºç¡€ï¼ŒMysqlåé¢è¿˜å¾—å­¦äº›æ›´æ·±å…¥çš„ç©æ„...

â€‹  å¥½äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œå½“ä½ è®¿é—®æ·˜å®ï¼Œäº¬ä¸œï¼Œå¤©çŒ«ï¼Œå¾®ä¿¡ç­‰ç›¸å…³è½¯ä»¶æˆ–è€…ç½‘é¡µæ—¶ï¼Œæ˜¯å¦å‘ç°æ¯æ¬¡é€€å‡ºï¼Œå†æ¬¡ç™»é™†æ—¶ï¼Œä½ çš„è®¢å•ï¼ŒèŠå¤©ç­‰ä¿¡æ¯ä¾æ—§è¿˜å­˜åœ¨

â€‹  åˆæˆ–è€…è¯´ï¼Œä½ ç”µè„‘ä¸Šçš„åŸç¥å¸è½½äº†ï¼Œé‡è£…å›æ¥åï¼Œå†æ¬¡ç™»é™†è´¦å·åï¼Œä½ è´¦å·ä¸Šçš„æ‰€æœ‰è§’è‰²å’Œç‰©å“ä¾æ—§å­˜åœ¨

â€‹  è¿™ä¹‹ä¸­å°±æ˜¯Mysqlçš„åŠŸåŠ³----å®ƒå­˜å‚¨äº†ä½ çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå½“ä½ è®¿é—®åˆ°ç›¸å…³çš„ç½‘ç«™ã€è½¯ä»¶ã€æœåŠ¡æ—¶ï¼Œå¯¹æ–¹çš„åå°æœç´¢åˆ°ä½ çš„æ•°æ®å¹¶è¿”å›ç»™ä½ 

â€‹  å¯èƒ½è¿™æ ·è¯´æœ‰ç‚¹æŠ½è±¡ï¼Œä¸¾ä¸€ä¸ªç”Ÿæ´»åŒ–çš„æ¡ˆä¾‹è¯´æ˜---> å¦‚æœè¯´ï¼Œå›¾ä¹¦é¦†æ˜¯ä¿å­˜ä¹¦ç±çš„ï¼Œé‚£ä¹ˆæ•°æ®åº“å°±æ˜¯ä¿å­˜æ•°æ®çš„

â€‹  å¯èƒ½ä½ ä¼šè¿™æ ·æƒ³ï¼Œæˆ‘ç°åœ¨æ­£åœ¨ç”¨ç€Excelæ¥å­˜å‚¨æ•°æ®ï¼Œå†ä¸æµä¹Ÿå¯ä»¥ç”¨txtæ–‡ä»¶å•Šä¹‹ç±»çš„æ–‡ä»¶æ¥ä¿å­˜æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨Mysql

â€‹  ä½†æ˜¯ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€åƒä¸‡æ¡ä¸é‡æ ·çš„æ•°æ®ï¼Œæˆ‘è¦ä½ å¿«é€Ÿçš„è¯»å–æˆ–è€…å†™å…¥æˆ–è€…åœ¨è¿™äº›æ•°æ®ä¸­æŸ¥æ‰¾æŸä¸ªç¬¦åˆæ¡ä»¶çš„å€¼ï¼Œä½¿ç”¨Excel.....ä¸€åƒä¸‡æ¡æ•°æ®å¯èƒ½è¿è½¯ä»¶éƒ½æ‰“ä¸å¼€ï¼Œä½¿ç”¨æ™®é€šçš„txtä¹‹ç±»çš„æ–‡ä»¶ï¼Œæœ¬äººæœ‰å¹¸è¯•è¿‡ï¼ˆä¸€ä¸ªå¯†ç å­—å…¸ï¼‰ï¼Œå¯ä»¥è¯´æ‰“å¼€æ…¢ï¼ŒæŸ¥è¯¢æ…¢ï¼Œå®Œå…¨ä¸ç¬¦åˆæˆ‘çš„ä½¿ç”¨éœ€æ±‚

â€‹  ä½†æ˜¯ä½¿ç”¨æ•°æ®åº“çš„è¯ï¼Œè¿™äº›çƒ¦æ¼å°±æ²¡æœ‰äº†ï¼Œæˆ‘å¯èƒ½å¿«é€Ÿçš„å¢åˆ æ”¹æŸ¥ï¼Œä¸è¿‡ç›®å‰æˆ‘è¿˜ä¸å¥½è¯´ï¼Œç­‰è¿‡å®Œä¸€éåå¤§æ¦‚å°±èƒ½çŸ¥é“å®ƒæœ‰å¤šé¡ºæ‰‹äº†

## Mysqlçš„å®‰è£…

### Windows

Windowsä¸‹çš„å®‰è£…æ•™ç¨‹å¯ä»¥ç›´æ¥å»çœ‹[è€éŸ©çš„è§†é¢‘](https://www.bilibili.com/video/BV1fh411y7R8?p=732&t=1.5)ï¼Œè®²çš„æ¯”è¾ƒç»†ï¼Œæ ¹æ®ä»–çš„æ“ä½œä¸‹æ¥èµ°ä¸€éå°±å¯ä»¥ä½¿ç”¨äº†ï¼ŒMysqlçš„[ä¸‹è½½åœ°å€](https://dev.mysql.com/downloads/mysql/)ï¼Œæ ¹æ®ä»–çš„è§†é¢‘ä¸‹æ¥æ“ä½œä¸€éå³å¯

![image-20211119224623277](/images/JavaSE/21-MySql/image-20211119224623277.png)

å°TIpsï¼šåœ¨é…ç½®`my.ini`çš„è¿‡ç¨‹ä¸­ï¼Œå­—ç¬¦é›†`default-character-set`å¯ä»¥é€‰æ‹©è®¾ç½®ä¸º`utf8mb4`

ä¸ºå•¥å‘¢ï¼Ÿæ¯”æ–¹è¯´æƒ³åœ¨sqlé‡Œå­˜æ”¾ğŸ‚ğŸå­ç±»çš„è¡¨æƒ…ï¼Œutf-8æ˜¯å­˜æ”¾ä¸è¿›å»çš„ï¼Œå› ä¸ºè¿™ç±»è¡¨æƒ…å ç”¨å››ä¸ªå­—ç¬¦...

#### ä¸ªäººWindowså®‰è£…æµç¨‹

1. [ä¸‹è½½](https://dev.mysql.com/downloads/mysql/)åˆ°åŒ…ï¼Œå¹¶è§£å‹

2. åˆ°è§£å‹ç›®å½•ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶my.ini

   ```ini
   [mysqld] 
   # è®¾ç½®mysqlçš„å®‰è£…ç›®å½•ï¼Œä¹Ÿå°±æ˜¯åˆšæ‰æˆ‘ä»¬è§£å‹çš„ç›®å½• è¿™é‡Œè¦ä¹ˆç”¨æ­£æ–œæ /ï¼Œè¦ä¹ˆç”¨\\åŒåæ–œæ 
   basedir=C:/mysql-8.0.13-winx64
   # è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•
   datadir=C:/mysql-8.0.13-winx64/data
   # è®¾ç½®é»˜è®¤ä½¿ç”¨çš„ç«¯å£
   port=3306
   # å…è®¸æœ€å¤§è¿æ¥æ•°
   max_connections=200
   # å…è®¸è¿æ¥å¤±è´¥çš„æ¬¡æ•°ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢æœ‰äººè¯•å›¾æ”»å‡»æ•°æ®åº“
   max_connect_errors=10
   # æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†
   character-set-server=utf8mb4
   # æ•°æ®åº“å­—ç¬¦é›†å¯¹åº”ä¸€äº›æ’åºç­‰è§„åˆ™ä½¿ç”¨çš„å­—ç¬¦é›†
   collation-server=utf8mb4_general_ci
   # åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“
   default-storage-engine=INNODB
   # é»˜è®¤ä½¿ç”¨â€œmysql_native_passwordâ€æ’ä»¶ä½œä¸ºè®¤è¯åŠ å¯†æ–¹å¼
   # MySQL8.0é»˜è®¤è®¤è¯åŠ å¯†æ–¹å¼ä¸ºcaching_sha2_password
   default_authentication_plugin=mysql_native_password
    
   [mysql]
   # è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†
   default-character-set=utf8mb4
    
   [client]
   default-character-set=utf8mb4
   port=3306
   ```

3. è¿›å…¥åˆ°`bin`ç›®å½•ï¼Œä»¥ç®¡ç†å‘˜æ–¹å¼æ‰“å¼€`powerShell`æˆ–è€…`Cmd`

   1. å®‰è£…æœåŠ¡

      ```powershell
      ./mysqld.exe install 
      ```

   2. åˆå§‹åŒ–ï¼š

      ```powershell
      ./mysqld.exe --initialize --console
      ```

   3. ç­‰å¾…åˆå§‹åŒ–å®Œæ¯•åï¼Œä¼šåœ¨æœ€åæ‰“å°å‡ºé»˜è®¤çš„rootè´¦æˆ·å¯†ç ï¼ŒæŠŠå¯†ç å…ˆè®°ä¸‹æ¥ï¼Œæ ¼å¼å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š
      `root@localhost:dS8hTh)u?hAl`ï¼Œå…¶ä¸­`dS8hTh)u?hAl`å°±æ˜¯åˆå§‹å¯†ç 

   4. æ³¨æ„ è¿™ä¸€æ­¥å¯†ç ä¸­å¯èƒ½ä¼šå¸¦æœ‰ç©ºæ ¼ï¼Œåˆ«å¤åˆ¶å¤šäº†..

4. æ¥ä¸‹æ¥ä¿®æ”¹é»˜è®¤åˆå§‹å¯†ç 

   1. ä¾æ—§æ˜¯åœ¨`bin`ç›®å½•ä¸­çš„powershellæˆ–è€…cmd

      ```powershell
      mysql -uroot -p
      # ç„¶åä¼šæç¤ºè¦æ±‚è¾“å…¥rootçš„å¯†ç ï¼Œè¾“å…¥ä¸Šä¸€æ­¥ä¸­è·å–åˆ°çš„å³å¯
      ```

   2. ä¿®æ”¹å¯†ç 

      - é¦–å…ˆè¾“å…¥`use mysql;`

      - ç„¶åçœ‹ä¸‹æœ‰æ²¡æœ‰å‡ºç°ä¸€æ¡æ¶ˆæ¯

        - å¦‚æœå‘ç°å±å¹•ä¸­æœ‰è¿™æ ·çš„æ¶ˆæ¯ï¼šYou must reset your password using ALTER USER statement before executing this statement.

          - ```sql
            alter user 'root'@'localhost' identified by 'è¦æ”¹æˆçš„å¯†ç ';
            ```

        - å¦‚æœæ²¡æœ‰ï¼š

          - ```sql
            update user set authentication_string=password('è¦æ”¹æˆçš„å¯†ç ') where user ='root' and Host='localhost';
            ```

      - ä¿®æ”¹å®Œæ¯•åï¼š

        - ```sql
          # åˆ·æ–°æƒé™
          flush privileges;
          ```

5. æ·»åŠ ç³»ç»Ÿå˜é‡

   1. å¤åˆ¶`bin`ç›®å½•è·¯å¾„æ‰“å¼€ç¯å¢ƒå˜é‡é…ç½®ï¼Œé…ç½®å½“å‰ç”¨æˆ·çš„Pathï¼Œæ·»åŠ è¯¥è·¯å¾„ï¼Œå…³é—­æ‰€æœ‰çš„cmdå†é‡æ–°æ‰“å¼€å³å¯

ç›¸å…³å…³é—­å¯åŠ¨å‘½ä»¤ï¼š

```powershell
#å¯åŠ¨æœåŠ¡
net start mysql
#å…³é—­æœåŠ¡
net stop mysql
#è¿›å…¥mysql
mysql -uroot -p
```

##### å¸è½½mysql

<https://www.cnblogs.com/zhaosq/p/10469848.html>

<https://blog.csdn.net/weixin_29348211/article/details/113163856>

ä¸¤ç¯‡æ–‡ç« çš„æ“ä½œéƒ½è·Ÿç€åšä¸‹ï¼Œç„¶åæŠŠpathä¸­çš„ç›¸å…³ä¿¡æ¯åˆ é™¤å³å¯

### Linux

å› ä¸ºæˆ‘åªç”¨Ubuntuç³»ç»Ÿï¼Œæ‰€ä»¥åªæ”¾å‡ºUbuntuç³»ç»Ÿçš„å®‰è£…æ–¹å¼ï¼Œè‹¥è¦ç”¨å…¶ä»–ç³»ç»Ÿè‡ªè¡Œç™¾åº¦

```shell
#å®‰è£…
sudo apt update
sudo apt install mysql-server
# åˆå§‹åŒ–Mysql
sudo mysql_secure_installation
# è¿™é‡Œä¼šè¦æ±‚è¿›è¡Œç›¸å…³é…ç½®ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯†ç ï¼Œå…¶ä»–çš„è‡ªå·±çœ‹ç€æ•´ï¼Œå»ºè®®æ˜¯è·Ÿç€ç¿»è¯‘æ¥è¿›è¡Œæ“ä½œ
# https://blog.csdn.net/weixx3/article/details/94133847/ ä¹Ÿå¯ä»¥å‚ç…§è¿™ç¯‡æ–‡ç« 

#æ£€æŸ¥Mysqlè¿è¡ŒçŠ¶æ€
systemctl status mysql.service

#å¦‚æœä¸æ˜¯è¿è¡ŒçŠ¶æ€çš„è¯ï¼ˆactiveä¸æ˜¯runningï¼‰ï¼šå¯åŠ¨mysql
sudo service mysql start 

#åœæ­¢mysql
sudo service mysql stop

#é‡å¯mysql
sudo service mysql restart

#åˆ·æ–°æƒé™
flush privileges;

```

ä¿®æ”¹å­—ç¬¦é›†ä¸ºutf8mb4:

```shell
sudo vi /etc/mysql/mysql.conf.d/mysqld.cnf
```

```ini
# æ³¨æ„ æ˜¯ä¿®æ”¹ è‹¥åŸå…ˆåªæœ‰[mysql]ï¼Œåˆ™è¦†ç›–ï¼Œå…¶ä½™æƒ…å†µå‚ç…§windowså®‰è£…ä¸€è§ˆçš„å†™æ³•å†™
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
character-set-server=utf8mb4
character-set-client-handshake = FALSE
collation-server = utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'
```

ç„¶åé‡å¯mysqlï¼Œè¿›å…¥mysqlæ’å…¥æœç´¢éªŒè¯ï¼š

```sql
# æŸ¥çœ‹å­—ç¬¦é›†
SHOW VARIABLES WHERE Variable_name LIKE 'character\_set\_%' OR Variable_name LIKE 'collation%';
# å¦‚æœè¯´å‘ç°è¿˜æœ‰utf8çš„å­—æ ·ï¼š
set character_set_client =utf8mb4;
set character_set_results = utf8mb4;
set character_set_connection = utf8mb4;
# æˆ–è€… SET NAMES utf8mb4; å°±å¯ä»¥ä¿®æ”¹clientç¼–ç 
SET NAMES utf8mb4;
# æœ€ç»ˆç»“æœå¤§æ¦‚æ˜¯è¿™æ ·çš„
+--------------------------+--------------------+
| Variable_name            | Value              |
+--------------------------+--------------------+
| character_set_client     | utf8mb4            |
| character_set_connection | utf8mb4            |
| character_set_database   | utf8mb4            |
| character_set_filesystem | binary             |
| character_set_results    | utf8mb4            |
| character_set_server     | utf8mb4            |
| character_set_system     | utf8mb3            |
| collation_connection     | utf8mb4_unicode_ci |
| collation_database       | utf8mb4_unicode_ci |
| collation_server         | utf8mb4_unicode_ci |
+--------------------------+--------------------+
```

é…ç½®è¿œç¨‹è®¿é—®ï¼š

```shell
sudo mysql -uroot -p
#ç„¶åè¾“å…¥å¯†ç è¿›å…¥mysql
```

```sql
# åŸå…ˆæ˜¯è¿™æ ·çš„
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY "123456";

# æ³¨æ„'root'@'localhost' å‡æœ‰å•å¼•å·ï¼Œå…¶ä½™çš„ä¹Ÿæ˜¯

# è¦è®¾ç½®æˆè¿™æ ·
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY "æƒ³è®¾ç½®æˆçš„å¯†ç ";
#å…¶ä¸­root@localhosï¼Œlocalhostå°±æ˜¯æœ¬åœ°è®¿é—®ï¼Œé…ç½®æˆ%å°±æ˜¯æ‰€æœ‰ä¸»æœºéƒ½å¯è¿æ¥ï¼›
#ç¬¬äºŒä¸ª'123456'ä¸ºä½ ç»™æ–°å¢æƒé™ç”¨æˆ·è®¾ç½®çš„å¯†ç ï¼Œ%ä»£è¡¨æ‰€æœ‰ä¸»æœºï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“çš„ipï¼›
#ä¸è¿‡è¿™éšè®¾ç½®äº†%ä½†æˆ‘rooté€šè¿‡å·¥å…·è¿˜æ˜¯ç™»é™†ä¸è¿›å»ï¼Œå¯èƒ½æ˜¯ä¸ºäº†å®‰å…¨æ€§ï¼Œæ‰€ä»¥æ–°å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼›


#æˆ–è€…æŒ‡å®šç”¨æˆ·ï¼š
#ç”¨rootç”¨æˆ·æ–°å»ºæ•°æ®å’Œç”¨ä½œè¿œç¨‹è®¿é—®çš„ç”¨æˆ·
##1 åˆ›å»ºæ•°æ®åº“weixx
CREATE DATABASE weixx;
##2 åˆ›å»ºç”¨æˆ·wxx(å¯†ç 654321) å¹¶å…è®¸wxxç”¨æˆ·å¯ä»¥ä»ä»»æ„æœºå™¨ä¸Šç™»å…¥mysqlçš„weixxæ•°æ®åº“
GRANT ALL PRIVILEGES ON weixx.* TO 'wxx'@'%' IDENTIFIED BY "654321"; 

#åˆ·æ–°æƒé™
flush privileges;
```

è¯¦ç»†çš„é…ç½®å¤–ç½‘è¿æ¥å¯ä»¥çœ‹[è¿™ç¯‡æ–‡ç« ](https://blog.csdn.net/weixx3/article/details/80782479)ï¼Œå°¤å…¶æ˜¯å…¶è¯„è®ºåŒº

#### å¸è½½å’Œé‡è£…Mysql

å…ˆé€šè¿‡[è¿™ç¯‡æ–‡ç« 1](https://blog.csdn.net/fanrongwoaini/article/details/107518693)çš„æ“ä½œèµ°ä¸€éåˆ é™¤ï¼Œå†é€šè¿‡[è¿™ç¯‡æ–‡ç« 2](https://www.cnblogs.com/zhangxuel1ang/p/13456116.html)çš„æ“ä½œèµ°ä¸€éåˆ é™¤ï¼Œç„¶åå›åˆ°æ–‡ç« 1è¿›è¡Œå®‰è£…

### Docker

æˆ‘è¿˜æ˜¯æ›´å–œæ¬¢ç”¨Docker

```shell
docker pull mysql@ç‰ˆæœ¬å·
# ä¸æŒ‡å®šç‰ˆæœ¬çš„è¯é»˜è®¤æ˜¯æœ€æ–°
```

åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨

```shell
docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql
```

è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œæœ€å¥½ä¸è¦åŠ -då‚æ•°ã€‚-dè¡¨ç¤ºåå°æ‰§è¡Œï¼Œå°±ä¸èƒ½çœ‹åˆ°åˆå§‹åŒ–æ•°æ®åº“è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½æœ‰ä¸€ä¼šå„¿ï¼Œæ²¡ç»è¿‡åˆå§‹åŒ–æ•°æ®åº“ä¸èƒ½å¯åŠ¨æœåŠ¡çš„ã€‚

![img](/images/JavaSE/21-MySql/1704051-20200703164942350-177162620.png)

å‡ºç°è¿™æ¡è®°å½•å°±è¯´æ˜å®‰è£…æˆåŠŸï¼Œå¯ä»¥æŠŠè¿™ä¸ªæ§åˆ¶å°å…³æ‰ï¼Œé‡æ–°å¼€ä¸€ä¸ª

```shell
docker start mysql
```

è¿›å…¥bash

```shell
docker exec -it mysql bash
mysql -uroot -p
```

æ·»åŠ è¿œç¨‹ç™»å½•ç”¨æˆ·

```sql
CREATE USER 'è´¦æˆ·å'@'%' IDENTIFIED WITH mysql_native_password BY 'å¯†ç '; 

#æˆ–è€…
##1 åˆ›å»ºæ•°æ®åº“weixx
CREATE DATABASE weixx;
##2 åˆ›å»ºç”¨æˆ·wxx(å¯†ç 654321) å¹¶å…è®¸wxxç”¨æˆ·å¯ä»¥ä»ä»»æ„æœºå™¨ä¸Šç™»å…¥mysqlçš„weixxæ•°æ®åº“
GRANT ALL PRIVILEGES ON weixx.* TO 'wxx'@'%' IDENTIFIED BY "654321"; 
#åˆ·æ–°æƒé™
flush privileges;

exit;
```

é‡å¯

```shell
service mysql restart
```

è®¾ç½®å­—ç¬¦é›†çš„æ–¹å¼ï¼šå’ŒLinuxä¸­ä¸€è‡´ï¼šä¸ªäººå»ºè®®ä½¿ç”¨å›¾å½¢åŒ–æ–¹å¼æ“ä½œ

![image-20211119233159061](/images/JavaSE/21-MySql/image-20211119233159061.png)

```ini
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
character-set-server=utf8mb4
character-set-client-handshake = FALSE
collation-server = utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'
```

é…ç½®å®Œæ¯•åï¼Œé‡å¯mysql

```shell
docker restart mysql
```

## Mysqlçš„åŸºæœ¬ä½¿ç”¨

è¿æ¥åˆ°ä»»æ„çš„mysqlæ•°æ®åº“çš„æŒ‡ä»¤

```shell
mysql -h ä¸»æœºIP -P ç«¯å£ -u ç”¨æˆ·å -på¯†ç 
#å°å†™çš„på’Œå¯†ç ä¸è¦æœ‰ç©ºæ ¼
#å¦‚æœ-pæ—¶æ²¡è·Ÿå¯†ç ï¼Œå›è½¦åä¼šè¦æ±‚è¾“å…¥å¯†ç 
#æ¼”ç¤ºï¼š
mysql -h localhost -P 3306 -u root -p123456

#å½“ç„¶é»˜è®¤çš„æƒ…å†µä¸‹å‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ localhost å’Œ 3306
mysql -uroot -p123456

```

å½“ç„¶é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šå°†Mysqlçš„é»˜è®¤ç«¯å£æ”¹æˆåˆ«çš„ï¼Œå¦‚53146ï¼ˆ3306å®¹æ˜“è¢«é»‘å®¢æ”»å‡»ï¼‰

### ä½¿ç”¨å›¾å½¢åŒ–ç®¡ç†è½¯ä»¶æ¥æ“ä½œMysql

[NaviCat](https://www.navicat.com.cn/products)åº”è¯¥æ˜¯ç›®å‰ä¸ºæ­¢æœ€å¥½çš„Mysqlç®¡ç†è½¯ä»¶ï¼Œè™½ç„¶è´µï¼Œä½†æ˜¯è¶…å¥½ç”¨

å½“ç„¶ï¼Œè´´å¿ƒçš„[é“¾æ¥](https://github.com/gitccl/Navicat-key)ä¹Ÿæ˜¯ä¸å¯å°‘çš„

[SQlyog](https://github.com/webyog/sqlyog-community/wiki/Downloads)ä¹Ÿä¸é”™ï¼Œç¤¾åŒºç‰ˆæœ¬å…è´¹è¯•ç”¨

ä»–ä»¬ä¸¤çš„åŠŸèƒ½éƒ½å¤§åŒå°å¼‚

....ç„¶åè¿™å¤ªåŸºç¡€çš„åœ°æ–¹ï¼ˆå›¾å½¢åŒ–åˆ›å»ºdbï¼Œå›¾å½¢åŒ–åˆ›å»ºtableï¼Œå›¾å½¢åŒ–insertæ•°æ®ï¼‰å°±ä¸è¿‡å¤šèµ˜è¿°äº†ï¼Œå¯ä»¥å»[è€éŸ©çš„è§†é¢‘](https://www.bilibili.com/video/BV1fh411y7R8?p=734&t=0.9)çœ‹çœ‹ï¼Œæˆ‘é€‰æ‹©æ€§æ’°å†™ï¼Œä»–çš„è§†é¢‘ä¸­è§†é¢‘çš„æ˜¯SqlYog

â€‹  å›¾å½¢åŒ–çš„å¥½å¤„æ˜¯æ–¹ä¾¿ç›´è§‚çš„æŸ¥çœ‹æ•°æ®ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ’å…¥æ•°æ®ä¹‹ç±»çš„è¿‡ç¨‹ä¸€èˆ¬éƒ½æ˜¯æ‰ç”¨å‘½ä»¤æ¨¡å¼æ’å…¥ï¼ˆé…åˆç›¸å…³è¯­è¨€çš„ç›¸å…³åº“ï¼‰ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå‡è®¾ç°åœ¨ä½ è¦ç®¡ç†ä¸€åƒä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ¯ä¸ªç”¨æˆ·çš„ä¿¡æ¯ä½ éƒ½æƒ³è¦æ‰‹åŠ¨å½•å…¥ï¼Œé‚£å²‚ä¸æ˜¯...

â€‹  ä»¥ååœ¨Javaç¨‹åºä¸­ä¹Ÿæ˜¯é€šè¿‡æŒ‡ä»¤æ¥æ“ä½œæ•°æ®åº“çš„ï¼Œè¿™é‡Œæ”¾ä¸‹è€éŸ©è§†é¢‘ä¸­åŸºæœ¬çš„æ“ä½œï¼š

```sql
#Create database
create database db02;
use db02;
#Create table
create table users(
 id int primary key,
    name varchar(255) not null,
    address varchar(255) not null
);
#insert values
insert into users values(1,"å¼ ä¸‰","åŒ—äº¬");
insert into users values(2,"æå››","å¤©æ´¥");
insert into users values(3,"ç‹è€äº”","å—äº¬");
#search 
select * from users;
```

â€‹  å½“ç„¶ï¼Œæ— è®ºä½ æ˜¯å¦æ„Ÿè§‰åˆ°äº†å›¾å½¢åŒ–ç•Œé¢çš„å¥½å¤„ï¼Œæˆ‘éƒ½å»ºè®®ä½ ----è¿˜æ˜¯ç”¨å›å‘½ä»¤è¡Œå¼€æ‰“çš„é‚£ä¸ªmysqlè¿›è¡Œæ“ä½œï¼Œå› ä¸ºå®é™…è¿‡ç¨‹ä¸­å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½æ˜¯ç”±sqlè¯­å¥æ¥å®Œæˆçš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„é‚£äº›ã€‚

â€‹  æ‰€ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ¥æ“ä½œæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ï¼ˆåŒæ—¶å¯ä»¥æœ‰æ•ˆçš„é™ä½ä¸€ä¸¢ä¸¢é¢è¯•ä¸é€šè¿‡çš„æ¦‚ç‡ï¼‰

### Mysqlçš„ç»“æ„

![image-20211120135003148](/images/JavaSE/21-MySql/image-20211120135003148.png)

![image-20211120135054472](/images/JavaSE/21-MySql/image-20211120135054472.png)

![image-20211120135239889](/images/JavaSE/21-MySql/image-20211120135239889.png)

## SQLè¯­å¥åˆ†ç±»

- DDL:æ•°æ®å®šä¹‰è¯­å¥:`create`è¡¨ï¼Œåº“...
- DML:æ•°æ®åº“æ“ä½œè¯­å¥:
  - å¢åŠ `insert`
  - ä¿®æ”¹`update`
  - åˆ é™¤`delete`
- DQL:æ•°æ®åº“çš„æŸ¥è¯¢è¯­å¥`select` æŸ¥è¯¢æ—¶éœ€æŒ‡å®šå“ªä¸ªæ•°æ®åº“
  - æ¯”å¦‚æŒ‡å®šdb1çš„user:`select * from db1.user`
- DCL:æ•°æ®åº“æ§åˆ¶è¯­å¥-ç®¡ç†æ•°æ®åº“
  - ç»™ç”¨æˆ·æˆæƒ`grant`
  - å–æ¶ˆå¯¹ç”¨æˆ·çš„æˆæƒ`revoke`

## æ•°æ®åº“çš„ç›¸å…³æ“ä½œ

### åˆ›å»ºæ•°æ®åº“

è¯­æ³•ï¼š`CREATE DATABASE [å¯é€‰ï¼šIF NOT EXITS] æ•°æ®åº“å [å¯é€‰ CHARACTER SET] [å¯é€‰ COLLATE]`

```sql
# åˆ›å»ºä¸€ä¸ªé»˜è®¤ç±»å‹çš„æ•°æ®åº“
CREATE DATABASE db1;
# åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¦‚æœå·²å­˜åœ¨ï¼Œå°±ä¸åˆ›å»º ä¸å­˜åœ¨åˆ™åˆ›å»º
CREATE DATABASE IF NOT EXISTS db1;

# åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸ºutf-8;
CREATE DATABASE if NOT EXISTS db2 CHARACTER SET utf8;

# åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸ºutf-8,æ ¡éªŒè§„åˆ™ä¸ºåŒºåˆ†å¤§å°å†™utf8_bin
CREATE DATABASE if NOT EXISTS db3 CHARACTER SET utf8 COLLATE utf8_bin;

# é€šå¸¸æ¥è¯´ï¼Œåˆ›å»ºæ•°æ®åº“çš„æ—¶å€™ï¼Œä¸ºäº†è§„é¿å…³é”®å­—ï¼Œéƒ½ä¼šä½¿ç”¨åå¼•å·åŒ…è£¹åå­—
create database `select`;
```

`CHARACTER SET`:æŒ‡å®šæ•°æ®åº“é‡‡ç”¨çš„å­—ç¬¦é›†ï¼Œå¦‚æœä¸æŒ‡å®šå­—ç¬¦é›†ï¼Œé»˜è®¤ä¸ºé…ç½®æ•°æ®åº“æ—¶è®¾ç½®çš„å­—ç¬¦é›†(utf8æˆ–è€…utf8mb4)

`COLLATE`:æŒ‡å®šæ•°æ®åº“çš„æ ¡éªŒè§„åˆ™ï¼Œæ— è®ºæ˜¯å“ªç§å­—ç¬¦é›†ï¼Œæ’åºè§„åˆ™çš„åå­—éƒ½æ˜¯å¤§åŒå°å¼‚çš„ï¼Œutf-8é»˜è®¤ä¸º`utf8_general_ci`ï¼Œä¸‹é¢ä¸¾å‡ ä¸ªå¸¸ç”¨çš„

|      åç§°       |                        ç‰¹ç‚¹                         |
| :-------------: | :-------------------------------------------------: |
| utf8_general_ci |       æ ¡å¯¹é€Ÿåº¦å¿«ï¼Œä½†å‡†ç¡®åº¦ç¨å·®ï¼Œä¸åŒºåˆ†å¤§å°å†™        |
| utf8_general_cs |        æ ¡å¯¹é€Ÿåº¦å¿«ï¼Œä½†å‡†ç¡®åº¦ç¨å·®ï¼ŒåŒºåˆ†å¤§å°å†™         |
| utf8_unicode_ci |       å‡†ç¡®åº¦é«˜ï¼Œä½†æ ¡å¯¹é€Ÿåº¦ç¨æ…¢ï¼Œä¸åŒºåˆ†å¤§å°å†™        |
|    utf8_bin     | å°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ç”¨äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ï¼ŒåŒºåˆ†å¤§å°å†™; |

ä¸€èˆ¬æ¥è¯´ï¼Œéƒ½æ˜¯åœ¨`general_ci`å’Œ `utf8_bin`ä¹‹é—´æ¥å›é€‰æ‹©ï¼Œå…¶ä»–å­—ç¬¦é›†åŒç†ï¼Œä¾‹å¦‚utf8mb4è¦åŒºåˆ†å¤§å°å†™å°±ï¼š`utf8mb4_bin`

### æŸ¥çœ‹ã€åˆ é™¤æ•°æ®åº“

```sql
# æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“
show databases;

# æ˜¾ç¤ºåˆ›å»ºæ•°æ®åº“æ—¶çš„è¯­å¥
show create database æ•°æ®åº“å;

# åˆ é™¤ä¸€ä¸ªæ•°æ®åº“
drop database æ•°æ®åº“å;

# åˆ é™¤ä¸€ä¸ªæ•°æ®åº“ å¦‚æœå­˜åœ¨å°±åˆ é™¤ï¼Œä¸å­˜åœ¨å°±ä»€ä¹ˆä¹Ÿä¸åš
drop database if exists æ•°æ®åº“å;

# é€šå¸¸æ¥è¯´ ä¸ºäº†ä¸¥è°¨æ€§ï¼Œæ•°æ®åº“åéƒ½ä¼šç”¨åå¼•å·åŒ…è£¹
drop database `db222`;
```

### å¤‡ä»½ã€æ¢å¤æ•°æ®åº“

- å¤‡ä»½æ•°æ®åº“ï¼ˆCMDæˆ–è€…Shellä¸‹æ‰§è¡Œï¼‰åƒä¸‡åˆ«ç”¨powerShell åƒä¸‡åˆ«ç”¨powerShell åƒä¸‡åˆ«ç”¨powerShell

```shell
# å¤‡ä»½æ•´ä¸ªæ•°æ®åº“
mysqldump -u ç”¨æˆ·å -p -B æ•°æ®åº“1 æ•°æ®åº“2 æ•°æ®åº“n > æ–‡ä»¶å.sqlæˆ–è€…è·¯å¾„/æ–‡ä»¶å.sql
#ä¾‹å¦‚
cd d:\;
mysqldump -u root -p -B db1 >my.sql

#å¤‡ä»½æ•°æ®åº“çš„æŸäº›è¡¨
mysqldump -u ç”¨æˆ·å -p æ•°æ®åº“å è¡¨1 è¡¨2 è¡¨n > æ–‡ä»¶å.sqlæˆ–è€…è·¯å¾„/æ–‡ä»¶å.sql

```

ä¸æŒ‡å®šè·¯å¾„çš„è¯é»˜è®¤ä½ç½®æ˜¯å½“å‰shellæ‰€åœ¨åŒçº§è·¯å¾„ä¸‹

- æ¢å¤æ•°æ®åº“(è¦è¿›å…¥åˆ°MySQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œ)

```shell
# å¿…é¡»å¾—è¿›å…¥å‘½ä»¤è¡Œ
mysql -uroot -p
```

 ç„¶åå†æ‰§è¡Œæ¢å¤ï¼š

```sql
source è·¯å¾„:æ–‡ä»¶;

#ä¾‹å¦‚
source d:\my.sql;

# æ¢å¤æ•°æ®è¡¨-è¦è¿›å…¥åˆ°è‡ªå·±æƒ³çš„æ•°æ®åº“ä¸­;
use æ•°æ®åº“å;
source è·¯å¾„:æ–‡ä»¶;
```

æˆ–è€…ç›´æ¥æŠŠæ–‡ä»¶æ‹–åˆ°é‚£äº›å›¾å½¢åŒ–è½¯ä»¶ä¸­æ‰§è¡Œä¹Ÿå¯

## è¡¨çš„ç›¸å…³æ“ä½œ

### åˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤è¡¨

â€‹  mysqlä¸­ï¼Œæ™®éçš„å‘½åè§„åˆ™æ˜¯ä¸‹åˆ’çº¿å‘½åï¼Œè€Œéæ˜¯ç¼–ç¨‹è¯­è¨€ä¸­å¸¸è§çš„é©¼å³°å‘½åï¼Œä¾‹å¦‚`userMessage`åœ¨mysqlä¸­å°±è¦å†™æˆ`user_message`

```sql
create table è¡¨åï¼ˆ
 å­—æ®µå1 å­—æ®µç±»å‹ å¯é€‰-éªŒè¯è§„åˆ™,
 å­—æ®µå1 å­—æ®µç±»å‹,
 å­—æ®µå1 å­—æ®µç±»å‹,
 å­—æ®µå1 å­—æ®µç±»å‹
ï¼‰character set å­—ç¬¦é›†  collate æ ¡éªŒè§„åˆ™ engine å¼•æ“;
```

`character set`å­—æ®µçš„å­—ç¬¦é›†ï¼Œä¸æŒ‡å®šä¸ºæ‰€åœ¨æ•°æ®åº“çš„å­—ç¬¦é›†

`collate`å­—æ®µçš„æ ¡éªŒè§„åˆ™ï¼Œä¸æŒ‡å®šä¸ºæ‰€åœ¨æ•°æ®åº“çš„è§„åˆ™

`engine`å¼•æ“ï¼Œè¿™ç©æ„æ¶‰åŠçš„å†…å®¹æœ‰ç‚¹å¤š

éªŒè¯è§„åˆ™ï¼Œè¿™ä¸ªåé¢å•ç‹¬è¯´-ä¹Ÿè¢«ç§°ä¸ºçº¦æŸ

æŸ¥çœ‹å½“å‰åº“(database)ä¸­çš„æ‰€æœ‰è¡¨ï¼š

```sql
# æŸ¥çœ‹db1ä¸‹çš„æ‰€æœ‰è¡¨;
use db1;
show tables;
```

åˆ é™¤å½“å‰åº“(database)ä¸­çš„æŸä¸ªè¡¨ï¼š

```sql
# åˆ é™¤è¡¨ï¼šdb1ä¸‹çš„emp;
use db1;
drop table emp;

# å¦‚æœå­˜åœ¨åˆ™åˆ é™¤ï¼š
drop table if exists emp;

```

### MySqlçš„æ•°æ®ç±»å‹

å¤§è‡´å¦‚ä¸‹ï¼Œæ ‡äº†çº¢æ——çš„å°±æ˜¯å¸¸ç”¨çš„ï¼Œå½“ç„¶è¿˜æœ‰ä¸ªéå¸¸ç½•è§çš„bit(M)ç±»å‹ï¼ŒMæŒ‡å®šä½æ•°ï¼Œé»˜è®¤å€¼1ï¼ŒèŒƒå›´1~64

å¦‚æœç²¾åº¦è¦æ±‚æ¯”ä»·é«˜çš„è¯å°±ç”¨Deicmalæ¥å­˜æ”¾æ•°å€¼

ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šç”¨åˆ°äºŒè¿›åˆ¶ç±»å‹ï¼Œæ–‡ä»¶ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥å­˜åˆ°ä¸€èˆ¬ï¼Œæ•°æ®åº“ä¸­å»ºä¸ªç´¢å¼•è·¯å¾„

![MySqlæ•°æ®ç±»å‹](/images/JavaSE/21-MySql/MySqlæ•°æ®ç±»å‹.svg)

![image-20211120185628320](/images/JavaSE/21-MySql/image-20211120185628320.png)

![image-20211120185641114](/images/JavaSE/21-MySql/image-20211120185641114.png)

![image-20211120192745001](/images/JavaSE/21-MySql/image-20211120192745001.png)

![image-20211120192825877](/images/JavaSE/21-MySql/image-20211120192825877.png)

Charå’ŒVarcharçš„é•¿åº¦ï¼ˆæ¯”å¦‚varchar(255)ï¼‰è¡¨ç¤ºçš„æ˜¯255ä¸ªå­—ç¬¦ï¼Œè€Œå¹¶éæ˜¯255ä¸ªå­—èŠ‚

åæ­£ç”¨çš„æ—¶å€™åªè¦çŸ¥é“ï¼Œå®šä¹‰å¤šé•¿ï¼Œå°±èƒ½æ”¾å¤šå°‘ä¸ªå­—å³å¯

![image-20211120205829953](/images/JavaSE/21-MySql/image-20211120205829953.png)

![image-20211120205914839](/images/JavaSE/21-MySql/image-20211120205914839.png)

#### Decimalç±»å‹é¢å¤–è¯´æ˜

è¿™ä¸ªä¸œè¥¿å¾—é¢å¤–æå‡ºæ¥è¯´ä¸€å˜´

```sql
CREATE TABLE db3(
 num DECIMAL(30,20)
              
);
#ç¬¬ä¸€ä¸ªå€¼å°±æ˜¯æ€»é•¿åº¦ï¼Œç¬¬äºŒä¸ªå€¼å°±æ˜¯å°æ•°æ‰€å é•¿åº¦ï¼›
insert into db3 values(233.1);
# è¿™æ ·æŸ¥è¯¢å¯ä»¥å¾—åˆ°ï¼š233.10000000000000000000 1åé¢æœ‰19ä¸ªå°æ•°

# ä¹Ÿå¯ä»¥è¿™æ ·è®©åªèƒ½æ’å…¥æ•´æ•°ï¼Œä»¥å­˜æ”¾è¾ƒå¤§èŒƒå›´çš„æ•´æ•°
CREATE TABLE db3(
 num DECIMAL(30)
              
);

```

![image-20211120190547035](/images/JavaSE/21-MySql/image-20211120190547035.png)

![image-20211120185843253](/images/JavaSE/21-MySql/image-20211120185726028.png)

![image-20211120185843253.png](/images/JavaSE/21-MySql/image-20211120185843253.png)

#### æ—¶é—´ç›¸å…³ç±»å‹é¢å¤–è¯´æ˜defaultå€¼å’Œon updateå€¼

```sql
CREATE TABLE test_time (
 birthday DATE,
 job_time DATETIME,
 login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP on UPDATE CURRENT_TIMESTAMP
    #TIMESTAMP å¯ä»¥é€šè¿‡defaultæ¥è®¾ç½®åˆå§‹å€¼ å’Œ on update æ¥è®¾ç½®è‡ªåŠ¨æ›´æ–°
    # é™¤äº†DATETIMEï¼Œå…¶ä»–çš„æ—¶é—´å­—æ®µéƒ½å¯ä»¥è²Œä¼¼è¿™æ ·CURRENT_XXX
);
INSERT into test_time(birthday,job_time) values('2011-1-1','2001-1-1 1:1:1');

SELECT * from test_time;

# å¯ä»¥çœ‹åˆ°login_timeè¢«å¡«å……äº†ç›¸å…³æ—¶é—´
+------------+---------------------+---------------------+
| birthday   | job_time            | login_time          |
+------------+---------------------+---------------------+
| 2011-01-01 | 2001-01-01 01:01:01 | 2021-11-20 21:18:36 |
+------------+---------------------+---------------------+

#æ›´æ–°ä¸€ä¸‹è¯•è¯•ï¼š
update test_time set  birthday='2111-11-1' where birthday='2011-01-01';
# å¯ä»¥çœ‹åˆ°login_timeåŒæ­¥çš„è¢«æ›´æ–°äº†
+------------+---------------------+---------------------+
| birthday   | job_time            | login_time          |
+------------+---------------------+---------------------+
| 2111-11-01 | 2001-01-01 01:01:01 | 2021-11-20 21:24:56 |
+------------+---------------------+---------------------+

```

### ä¿®æ”¹è¡¨-å­—æ®µçš„å¢åˆ æ”¹

å¢åŠ å­—æ®µ`alter table è¡¨å add å­—æ®µ1 å­—æ®µç±»å‹ [å¯é€‰çº¦æŸ] [after å­—æ®µ2]`

```sql

alter table emp add image char(255) ;
# åœ¨æŸä¸ªå­—æ®µåé¢æ’å…¥ï¼š

alter table emp add `version` varchar(10) after name;
# åœ¨nameåé¢æ’å…¥version
```

ä¿®æ”¹å­—æ®µå±æ€§`alter table è¡¨å modify å­—æ®µ1 å­—æ®µç±»å‹ [å¯é€‰çº¦æŸ] [after å­—æ®µ2]`

```sql

alter table emp modify job varchar(60);
# å°†å·²æœ‰çš„jobçš„æ•°æ®ç±»å‹æ›¿æ¢ä¸ºvarchar60

alter table emp modify job varchar(60) DEFAULT NULL COMMENT 'å·¥ä½œ';
#èƒ½ä¿®æ”¹å­—æ®µç±»å‹ã€ç±»å‹é•¿åº¦ã€é»˜è®¤å€¼ã€æ³¨é‡Š

alter table emp modify age int after name;
# å°†ageå±æ€§æ”¾åˆ°nameå±æ€§åé¢ï¼Œæ³¨æ„ï¼Œå­—æ®µç±»å‹ä¸èƒ½è½ä¸‹
```

ä¿®æ”¹å­—æ®µååŠå­—æ®µç±»å‹`alter table è¡¨å change æ—§å­—æ®µå æ–°å­—æ®µå æ–°å­—æ®µç±»å‹ [å¯é€‰çº¦æŸ] [after å­—æ®µ2]`

```sql
alter table emp change name user_name varchar(255) not null comment 'ç”¨æˆ·å';

# ä¹Ÿå¯ä»¥åœ¨é‡å‘½ååæ’å…¥åˆ°å…¶ä»–å…ƒç´ åé¢
alter table employee change job today_job varchar(77) after sex;
# å°†jobé‡å‘½ååä¸¢åœ¨sexåé¢ï¼Œæ³¨æ„ï¼Œå­—æ®µç±»å‹ä¸èƒ½è½ä¸‹
```

åˆ é™¤å­—æ®µ`alter table è¡¨å drop å­—æ®µå`

```sql
alter table emp drop name;
```

æŸ¥çœ‹è¡¨çš„ç»“æ„:`desc è¡¨å;`

ä¿®æ”¹è¡¨åï¼š`Rename table è¡¨å to æ–°è¡¨å;`

ä¿®æ”¹è¡¨å­—ç¬¦é›†ï¼š`alter table è¡¨å character set å­—ç¬¦é›†`

## CRUD-å¢åˆ æ”¹æŸ¥

### Insertæ·»åŠ æ•°æ®

è¯­æ³•ï¼š`insert into è¡¨å [å¯é€‰(æ•°æ®é¡¹ç›®)] values(æ•°æ®),[å¯é€‰ (æ•°æ®)]`

æ’å…¥æ•°æ®çš„åŸåˆ™ï¼šæ ¡éªŒç”¨æˆ·çš„æ•°æ®æ˜¯å¦åˆå‘ï¼Œæ˜¯å¦åœ¨ç¬¦åˆé¢„æœŸå†…ï¼Œéœ€å‰åç«¯åŒé‡éªŒè¯+é˜²æ³¨å…¥å¤„ç†ï¼›

```sql
create table person(
    id int,
    name varchar(255),
    price double
);

# æ’å…¥ä¸€æ¡æ•°æ® éœ€è¦ä¼ å…¥æ‰€æœ‰å­—æ®µï¼ˆæŒ‰ç…§é¡ºåºï¼‰
insert into person values(1,"å¼ ä¸‰",1500.1);

# æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®ï¼ˆæŒ‰ç…§æŒ‡å®šå­—æ®µçš„é¡ºåºï¼‰
insert into person(id,name) values(2,"æå››");

+------+--------+--------+
| id   | name   | price  |
+------+--------+--------+
|    1 | å¼ ä¸‰   | 1500.1 |
|    2 | æå››   |   NULL |
+------+--------+--------+

# æ’å…¥å¤šæ¡æ•°æ®(å¯ä»¥é…åˆæŒ‡å®šå­—æ®µä½¿ç”¨)
insert into person values
 (3,"ç‹è€äº”",6663.1),
 (4,"é™ˆå…­",2333.15),
 (4,"å˜å­",159.15);

+------+-----------+---------+
| id   | name      | price   |
+------+-----------+---------+
|    1 | å¼ ä¸‰      |  1500.1 |
|    2 | æå››      |    NULL |
|    3 | ç‹è€äº”    |  6663.1 |
|    4 | é™ˆå…­      | 2333.15 |
|    4 | å˜å­      |  159.15 |
+------+-----------+---------+

```

### Updateæ›´æ–°æ•°æ®

è¯­æ³•ï¼š`update è¡¨å set å­—æ®µå=å­—æ®µå€¼,å­—æ®µå=å­—æ®µå€¼ [å¯é€‰ï¼š whereç­›é€‰å™¨]`

update è¯­æ³•å¯ä»¥ç”¨äºæ›´æ–°åŸæœ‰è¡¨è¡Œä¸­çš„å„åˆ—

setå­—å¥æŒ‡ç¤ºè¦ä¿®æ”¹é‚£äº›è¡Œå’Œè¦ç»™äºˆå“ªäº›å€¼

**whereå­—å¥æŒ‡å®šåº”è¯¥æ›´æ–°å“ªäº›è¡Œï¼Œå¦‚æœæ²¡æœ‰whereï¼Œåˆ™æ›´æ–°æ‰€æœ‰è¡Œ**ï¼Œå®é™…å·¥ä½œä¸­ç»å¯¹ä¸èƒ½çŠ¯è¿™ç§é”™è¯¯......

å¦‚æœè¦ä¿®æ”¹å¤šä¸ªå­—æ®µ å¯ä»¥`set å­—æ®µ1=å€¼1,å­—æ®µ2=å€¼2....`

```sql
#å°†è¡¨ä¸­çš„æ‰€æœ‰æ¡ç›®çš„priceå­—æ®µä¿®æ”¹ä¸º1000
update person set price = 1000;
+------+-----------+-------+
| id   | name      | price |
+------+-----------+-------+
|    1 | å¼ ä¸‰      |  1000 |
|    2 | æå››      |  1000 |
|    3 | ç‹è€äº”    |  1000 |
|    4 | é™ˆå…­      |  1000 |
|    4 | å˜å­      |  1000 |
+------+-----------+-------+


#å°†å§“åä¸ºå¼ ä¸‰çš„äººçš„priceä¿®æ”¹ä¸º2000
update person set price = 2000 where name = "å¼ ä¸‰";
+------+--------+-------+
| id   | name   | price |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  2000 |
+------+--------+-------+


#å°†æ‰€æœ‰äººçš„å·¥èµ„æ”¹å˜ä¸ºåŸæœ¬çš„å·¥èµ„+1500
update person set price = price+1000;
+------+-----------+-------+
| id   | name      | price |
+------+-----------+-------+
|    1 | å¼ ä¸‰      |  3000 |
|    2 | æå››      |  2000 |
|    3 | ç‹è€äº”    |  2000 |
|    4 | é™ˆå…­      |  2000 |
|    4 | å˜å­      |  2000 |
+------+-----------+-------+

# å°†æå››çš„å·¥èµ„å˜ä¸ºåŸæœ¬çš„å·¥èµ„+666
update person set price = price+666 where name = 'æå››';
+------+--------+-------+
| id   | name   | price |
+------+--------+-------+
|    2 | æå››   |  2666 |
+------+--------+-------+



```

### Deleteåˆ é™¤æ•°æ®

è¯­æ³•ï¼š`delete from è¡¨å [å¯é€‰ where ç­›é€‰å™¨]`

å¦‚æœæ²¡æœ‰å¸¦whereï¼Œåˆ™åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®

ä½¿ç”¨deleteè¯­å¥ä»…åˆ é™¤è®°å½•ï¼Œä¸åˆ é™¤è¡¨çš„æœ¬èº«ï¼Œå¦‚æœè¯´è¦åˆ é™¤ä¸€ä¸ªè¡¨ï¼Œä¸€èˆ¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨`drop table è¡¨å`è¯­å¥

```sql
# åˆ é™¤è¡¨ä¸­name=ç‹è€äº”çš„äºº;
delete from person where name = "ç‹è€äº”";

# åˆ é™¤æŸä¸ªè¡¨ä¸­çš„æ‰€æœ‰æ•°æ® è°¨æ…ä½¿ç”¨
delete from person;

# å¦‚æœè¯´æ˜¯æƒ³åˆ é™¤æŸä¸€åˆ—çš„æ‰€æœ‰å€¼ï¼Œå»ºè®®ä½¿ç”¨update
update person set price=null ;
#æ›¿æ¢ä¸ºnullçš„æ–¹å¼ æˆ–è€…ç”¨æ›¿æ¢ä¸º"",0ä¹‹ç±»çš„æ–¹å¼
+------+-----------+-------+
| id   | name      | price |
+------+-----------+-------+
|    1 | å¼ ä¸‰      |  NULL |
|    2 | æå››      |  NULL |
|    3 | ç‹è€äº”    |  NULL |
|    4 | é™ˆå…­      |  NULL |
|    4 | å˜å­      |  NULL |
+------+-----------+-------+

#å¦‚æœè¯´æƒ³è¦åˆ é™¤ä¸€åˆ—ï¼Œç›´æ¥é€šè¿‡æ“ä½œå­—æ®µçš„æ–¹å¼ï¼š
alter table person drop price;

# æ€»ä¹‹ï¼Œé™¤ééå¸¸æ˜ç¡®è‡ªå·±ç¡®å®è¦åˆ é™¤è¿™ä¸ªè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä¸ç„¶åƒä¸‡ä¸è¦
delete from person;
# æ­£å¸¸æƒ…å†µä¸‹ï¼Œåˆ é™¤æ•°æ®å¿…é¡»åŠ whereç­›é€‰å™¨

```

### åˆ é™¤è¡¨æ•°æ®å¢å¼º

1. å½“ä½ ä¸å†éœ€è¦è¯¥è¡¨æ—¶ï¼Œ ç”¨ dropï¼š`drop tableè¡¨å`
   - drop æ˜¯ç›´æ¥å°†è¡¨æ ¼åˆ é™¤ï¼Œæ— æ³•æ‰¾å›ã€‚ä¾‹å¦‚åˆ é™¤ user è¡¨ï¼š

2. å½“ä½ ä»è¦ä¿ç•™è¯¥è¡¨ï¼Œä½†è¦åˆ é™¤æ‰€æœ‰è®°å½•æ—¶ï¼Œç”¨truncate
    `truncate ï¼ˆtableï¼‰ è¡¨å`
   - truncate æ˜¯åˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ®ï¼Œä½†ä¸èƒ½ä¸whereä¸€èµ·ä½¿ç”¨ï¼›

3. å½“ä½ è¦åˆ é™¤éƒ¨åˆ†è®°å½•æˆ–è€…æœ‰å¯èƒ½ä¼šåæ‚”çš„è¯ï¼Œ ç”¨ delete
   `delete from è¡¨å [where]`
   - delete ä¹Ÿæ˜¯åˆ é™¤è¡¨ä¸­æ•°æ®ï¼Œä½†å¯ä»¥ä¸whereè¿ç”¨ï¼Œåˆ é™¤ç‰¹å®šè¡Œï¼›

å®ƒä»¬ä¸‰è€…æ›´è¯¦ç»†çš„è¯´æ˜å¯ä»¥çœ‹[è¿™é‡Œ](https://www.cnblogs.com/fcc-123/p/10672604.html)

å¦‚æœè¯´æƒ³è¦åˆ é™¤æŸä¸ªè¡¨å¹¶ä¸”ä¸ç•™æœ‰ç¼“å­˜ï¼Œä½†æ˜¯åˆå…ˆä½¿ç”¨äº†deleteåˆ é™¤ï¼Œé‚£ä¹ˆå†è¡¥ä¸€æ¬¡truncate å³å¯

# Select æŸ¥æ‰¾-å•è¡¨æŸ¥è¯¢

â€‹  çœ‹åˆ°è¿™ä¸ªH1æ ‡é¢˜äº†å—ï¼Œæ˜¯æ•´ä¸ªsqlä¸­æœ€é‡è¦çš„ç©æ„ã€‚æ²¡æœ‰ä»»ä½•ä¸œè¥¿æ¯”ä»–æ›´é‡è¦äº†ã€‚åœ¨ä»»ä½•ç±»å‹ã€ä»»ä½•ç§ç±»çš„æ•°æ®åº“ä¸­ï¼ŒæŸ¥æ‰¾æ°¸è¿œéƒ½æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼ŒæŸ¥æ‰¾å¯¹äºæ•°æ®åº“æ¥è¯´å°±å¥½æ¯”ï¼Œé¥­å¯¹äºäººçš„é‡è¦æ€§ä¸€èˆ¬ã€‚

## åŸºæœ¬è¯­æ³•

åŸºæœ¬è¯­æ³•å¾ˆç®€å•ï¼š

`select [å¯é€‰ï¼šdistinct] *å·æˆ–è€…å­—æ®µå1ï¼Œå­—æ®µå2ï¼Œå­—æ®µå3... from è¡¨å`

distinct: å»é‡ï¼Œå½“ç»“æœä¸­æœ‰é‡å¤å€¼çš„æ—¶å€™è‡ªåŠ¨åˆå¹¶å»é‡

ä¹Ÿå¯ä»¥ç»™å­—æ®µå–ä¸ªåˆ«åï¼š`select å­—æ®µ1 as 'åˆ«å1',å­—æ®µ2 as 'åˆ«å2'... from è¡¨å`

**å­—æ®µåæ˜¯ä½¿ç”¨è¿ç®—ç¬¦çš„**

ç„¶ååœ¨è¡¨ååé¢å¯ä»¥è·Ÿwhereè¯­å¥ï¼š`select ç›¸å…³æ•°æ® from è¡¨å where ç›¸å…³é€»è¾‘è¡¨è¾¾å¼`

ä¸‹é¢ä¼šæ¼”ç¤ºçš„è¡¨è¾¾å¼ï¼šï¼ˆä»£ç å—æœ€åï¼‰è¿ç®—ï¼Œå¤§å°ç­‰äºï¼Œand å’Œæ¨¡ç³ŠåŒ¹é…ä¸æ­£åˆ™è¡¨è¾¾å¼

[è¿ç®—ç¬¦é“¾æ¥](https://www.runoob.com/mysql/mysql-operator.html)ï¼Œ[æ­£åˆ™è¡¨è¾¾å¼é“¾æ¥](https://www.runoob.com/mysql/mysql-regexp.html)ï¼Œ[Likeæ¨¡ç³ŠåŒ¹é…é“¾æ¥](https://www.runoob.com/mysql/mysql-like-clause.html)

```sql
use db1;
#è·å–personä¸­çš„æ‰€æœ‰å­—æ®µ
select * from person; 
+------+-----------+-------+
| id   | name      | price |
+------+-----------+-------+
|    1 | å¼ ä¸‰      |  1500 |
|    2 | æå››      |  1500 |
|    3 | ç‹è€äº”    |  1500 |
|    4 | é™ˆå…­      |  1500 |
+------+-----------+-------+

select name,price from person;
#åªè·å–å§“åï¼Œè–ªæ°´
+-----------+-------+
| name      | price |
+-----------+-------+
| å¼ ä¸‰      |  1500 |
| æå››      |  1500 |
| ç‹è€äº”    |  1500 |
| é™ˆå…­      |  1500 |
+-----------+-------+

select name as "å§“å" ,price as "è–ªæ°´" from person;
#ç»™è·å–åˆ°çš„å€¼é‡å‘½å
+-----------+--------+
| å§“å      | è–ªæ°´   |
+-----------+--------+
| å¼ ä¸‰      |   1500 |
| æå››      |   1500 |
| ç‹è€äº”    |   1500 |
| é™ˆå…­      |   1500 |
+-----------+--------+

select distinct price from person;
# ç»™è–ªæ°´å»é‡ï¼Œæ³¨æ„ï¼Œè¿™é‡Œå»é‡çš„è¯å¾—æ˜¯å¾—åˆ°çš„æ‰€æœ‰å­—æ®µå€¼ä¸€è‡´
+-------+
| price |
+-------+
|  1500 |
+-------+

#åŠ å…¥nameå­—æ®µï¼Œåˆ¤å®šçš„æ—¶å€™ä¹Ÿä¼šåˆ¤å®šnameæ˜¯å¦é‡å¤
# åªæœ‰nameï¼Œpriceå®Œå…¨ç›¸åŒçš„æ—¶å€™æ‰ä¼šå»é‡
select distinct name,price from person;
+-----------+-------+
| name      | price |
+-----------+-------+
| å¼ ä¸‰      |  1500 |
| æå››      |  1500 |
| ç‹è€äº”    |  1500 |
| é™ˆå…­      |  1500 |
+-----------+-------+


# ç»™Studentè¡¨
+-----------+---------+------+---------+
| name      | chinese | math | english |
+-----------+---------+------+---------+
| å¼ ä¸‰      |     100 |   50 |      50 |
| æå››      |      50 |   80 |     100 |
| ç‹è€äº”    |      75 |   99 |     105 |
| è€éŸ©      |      60 |   80 |     100 |
| è€æ      |      40 |   30 |      50 |
| å¼ é£      |      60 |   63 |      53 |
| ç‰¹æœ—æ™®    |       0 |   60 |     100 |
| è”¡è€ç‹—    |      60 |   80 |      50 |
+-----------+---------+------+---------+
#ä¸­çš„æ¯ä¸ªå­¦å‘˜çš„æ€»æˆç»©è¿›è¡Œç›¸åŠ å¹¶ç®—å‡ºå…¶å¹³å‡å€¼

select name ,(chinese+math+english) as "æ€»åˆ†" from student;
+-----------+--------+
| name      | æ€»åˆ†   |
+-----------+--------+
| å¼ ä¸‰      |    200 |
| æå››      |    230 |
| ç‹è€äº”    |    279 |
| è€éŸ©      |    240 |
| è€æ      |    120 |
| å¼ é£      |    176 |
| ç‰¹æœ—æ™®    |    160 |
| è”¡è€ç‹—    |    190 |
+-----------+--------+

#é™„å¸¦ä¸Šå¹³å‡è´¹
select name ,(chinese+math+english) as "æ€»åˆ†",(chinese+math+english)/3 as "å¹³å‡åˆ†" from student;
+-----------+--------+-----------+
| name      | æ€»åˆ†   | å¹³å‡åˆ†    |
+-----------+--------+-----------+
| å¼ ä¸‰      |    200 |   66.6667 |
| æå››      |    230 |   76.6667 |
| ç‹è€äº”    |    279 |   93.0000 |
| è€éŸ©      |    240 |   80.0000 |
| è€æ      |    120 |   40.0000 |
| å¼ é£      |    176 |   58.6667 |
| ç‰¹æœ—æ™®    |    160 |   53.3333 |
| è”¡è€ç‹—    |    190 |   63.3333 |
+-----------+--------+-----------+

# ä½¿ç”¨ç®€å•çš„whereè¯­å¥
select * from student where name = 'æå››';
+--------+---------+------+---------+
| name   | chinese | math | english |
+--------+---------+------+---------+
| æå››   |      50 |   80 |     100 |
+--------+---------+------+---------+
#è‹±è¯­å¤§äº60
select * from student where english>60;
+-----------+---------+------+---------+
| name      | chinese | math | english |
+-----------+---------+------+---------+
| æå››      |      50 |   80 |     100 |
| ç‹è€äº”    |      75 |   99 |     105 |
| è€éŸ©      |      60 |   80 |     100 |
| ç‰¹æœ—æ™®    |       0 |   60 |     100 |
+-----------+---------+------+---------+
#æ€»åˆ†å¤§äº200
select * from student where (chinese+math+english)>200;
+-----------+---------+------+---------+
| name      | chinese | math | english |
+-----------+---------+------+---------+
| æå››      |      50 |   80 |     100 |
| ç‹è€äº”    |      75 |   99 |     105 |
| è€éŸ©      |      60 |   80 |     100 |
+-----------+---------+------+---------+

#æ•°å­¦å¤§äº60ä¸”ä¸­æ–‡å¤§äº50çš„äººï¼š
select * from student where math>60 and chinese>50;
+-----------+---------+------+---------+
| name      | chinese | math | english |
+-----------+---------+------+---------+
| ç‹è€äº”    |      75 |   99 |     105 |
| è€éŸ©      |      60 |   80 |     100 |
| å¼ é£      |      60 |   63 |      53 |
| è”¡è€ç‹—    |      60 |   80 |      50 |
+-----------+---------+------+---------+

#è‹±è¯­æˆç»©å¤§äºè¯­æ–‡æˆç»©:
select * from student where english>chinese;
+-----------+---------+------+---------+
| name      | chinese | math | english |
+-----------+---------+------+---------+
| æå››      |      50 |   80 |     100 |
| ç‹è€äº”    |      75 |   99 |     105 |
| è€éŸ©      |      60 |   80 |     100 |
| è€æ      |      40 |   30 |      50 |
| ç‰¹æœ—æ™®    |       0 |   60 |     100 |
+-----------+---------+------+---------+

#æŸ¥è¯¢æ•°å­¦åˆ†æ•°ä¸º80å’Œ99çš„åŒå­¦
select name "å§“å",math "æ•°å­¦åˆ†æ•°" from student where math in (80,99);
+-----------+--------------+
| å§“å      | æ•°å­¦åˆ†æ•°     |
+-----------+--------------+
| æå››      |           80 |
| ç‹è€äº”    |           99 |
| è€éŸ©      |           80 |
| è”¡è€ç‹—    |           80 |
+-----------+--------------+

#æŸ¥è¯¢å¹³å‡åˆ†å¤§äº50ä¸” æ•°å­¦æˆç»©å¤§äºè‹±è¯­æˆç»© çš„å§“å¼ çš„å­¦ç”Ÿ;

#ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…
select * from student where (chinese +math+english)/3>50 and math>english and name like "å¼ %";

#ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
select * from student where (chinese +math+english)/3>50 and math>english and name REGEXP '^å¼ ';
+--------+---------+------+---------+
| name   | chinese | math | english |
+--------+---------+------+---------+
| å¼ é£   |      60 |   63 |      53 |
+--------+---------+------+---------+


```

## ç»Ÿè®¡å‡½æ•°

### Order By å¯¹ç»“æœè¿›è¡Œæ’åº

è¯­æ³•ï¼š`select æ¡ç›® from è¡¨å [æ¡ä»¶ç­›é€‰ where] order by æ ¹æ®å“ªä¸ªå­—æ®µ asc|desc`

ASC å‡åºï¼ˆé»˜è®¤ï¼‰ ã€DESC é™åº

```sql
# æ ¹æ®æ•°å­¦æˆç»©å‡åºæ’åˆ—
select * from student order by math;
+-----------+---------+------+---------+
| name      | chinese | math | english |
+-----------+---------+------+---------+
| è€æ      |      40 |   30 |      50 |
| å¼ ä¸‰      |     100 |   50 |      50 |
| ç‰¹æœ—æ™®    |       0 |   60 |     100 |
| å¼ é£      |      60 |   63 |      53 |
| æå››      |      50 |   80 |     100 |
| è€éŸ©      |      60 |   80 |     100 |
| è”¡è€ç‹—    |      60 |   80 |      50 |
| ç‹è€äº”    |      75 |   99 |     105 |
+-----------+---------+------+---------+

# åŠ ä¸Šwhereç­›é€‰å™¨ æ ¹æ®è¯­æ–‡æˆç»©å‡åºæ’åº
select * from student where name like "å¼ %" order by chinese ;
+--------+---------+------+---------+
| name   | chinese | math | english |
+--------+---------+------+---------+
| å¼ é£   |      60 |   63 |      53 |
| å¼ ä¸‰   |     100 |   50 |      50 |
+--------+---------+------+---------+


# é™åº
select * from student where name like "å¼ %" order by chinese desc;
+--------+---------+------+---------+
| name   | chinese | math | english |
+--------+---------+------+---------+
| å¼ ä¸‰   |     100 |   50 |      50 |
| å¼ é£   |      60 |   63 |      53 |
+--------+---------+------+---------+

# æ ¹æ®æ€»åˆ†è¿›è¡Œå‡åºæ’åº as å¯ä»¥å®šä¹‰å±€éƒ¨å˜é‡
select name,(chinese+math+english) as total_sorce from student order by total_sorce;
+-----------+-------------+
| name      | total_sorce |
+-----------+-------------+
| è€æ      |         120 |
| ç‰¹æœ—æ™®    |         160 |
| å¼ é£      |         176 |
| è”¡è€ç‹—    |         190 |
| å¼ ä¸‰      |         200 |
| æå››      |         230 |
| è€éŸ©      |         240 |
| ç‹è€äº”    |         279 |
+-----------+-------------+
```

### Count-åˆå¹¶ã€ç»Ÿè®¡å‡½æ•°

è¯­æ³•ï¼š`select count(*)|count(åˆ—å) from è¡¨å [å¯é€‰ whereç­‰]`

count(*)å’Œcount(åˆ—å)çš„åŒºåˆ«

- count(*) è¿”å›æ»¡è¶³æ¡ä»¶çš„è®°å½•çš„è¡Œæ•°ï¼Œä¸ä¼šæ’é™¤å€¼ä¸ºnullçš„
  - æ¯”å¦‚è¯´ä¸€ä¸ªäººå§“åå¹´é¾„ageä¹‹ç±»çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¸ºnullï¼Œä¾ç„¶ä¹Ÿä¼šè®¡å…¥+1
- count(åˆ—å) ç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„æŸåˆ—æœ‰å¤šå°‘ä¸ªï¼Œä¼šæ’é™¤å€¼ä¸ºnullçš„
  - æ¯”å¦‚è¯´è¦ç»Ÿè®¡age ç„¶åæœ‰ä¸€ä¸ªäººçš„ageä¸ºnullï¼Œåˆ™è¿™ä¸ªäººå°†ä¸ä¼šç®—å…¥å…¶ä¸­ï¼Œä¸ä¼š+1

```sql
#ç»Ÿè®¡å­¦ç”Ÿè¡¨å…±æœ‰å¤šå°‘è¡Œ
select count(*) as count from student;
+-------+
| count |
+-------+
|     8 |
+-------+

# ç»Ÿè®¡æ•°å­¦æˆç»©å¤§äºç­‰äº80çš„å­¦ç”Ÿæœ‰å¤šå°‘
select count(math) as count from student where math >=80;
+-------+
| count |
+-------+
|     4 |
+-------+

# ç»Ÿè®¡æ€»åˆ†å¤§äº200çš„äººæ•°æœ‰å¤šå°‘
select count(*) from student where (chinese+math+english)>200;
+----------+
| count(*) |
+----------+
|        3 |
+----------+

```

### SUM- åˆè®¡å‡½æ•°-è®¡ç®—æ•°å€¼çš„æ€»åˆ

è¯¥å‡½æ•°æ»¡è¶³whereæ¡ä»¶çš„è¡Œçš„å’Œï¼Œä¸€èˆ¬ç”¨äºæ•°å€¼åˆ—

è¯­æ³•ï¼š`select sum(åˆ—å)ï¼Œ{sum(åˆ—å)...} from è¡¨å [whereç­›é€‰å™¨]`

åªèƒ½å¯¹æ•°å€¼ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™

```sql
# è®¡ç®—æ•°å­¦çš„æ€»æˆç»©
select sum(math) "æ•°å­¦" from student;
+--------+
| æ•°å­¦   |
+--------+
|    542 |
+--------+

#ç»Ÿè®¡è¯­æ–‡ï¼Œæ•°å­¦ï¼Œè‹±è¯­å„ç§‘çš„æ€»æˆç»©
select sum(chinese) "è¯­æ–‡",sum(math) "æ•°å­¦",sum(english) "è‹±è¯­" from student;
+--------+--------+--------+
| è¯­æ–‡   | æ•°å­¦   | è‹±è¯­   |
+--------+--------+--------+
|    445 |    542 |    608 |
+--------+--------+--------+

#ç»Ÿè®¡è¯­æ–‡æ•°å­¦è‹±è¯­çš„æˆç»©æ€»å’Œ
select sum(chinese+math+english) "æ€»åˆ†" from student;
+--------+
| æ€»åˆ†   |
+--------+
|   1595 |
+--------+


#ç»Ÿè®¡å¹³å‡åˆ†
select sum(chinese+math+english)/count(*) "å¹³å‡åˆ†" from student ;
+-----------+
| å¹³å‡åˆ†    |
+-----------+
|  199.3750 |
+-----------+
```

### AVG-åˆè®¡å‡½æ•°-æ±‚å¹³å‡å€¼

è¿”å›æ»¡è¶³whereæ¡ä»¶çš„ä¸€åˆ—çš„å¹³å‡å€¼

è¯­æ³•ï¼š`select avg(åˆ—å){avg(åˆ—å)...} from è¡¨å [where]`

åªèƒ½å¯¹æ•°å€¼ä½¿ç”¨

```sql
# æ±‚æ•°å­¦å¹³å‡åˆ†;
select avg(math) as "æ•°å­¦å¹³å‡åˆ†" from student;
+-----------------+
| æ•°å­¦å¹³å‡åˆ†       |
+-----------------+
|         67.7500 |
+-----------------+

# æ€»å¹³å‡åˆ†
select avg(chinese+math+english) as "æ€»å¹³å‡åˆ†" from student;
+--------------+
| æ€»å¹³å‡åˆ†      |
+--------------+
|     199.3750 |
+--------------+
```

### Max/Min-åˆè®¡å‡½æ•°-è¿”å›æœ€å¤§æœ€å°å€¼

è¿”å›æ»¡è¶³whereæ¡ä»¶åˆ—çš„æœ€å¤§ã€æœ€å°å€¼

è¯­æ³•ï¼š`select max|min(åˆ—å) from è¡¨å [where]`

```sql
#æ±‚ä¸€ä¸ªç­çº§çš„æ€»æœ€é«˜åˆ†å’Œæ€»æœ€ä½åˆ†
select max(chinese+math+english) "æœ€é«˜åˆ†",min(chinese+math+english) "æœ€ä½åˆ†" from student;
+-----------+-----------+
| æœ€é«˜åˆ†    | æœ€ä½åˆ†    |
+-----------+-----------+
|       279 |       120 |
+-----------+-----------+

```

### Group By+Having-åˆ†ç»„+è¿‡æ»¤

è¯­æ³•ï¼š`select å­—æ®µ1,å­—æ®µ2,... from è¡¨å [whereç­›é€‰å™¨] group by å­—æ®µ`

å¯é€‰ï¼Œä½¿ç”¨havingå­—å¥å¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œè¿‡æ»¤ ä¸€èˆ¬æƒ…å†µä¸‹group byå’Œhavingæ˜¯å½¢å½±ä¸ç¦»çš„

`select å­—æ®µ1,å­—æ®µ2,... from è¡¨å group by å­—æ®µ having...`

```sql
# å…ˆåˆ†åˆ«å»ºç«‹å¥½å‡ å¼ è¡¨
create table dept( /*éƒ¨é—¨è¡¨*/
 deptno MEDIUMINT unsigned not null default 0,
    dname varchar(20) not null default "",
    loc varchar(13) not null default ""
);
insert into dept values
(10,"ACCOUNTING","NEW Work"),
(20,"RESEARCH","DALLAS"),
(30,"SALES","CHICAGO"),
(40,"OPERATIONS","BOSTON");
# å‘˜å·¥è¡¨
create table emp(
 empno mediumint unsigned not null default 0,/*ç¼–å·*/
    ename varchar(20) not null default "",/*åå­—*/
    job varchar(9) not null default "",/*å·¥ä½œ*/
    mgr mediumint unsigned,/*ä¸Šçº§ç¼–å·*/
    hiredate DATE not null,/*å…¥èŒæ—¶é—´*/
    sal DECIMAL(7,2) not null,/*è–ªæ°´*/
    comm DECIMAL(7,2),/*çº¢åˆ©*/
    deptno mediumint unsigned not null default 0/*éƒ¨é—¨ç¼–å·*/
);
insert into emp values
 (7369,'SMITH','CLERK',7902,'1990-12-17',800.00,NULL,20),
 (7521,'WARD','SALESMAN',7698,'1991-2-20',1600.00,300.00,30),
 (7566,'JONES','SALESMAN',7698,'1991-2-22',2100.02,500.00,30),
 (7654,'MARTIN','MANAGER',7939,'1991-9-28',645.20,NULL,20),
 (7782,'BLACK','SALESMAN',7698,'1995-10-17',625.00,1250.00,30),
 (7788,'COALK','MANAGER',7698,'1997-4-19',3954.20,NULL,10),
 (7839,'SOCTT','MANAGER',7939,'1991-12-3',2681.30,2450.00,20),
 (7844,'KING','ANALYST',7566,'1992-5-7',1564.60,211.00,10),
 (7900,'TURNER','PRESIDENT',NULL,'1888-1-1',2435.00,NULL,30),
 (7902,'JAMES','CLERK',7698,'1996-1-13',433.10,255.52,20),
 (7934,'FORD','ANALYST',7566,'1990-6-3',6321.50,153.025,10),
 (7966,'MILLER','CLERK',7782,'1991-10-12',735.05,453.25,20);
#å·¥èµ„çº§åˆ«è¡¨
create table salgrade(
 grade mediumint unsigned not null default 0,/*å·¥èµ„çº§åˆ«*/
    losal decimal(17,2) not null,/*è¯¥çº§åˆ«çš„æœ€ä½å·¥èµ„*/
    hisal decimal(17,2) not null/*è¯¥çº§åˆ«çš„æœ€é«˜å·¥èµ„*/
);

insert into salgrade values
 (1,700,1200),
 (2,1201,1400),
 (3,1401,2000),
 (4,2001,3000),
 (5,3001,9999);
```

æ¥ä¸‹æ¥ä½¿ç”¨Group By+Havingå®Œæˆä¸€ç³»åˆ—æ“ä½œ

```sql
# æ˜¾ç¤ºæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å’Œæœ€é«˜å·¥èµ„,æŒ‰ç…§éƒ¨é—¨æ¥åˆ†ç»„æŸ¥è¯¢ å¹¶ä»ä½åˆ°é«˜æ’åº
select avg(sal) "å¹³å‡å·¥èµ„",max(sal) "æœ€é«˜å·¥èµ„",deptno "éƒ¨é—¨åˆ†ç»„" from emp group by deptno order by deptno;
+--------------+--------------+--------------+
| å¹³å‡å·¥èµ„       | æœ€é«˜å·¥èµ„      | éƒ¨é—¨åˆ†ç»„      |
+--------------+--------------+--------------+
|  3946.766667 |      6321.50 |           10 |
|  1004.950000 |      2681.30 |           20 |
|  1690.005000 |      2435.00 |           30 |
+--------------+--------------+--------------+

#æ˜¾ç¤º æ¯ä¸ªéƒ¨é—¨ çš„ æ¯ç§å²—ä½ çš„ å¹³å‡å·¥èµ„ å’Œ æœ€ä½å·¥èµ„
select avg(sal) "å¹³å‡å·¥èµ„",min(sal) "æœ€ä½å·¥èµ„",deptno "éƒ¨é—¨åˆ†ç»„",job "å²—ä½" from emp group by deptno,job ;
+--------------+--------------+--------------+-----------+
| å¹³å‡å·¥èµ„      | æœ€ä½å·¥èµ„      | éƒ¨é—¨åˆ†ç»„       | å²—ä½      |
+--------------+--------------+--------------+-----------+
|   675.800000 |       433.10 |           20 | CLERK     |
|  1441.673333 |       625.00 |           30 | SALESMAN  |
|  1663.250000 |       645.20 |           20 | MANAGER   |
|  3954.200000 |      3954.20 |           10 | MANAGER   |
|  3943.050000 |      1564.60 |           10 | ANALYST   |
|  2435.000000 |      2435.00 |           30 | PRESIDENT |
+--------------+--------------+--------------+-----------+

# æ˜¾ç¤ºå¹³å‡å·¥èµ„ä½äº2000çš„éƒ¨é—¨å·å’Œå®ƒçš„å¹³å‡å·¥èµ„ ä½¿ç”¨äº†having
select avg(sal) as sal_avg,deptno from emp group by deptno having sal_avg<2000 ;
+-------------+--------+
| sal_avg     | deptno |
+-------------+--------+
| 1004.950000 |     20 |
| 1690.005000 |     30 |
+-------------+--------+

```

![image-20211121154510850](/images/JavaSE/21-MySql/image-20211121154510850.png)

## å­—ç¬¦ä¸²å‡½æ•°

![image-20211121154625191](/images/JavaSE/21-MySql/image-20211121154625191.png)

```sql
#è¿”å›å­—ä¸²å­—ç¬¦é›†
select charset(ename) from emp;
#utf8mb3å°±æ˜¯utf8
+----------------+
| charset(ename) |
+----------------+
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
| utf8mb3        |
+----------------+

#æ‹¼æ¥å­—æ®µ
select concat(ename,"å·¥ä½œæ˜¯",job) "å§“åå’Œå·¥ä½œ" from emp;
+--------------------------+
| å§“åå’Œå·¥ä½œ               |
+--------------------------+
| SMITHå·¥ä½œæ˜¯CLERK         |
| WARDå·¥ä½œæ˜¯SALESMAN       |
| JONESå·¥ä½œæ˜¯SALESMAN      |
| MARTINå·¥ä½œæ˜¯MANAGER      |
| BLACKå·¥ä½œæ˜¯SALESMAN      |
| COALKå·¥ä½œæ˜¯MANAGER       |
| SOCTTå·¥ä½œæ˜¯MANAGER       |
| KINGå·¥ä½œæ˜¯ANALYST        |
| TURNERå·¥ä½œæ˜¯PRESIDENT    |
| JAMESå·¥ä½œæ˜¯CLERK         |
| FORDå·¥ä½œæ˜¯ANALYST        |
| MILLERå·¥ä½œæ˜¯CLERK        |
| MILLERå·¥ä½œæ˜¯CLERK        |
+--------------------------+

# æŸ¥è¯¢  å­—æ®µ2 åœ¨å­—æ®µ1ä¸­å‡ºç°çš„ä½ç½®ï¼Œæ²¡æœ‰åˆ™è¿”å›0
select instr("hello world",'world');
+------------------------------+
| instr("hello world",'world') |
+------------------------------+
|                            7 |
+------------------------------+

#è½¬æ¢æˆå°å†™
select lcase("ABCEDf");
+-----------------+
| lcase("ABCEDf") |
+-----------------+
| abcedf          |
+-----------------+

#è½¬æ¢æˆå¤§å†™
select ucase("dlkjkl");
+-----------------+
| lcase("ABCEDf") |
+-----------------+
| abcedf          |
+-----------------+

#ä»æŸä¸ªå­—ç¬¦ä¸²å–nä¸ªå­—ç¬¦å‡ºæ¥ï¼ˆå·¦è¾¹å¼€å§‹å–ï¼‰
select left("hello world",4);
+-----------------------+
| left("hello world",4) |
+-----------------------+
| hell                  |
+-----------------------+

#right å’Œä¸Šæ–¹åŒç†ï¼Œä¸è¿‡æ˜¯ä»å³è¾¹å¼€å§‹å–


# è¿”å›strçš„é•¿åº¦ ï¼ˆæŒ‰ç…§å­—èŠ‚ï¼‰
select length("ä¸–ç•Œä½ å¥½");
+------------------------+
| length("ä¸–ç•Œä½ å¥½")     |
+------------------------+
|                     12 |
+------------------------+

# å°†hello world ä¸­çš„hello æ›¿æ¢ä¸º ä½ å¥½
select replace("hello world","hello","ä½ å¥½") "Replace";
+--------------+
| Replace      |
+--------------+
| ä½ å¥½ world   |
+--------------+

#é€å­—ç¬¦æ¯”è¾ƒä¸¤å­—ç¬¦ä¸²å¤§å°;
select strcmp("hello","hello");# è¿”å›0
select strcmp("hello","jello"); # -1 å³è¾¹æ¯”å·¦è¾¹å¤§è¿”å›è´Ÿæ•°ï¼Œå·¦è¾¹æ¯”å³è¾¹å¤§è¿”å›æ­£æ•°

#æˆªå–å­—ç¬¦ä¸²-->æˆ‘æƒ³ä»helloä¸­æˆªå–ell---> string,startindex,length
select substring("hello",2,3);
+------------------------+
| substring("hello",2,3) |
+------------------------+
| ell                    |
+------------------------+
#æˆªå–ç¬¬äºŒä½å¼€å§‹åŠåé¢æ‰€æœ‰---> string,startindex
+----------------------+
| substring("hello",2) |
+----------------------+
| ello                 |
+----------------------+

# å–å‡ºå‰ç«¯ç©ºæ ¼ ltrim å³ç«¯ç©ºæ ¼ rtrim å‰åç«¯ç©ºæ ¼ä¸€èµ·å»é™¤ trim
select trim("  æµ‹è¯•   ");
+---------------------+
| trim("  æµ‹è¯•   ")   |
+---------------------+
| æµ‹è¯•                |
+---------------------+


# ä»¥é¦–å­—æ¯å¤§å†™ï¼Œå…¶ä½™å­—æ¯å°å†™çš„å½¢å¼æ˜¾ç¤ºæ‰€æœ‰å‘˜å·¥å
select concat(ucase(left(ename,1)),lcase(substring(ename,2))) "å‘˜å·¥å§“å" from emp;
+--------------+
| å‘˜å·¥å§“å     |
+--------------+
| Smith        |
| Ward         |
| Jones        |
| Martin       |
| Black        |
| Coalk        |
| Soctt        |
| King         |
| Turner       |
| James        |
| Ford         |
| Miller       |
| Miller       |
+--------------+
```

## æ•°å­¦ç›¸å…³å‡½æ•°

![image-20211121163030748](/images/JavaSE/21-MySql/image-20211121163030748.png)

```sql
# æ¯”è¾ƒç®€å•çš„è¿™é‡Œä¸å†™äº†ï¼Œå†™ä¸€äº›çœ‹èµ·æ¥éš¾ç†è§£çš„

#å°†10è¿›åˆ¶çš„8ï¼Œè½¬æ¢æˆ2è¿›åˆ¶è¾“å‡º
select conv(8,10,2);
+--------------+
| conv(8,10,2) |
+--------------+
| 1000         |
+--------------+
#å°†16è¿›åˆ¶çš„9ï¼Œè½¬æ¢ä¸º2è¿›åˆ¶è¾“å‡º
select conv(9,16,2);
+--------------+
| conv(9,16,2) |
+--------------+
| 1001         |
+--------------+

#å°†2è¿›åˆ¶çš„10001ï¼Œè½¬æ¢æˆ10è¿›åˆ¶
select conv(10001,2,10);
+------------------+
| conv(10001,2,10) |
+------------------+
| 17               |
+------------------+

# ä¿ç•™å°æ•°ä½æ•° åªä¿ç•™ä¸¤ä½ï¼ˆè‡ªåŠ¨å››èˆäº”å…¥ï¼‰
select format(78.12543,2);
+--------------------+
| format(78.12543,2) |
+--------------------+
| 78.13              |
+--------------------+


# å– 1 -1 5 15 35 0 -200 ä¹‹ä¸­æœ€å°çš„å€¼
select least( 1 ,-1, 5 ,15 ,35, 0 ,-200 );
+------------------------------------+
| least( 1 ,-1, 5 ,15 ,35, 0 ,-200 ) |
+------------------------------------+
|                               -200 |
+------------------------------------+
1 row in set (0.00 sec)

# ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ŒèŒƒå›´åœ¨0<=number<=1.0
select rand();
+--------------------+
| rand()             |
+--------------------+
| 0.3412554928485821 |
+--------------------+ 

# å¯ä»¥é€šè¿‡ç»™å®šç§å­ï¼Œè®©æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°éƒ½ä¸€æ ·
select rand(232332323);
#æ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œéƒ½å°†åªä¼šç”Ÿæˆ0.08963447072509162
+---------------------+
| rand(232332323)     |
+---------------------+
| 0.08963447072509162 |
+---------------------+
```

## æ—¶é—´æ—¥æœŸç›¸å…³å‡½æ•°

![image-20211121165926182](/images/JavaSE/21-MySql/image-20211121165926182.png)

![image-20211121172736581](/images/JavaSE/21-MySql/image-20211121172736581.png)

![image-20211121172709333](/images/JavaSE/21-MySql/image-20211121172709333.png)

![image-20211121173857683](/images/JavaSE/21-MySql/image-20211121173857683.png)

![image-20211121173952348](/images/JavaSE/21-MySql/image-20211121173952348.png)

```sql
create table mes(id int,content varchar(30),send_time DATETIME);

#æ·»åŠ ä¸€æ¡è®°å½•ï¼Œæ—¶é—´ä¸ºå½“å‰æ—¶é—´
# ä½¿ç”¨current_timestamp
insert into mes values(1,"åŒ—äº¬æ–°é—»",current_timestamp);
#ä½¿ç”¨now()
insert into mes values(2,"ä¸Šæµ·æ–°é—»",now());

+------+--------------+---------------------+
| id   | content      | send_time           |
+------+--------------+---------------------+
|    1 | åŒ—äº¬æ–°é—»     | 2021-11-21 17:03:26 |
|    2 | ä¸Šæµ·æ–°é—»     | 2021-11-21 17:06:14 |
+------+--------------+---------------------+


# æ˜¾ç¤ºæ‰€æœ‰çš„æ–°é—»ä¿¡æ¯ï¼Œå’Œå‘å¸ƒæ—¥æœŸï¼Œåªæ˜¾ç¤ºæ—¥æœŸï¼Œä¸æ˜¾ç¤ºæ—¶é—´
select content,date(send_time) from mes;
+--------------+-----------------+
| content      | date(send_time) |
+--------------+-----------------+
| åŒ—äº¬æ–°é—»     | 2021-11-21      |
| ä¸Šæµ·æ–°é—»     | 2021-11-21      |
+--------------+-----------------+

# æŸ¥è¯¢ååˆ†é’Ÿå†…å‘å¸ƒçš„æ–°é—»
# 2021å¹´11æœˆ21æ—¥17:10:42
select * from mes where date_add(send_time,interval 10 minute)>=now();
+------+--------------+---------------------+
| id   | content      | send_time           |
+------+--------------+---------------------+
|    1 | åŒ—äº¬æ–°é—»     | 2021-11-21 17:03:26 |
|    2 | ä¸Šæµ·æ–°é—»     | 2021-11-21 17:06:14 |
+------+--------------+---------------------+


# 2011-11-1å’Œ1990-1-1ç›¸å·®å¤šå°‘å¤©
select datediff('2011-11-1','1990-1-1');
+----------------------------------+
| datediff('2011-11-1','1990-1-1') |
+----------------------------------+
|                             7974 |
+----------------------------------+

#ä½¿ç”¨mysqlè¯­å¥ï¼ŒæŸ¥è¯¢è‡ªå·±æ´»äº†å¤šå°‘å¤©
select datediff(current_date(),'2001-8-7');
+-------------------------------------+
| datediff(current_date(),'2001-8-7') |
+-------------------------------------+
|                                7411 |
+-------------------------------------+

#å¦‚æœæˆ‘èƒ½æ´»åˆ°80å²ï¼Œç®—å‡ºæˆ‘è¿˜èƒ½æ´»å¤šå°‘å¤©
# 80å²çš„å¹´ä»½
select date_add('2011-8-7',interval 80 year);
#80å²çš„å¹´ä»½-å·²ç»æ´»äº†çš„å¤©æ•°
select  datediff(date_add('2011-8-7',interval 80 year),now());
+-------------------------------------------------------+
| datediff(date_add('2011-8-7',interval 80 year),now()) |
+-------------------------------------------------------+
|                                                 25461 |
+-------------------------------------------------------+


```

## åŠ å¯†å‡½æ•°å’Œç³»ç»Ÿå‡½æ•°

![image-20211121174113576](/images/JavaSE/21-MySql/image-20211121174113576.png)

è¡¥å……ï¼š[mysqlåŠ å¯†æ•°æ®çš„å‡ ç§æ–¹æ³•](https://blog.csdn.net/rocky1996/article/details/75283826)ã€[mysql8æ›´è¯¥çš„ç”¨æˆ·ä¿¡æ¯åŠ å¯†æ–¹å¼](https://www.cnblogs.com/gjc592/p/9681093.html)

```sql
# æŸ¥è¯¢ç”¨æˆ·
#  å¯ä»¥æŸ¥è¯¢åˆ°ç™»é™†åˆ°mysqlçš„æœ‰å“ªäº›ç”¨æˆ·ï¼Œä»¥åŠç™»é™†çš„IP
select user();
+----------------+
| user()         |
+----------------+
| root@localhost |
+----------------+ 

#æŸ¥è¯¢å½“å‰ä½¿ç”¨çš„æ•°æ®åº“åç§°
select database();
+------------+
| database() |
+------------+
| db1        |
+------------+

#ä¸ºå­—ç¬¦ä¸²ç®—å‡ºä¸€ä¸ªmd5 32çš„å­—ç¬¦ä¸²ï¼Œå¸¸ç”¨çš„å¯¹ç”¨æˆ·å¯†ç çš„åŠ å¯†æ–¹å¼; å›ºå®šçš„ä¸‰åäºŒä½å­—ç¬¦
#å½“ç„¶ï¼Œæ­£å¸¸å·¥ä½œä¸­ï¼Œè¿™ä¸ªmd5åŠ å¯†åŠ å¯†çš„æ˜¯å·²ç»åŠ å¯†çš„ç”¨æˆ·å¯†ç ï¼›ï¼ˆå¤šé‡å¥—å¨ƒåŠ å¯†ä¸€æ ·ï¼‰
select md5(123456789);
+----------------------------------+
| md5(123456789)                   |
+----------------------------------+
| 25f9e794323b453885f5181f1b624d0b |
+----------------------------------+
create table myuser(name varchar(255),password char(32));
insert into myuser values("admin",md5(123456879));
+-------+----------------------------------+
| name  | password                         |
+-------+----------------------------------+
| admin | 97b290acab82d5937fb87a28b06181a3 |
+-------+----------------------------------+

#ä¸€èˆ¬éªŒè¯ç”¨æˆ·çš„æ—¶å€™åº”è¯¥æ˜¯ ç±»ä¼¼äºè¿™æ ·çš„
select * from myuser where name="admin" and password=md5(123456879);

# password(str) åŠ å¯†å‡½æ•°
SELECT PASSWORD("123456789");
#å½“ç„¶ï¼Œmysql8.0å¼€å§‹å°±ç§»é™¤äº†è¿™ä¸ªå‡½æ•°ï¼Œä»Šå¤©åˆšåˆšå‘ç°çš„ï¼Œå¦‚æœå†ä½¿ç”¨PASSWORDä¼šæŠ¥é”™:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near
#å¯ä»¥ä½¿ç”¨SHA1æ›¿ä»£



```

## æµç¨‹æ§åˆ¶å‡½æ•°-IF-IFNULL-CASE

ifç±»ä¼¼äºä¸‰å…ƒè¡¨è¾¾å¼

ifnullç±»ä¼¼äºif

caseç±»ä¼¼äº å¥—å¨ƒç‰ˆä¸‰å…ƒè¡¨è¾¾å¼

![image-20211121205018177](/images/JavaSE/21-MySql/image-20211121205018177.png)

```sql
# ifè¯­å¥çš„åŸºæœ¬ä½¿ç”¨ï¼š
select if(true,'åŒ—äº¬','ä¸Šæµ·'),if(false,'åŒ—äº¬','ä¸Šæµ·');
+----------------------------+-----------------------------+
| if(true,'åŒ—äº¬','ä¸Šæµ·')     | if(false,'åŒ—äº¬','ä¸Šæµ·')     |
+----------------------------+-----------------------------+
| åŒ—äº¬                       | ä¸Šæµ·                        |
+----------------------------+-----------------------------+

# ifnull
select ifnull(null,"hello"),ifnull('world','hello');
+----------------------+-------------------------+
| ifnull(null,"hello") | ifnull('world','hello') |
+----------------------+-------------------------+
| hello                | world                   |
+----------------------+-------------------------+

# è¿›é˜¶ä½¿ç”¨åŠwhen caseçš„ç”¨æ³•ï¼šæ•°æ®æºï¼š
+-------+--------+-----------+------+------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate   | sal     | comm    | deptno |
+-------+--------+-----------+------+------------+---------+---------+--------+
|  7369 | SMITH  | CLERK     | 7902 | 1990-12-17 |  800.00 |    NULL |     20 |
|  7521 | WARD   | SALESMAN  | 7698 | 1991-02-20 | 1600.00 |  300.00 |     30 |
|  7566 | JONES  | SALESMAN  | 7698 | 1991-02-22 | 2100.02 |  500.00 |     30 |
|  7654 | MARTIN | MANAGER   | 7939 | 1991-09-28 |  645.20 |    NULL |     20 |
|  7782 | BLACK  | SALESMAN  | 7698 | 1995-10-17 |  625.00 | 1250.00 |     30 |
|  7788 | COALK  | MANAGER   | 7698 | 1997-04-19 | 3954.20 |    NULL |     10 |
|  7839 | SOCTT  | MANAGER   | 7939 | 1991-12-03 | 2681.30 | 2450.00 |     20 |
|  7844 | KING   | ANALYST   | 7566 | 1992-05-07 | 1564.60 |  211.00 |     10 |
|  7900 | TURNER | PRESIDENT | NULL | 1888-01-01 | 2435.00 |    NULL |     30 |
|  7902 | JAMES  | CLERK     | 7698 | 1996-01-13 |  433.10 |  255.52 |     20 |
|  7934 | FORD   | ANALYST   | 7566 | 1990-06-03 | 6321.50 |  153.03 |     10 |
|  7966 | MILLER | CLERK     | 7782 | 1991-10-12 |  735.05 |  453.25 |     20 |
|  7966 | MILLER | CLERK     | 7782 | 1991-10-12 |  735.05 |  453.25 |     20 |
+-------+--------+-----------+------+------------+---------+---------+--------+


# æŸ¥è¯¢empè¡¨ï¼Œå¦‚æœcommæ˜¯nullï¼Œåˆ™æ˜¾ç¤º0
select ename,sal, IFNULL(comm,0.0) as comm,deptno from emp;
# æˆ–è€…
select ename,sal, IF(comm IS NULL,0.0) as comm,deptno from emp;
+--------+---------+---------+--------+
| ename  | sal     | comm    | deptno |
+--------+---------+---------+--------+
| SMITH  |  800.00 |    0.00 |     20 |
| WARD   | 1600.00 |  300.00 |     30 |
| JONES  | 2100.02 |  500.00 |     30 |
| MARTIN |  645.20 |    0.00 |     20 |
| BLACK  |  625.00 | 1250.00 |     30 |
| COALK  | 3954.20 |    0.00 |     10 |
| SOCTT  | 2681.30 | 2450.00 |     20 |
| KING   | 1564.60 |  211.00 |     10 |
| TURNER | 2435.00 |    0.00 |     30 |
| JAMES  |  433.10 |  255.52 |     20 |
| FORD   | 6321.50 |  153.03 |     10 |
| MILLER |  735.05 |  453.25 |     20 |
| MILLER |  735.05 |  453.25 |     20 |
+--------+---------+---------+--------+

# å¦‚æœempè¡¨çš„jobæ˜¯CLERKåˆ™æ˜¾ç¤ºèŒå‘˜ï¼Œå¦‚æœæ˜¯MANAGERåˆ™æ˜¾ç¤ºç»ç†ï¼Œå¦‚æœæ˜¯SALESMANåˆ™æ˜¾ç¤ºé”€å”®äººå‘˜ï¼Œå…¶ä»–æ­£å¸¸æ˜¾ç¤º
# ä½¿ç”¨ case when   æ³¨æ„ï¼Œè¿™ç©æ„ä½¿ç”¨çš„æ—¶å€™æ²¡æœ‰é€—å·çš„
select ename,( CASE 
              WHEN job = 'CLERK' THEN 'èŒå‘˜'
              WHEN job = 'MANAGER' THEN 'ç»ç†'
              WHEN job = 'SALESMAN' THEN 'é”€å”®äººå‘˜'
              ELSE job end
             ) as "job"
             from emp;
+--------+--------------+
| ename  | job          |
+--------+--------------+
| SMITH  | èŒå‘˜         |
| WARD   | é”€å”®äººå‘˜     |
| JONES  | é”€å”®äººå‘˜     |
| MARTIN | ç»ç†         |
| BLACK  | é”€å”®äººå‘˜     |
| COALK  | ç»ç†         |
| SOCTT  | ç»ç†         |
| KING   | ANALYST      |
| TURNER | PRESIDENT    |
| JAMES  | èŒå‘˜         |
| FORD   | ANALYST      |
| MILLER | èŒå‘˜         |
| MILLER | èŒå‘˜         |
+--------+--------------+

```

## å•è¡¨è¡¥å……-åŠ å¼ºæŸ¥è¯¢

### Whereæ¯”è¾ƒæ—¥æœŸ

åœ¨Mysqlä¸­ï¼Œæ—¥æœŸç±»å‹å¯ä»¥ç›´æ¥æ¯”è¾ƒ

```sql
# æŸ¥æ‰¾1992.10.1åå…¥èŒçš„å‘˜å·¥-ä½¿ç”¨whereå®Œæˆ
select ename,hiredate from emp where hiredate>'1992-10-1';
+-------+------------+
| ename | hiredate   |
+-------+------------+
| BLACK | 1995-10-17 |
| COALK | 1997-04-19 |
| JAMES | 1996-01-13 |
+-------+------------+
```

### Likeæ¨¡ç³ŠæŸ¥è¯¢è§„åˆ™

- `%`è¡¨ç¤º0åˆ°å¤šä¸ªå­—ç¬¦
- `_`è¡¨ç¤ºå•ä¸ªå­—ç¬¦

```sql
# æŸ¥æ‰¾é¦–å­—æ¯ä¸ºSçš„å‘˜å·¥å§“åå’Œå·¥èµ„ è¿™é‡Œå› ä¸ºè¡¨æ ¼æ˜¯éä¸¥æ ¼åŒ¹é…å¤§å°å†™çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨å°å†™çš„s
select ename,sal from emp where ename like 's%';
+-------+---------+
| ename | sal     |
+-------+---------+
| SMITH |  800.00 |
| SOCTT | 2681.30 |
+-------+---------+

# ç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸ºAçš„æ‰€æœ‰å‘˜å·¥ è¿™é‡Œå› ä¸ºè¡¨æ ¼æ˜¯éä¸¥æ ¼åŒ¹é…å¤§å°å†™çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨å°å†™çš„a
select ename,sal from emp where ename like '__a%';
+-------+---------+
| ename | sal     |
+-------+---------+
| BLACK |  625.00 |
| COALK | 3954.20 |
+-------+---------+
```

### åˆ¤æ–­å€¼æ˜¯å¦ä¸ºNULl

ä½¿ç”¨ `select * from xxx where xxx IS NULL`

```sql
# æ˜¾ç¤ºæ²¡æœ‰ä¸Šçº§é›‡å‘˜çš„æƒ…å†µ
select * from emp where mgr is NULL;
+-------+--------+-----------+------+------------+---------+------+--------+
| empno | ename  | job       | mgr  | hiredate   | sal     | comm | deptno |
+-------+--------+-----------+------+------------+---------+------+--------+
|  7900 | TURNER | PRESIDENT | NULL | 1888-01-01 | 2435.00 | NULL |     30 |
+-------+--------+-----------+------+------------+---------+------+--------+
```

### æŸ¥è¯¢è¡¨çš„ç»“æ„

`desc è¡¨åç§°`

```sql
# æŸ¥çœ‹empè¡¨çš„è¡¨ç»“æ„;
desc emp;
+----------+--------------------+------+-----+---------+-------+
| Field    | Type               | Null | Key | Default | Extra |
+----------+--------------------+------+-----+---------+-------+
| empno    | mediumint unsigned | NO   |     | 0       |       |
| ename    | varchar(20)        | NO   |     |         |       |
| job      | varchar(9)         | NO   |     |         |       |
| mgr      | mediumint unsigned | YES  |     | NULL    |       |
| hiredate | date               | NO   |     | NULL    |       |
| sal      | decimal(7,2)       | NO   |     | NULL    |       |
| comm     | decimal(7,2)       | YES  |     | NULL    |       |
| deptno   | mediumint unsigned | NO   |     | 0       |       |
+----------+--------------------+------+-----+---------+-------+
```

### Order Byæ’åº-å¤šé‡æ’åº

è¯­æ³•ï¼š`select * from è¡¨å [where] order by å­—æ®µ1 å­—æ®µ1æ’åºè§„åˆ™, å­—æ®µ2 å­—æ®µ2æ’åºè§„åˆ™...`

å­—æ®µ1 ä¸­ç›¸åŒçš„æŒ‰ç…§å­—æ®µ2çš„æ’åºè§„åˆ™è¿›è¡Œæ’åº å­—æ®µ2ä¸­ç›¸åŒçš„å­—æ®µæŒ‰ç…§å­—æ®µ3çš„è§„åˆ™è¿›è¡Œæ’åº...ä»¥æ­¤ç±»æ¨

```sql
# æŒ‰ç…§éƒ¨é—¨å·å‡åºè€Œé›‡å‘˜çš„å·¥èµ„é™åºçš„é¡ºåºæ’åˆ—
select ename,sal,deptno from emp order by deptno,sal desc;
+--------+---------+--------+
| ename  | sal     | deptno |
+--------+---------+--------+
| FORD   | 6321.50 |     10 |
| COALK  | 3954.20 |     10 |
| KING   | 1564.60 |     10 |
| SOCTT  | 2681.30 |     20 |
| SMITH  |  800.00 |     20 |
| MILLER |  735.05 |     20 |
| MILLER |  735.05 |     20 |
| MARTIN |  645.20 |     20 |
| JAMES  |  433.10 |     20 |
| TURNER | 2435.00 |     30 |
| JONES  | 2100.02 |     30 |
| WARD   | 1600.00 |     30 |
| BLACK  |  625.00 |     30 |
+--------+---------+--------+
```

### LIMIT åˆ†é¡µæŸ¥è¯¢

åœ¨å®é™…å·¥ä½œä¸­ï¼Œ**åšä»»ä½•é¡¹ç›®æ—¶éƒ½è¦ç”¨åˆ°åˆ†é¡µ**ï¼Œå› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€å¼ è¡¨çš„æ•°æ®å¾€å¾€æ˜¯å‡ ä¸‡å‡ åä¸‡å‡ ç™¾ä¸‡ï¼Œä¸å¯èƒ½è¯´æ¯æ¬¡æŸ¥è¯¢éƒ½æŠŠå…¨éƒ¨æŸ¥è¯¢ä¸‹æ¥ï¼š

åŸºæœ¬è¯­æ³•ï¼š`select ... from è¡¨å [where order  group ç­‰è¯­å¥] LIMIT ä½ç½®,æ•°é‡`

ä½ç½®(index)ä»é›¶å¼€å§‹è®¡æ•°

å˜›ï¼Œä¹Ÿå°±æ˜¯è¯´ å®é™…ä¸Šæ˜¯index+1

- 0,10ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¡åˆ°ç¬¬åæ¡
- 10,20è¡¨ç¤ºç¬¬åä¸€æ¡åˆ°ç¬¬äºŒåæ¡
- 20ï¼Œ30è¡¨ç¤ºç¬¬äºŒåä¸€æ¡åˆ°ç¬¬ä¸‰åæ¡

```sql
# æŒ‰ç…§å‘˜å·¥çš„idå·å‡åºå–å‡ºï¼Œæ¯é¡µæ˜¾ç¤ºä¸‰æ¡è®°å½•ï¼Œåˆ†åˆ«æ˜¾ç¤º1,2,3é¡µ
select * from emp order by  empno limit 0,3;#ç¬¬ä¸€é¡µ
+-------+-------+----------+------+------------+---------+--------+--------+
| empno | ename | job      | mgr  | hiredate   | sal     | comm   | deptno |
+-------+-------+----------+------+------------+---------+--------+--------+
|  7369 | SMITH | CLERK    | 7902 | 1990-12-17 |  800.00 |   NULL |     20 |
|  7521 | WARD  | SALESMAN | 7698 | 1991-02-20 | 1600.00 | 300.00 |     30 |
|  7566 | JONES | SALESMAN | 7698 | 1991-02-22 | 2100.02 | 500.00 |     30 |
+-------+-------+----------+------+------------+---------+--------+--------+
select * from emp order by  empno limit 3,3;#ç¬¬äºŒé¡µ
+-------+--------+----------+------+------------+---------+---------+--------+
| empno | ename  | job      | mgr  | hiredate   | sal     | comm    | deptno |
+-------+--------+----------+------+------------+---------+---------+--------+
|  7654 | MARTIN | MANAGER  | 7939 | 1991-09-28 |  645.20 |    NULL |     20 |
|  7782 | BLACK  | SALESMAN | 7698 | 1995-10-17 |  625.00 | 1250.00 |     30 |
|  7788 | COALK  | MANAGER  | 7698 | 1997-04-19 | 3954.20 |    NULL |     10 |
+-------+--------+----------+------+------------+---------+---------+--------+
select * from emp order by  empno limit 6,3;#ç¬¬ä¸‰é¡µ
+-------+--------+-----------+------+------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate   | sal     | comm    | deptno |
+-------+--------+-----------+------+------------+---------+---------+--------+
|  7839 | SOCTT  | MANAGER   | 7939 | 1991-12-03 | 2681.30 | 2450.00 |     20 |
|  7844 | KING   | ANALYST   | 7566 | 1992-05-07 | 1564.60 |  211.00 |     10 |
|  7900 | TURNER | PRESIDENT | NULL | 1888-01-01 | 2435.00 |    NULL |     30 |
+-------+--------+-----------+------+------------+---------+---------+--------+
```

### ä½¿ç”¨åˆ†ç»„å‡½æ•°å’Œåˆ†ç»„å­—å¥ã€æµç¨‹æ§åˆ¶å¢å¼º GROUP BYã€IF

```sql
# æ˜¾ç¤º æ¯ç§å²—ä½ çš„ é›‡å‘˜æ€»æ•°ã€å¹³å‡å·¥èµ„
select count(*),avg(sal) from emp group by deptno;
+----------+-------------+
| count(*) | avg(sal)    |
+----------+-------------+
|        6 | 1004.950000 |
|        4 | 1690.005000 |
|        3 | 3946.766667 |
+----------+-------------+

# æ˜¾ç¤º é›‡å‘˜æ€»æ•° ä»¥åŠ æ²¡æœ‰è·å¾—è¡¥åŠ© çš„å‘˜å·¥æ•°
# count æŸåˆ— å¦‚æœè¯¥åˆ—çš„å€¼ä¸ºnullï¼Œæ˜¯ä¸ä¼šåŠ å…¥ç»Ÿè®¡çš„

# æ–¹æ³•1
select count(*),count(if(comm is null,1,null))  from emp;
+----------+--------------------------------+
| count(*) | count(if(comm is null,1,null)) |
+----------+--------------------------------+
|       13 |                              4 |
+----------+--------------------------------+

# æ–¹æ³•2
select count(*),count(*)-count(comm) from emp;
+----------+----------------------+
| count(*) | count(*)-count(comm) |
+----------+----------------------+
|       13 |                    4 |
+----------+----------------------+

# æ˜¾ç¤ºç®¡ç†è€…çš„æ€»äººæ•°(mgr)
# count å»null distinct å»é‡
select count(distinct mgr) from emp;
+---------------------+
| count(distinct mgr) |
+---------------------+
|                   5 |
+---------------------+

# æ˜¾ç¤ºé›‡å‘˜çš„å·¥èµ„çš„æœ€å¤§å·®é¢

select max(sal) - min(sal) from emp;
+---------------------+
| max(sal) - min(sal) |
+---------------------+
|             5888.40 |
+---------------------+

```

### Group Having limit order çš„ä½¿ç”¨é¡ºåº

é¦–å…ˆä»–ä»¬å¿…é¡»åœ¨whereä¹‹åï¼Œ

è¿™ä¹‹åçš„é¡ºåºå°±æ˜¯

```sql
select å­—æ®µ from è¡¨å where æ¡ä»¶
 GROUP BY å­—æ®µ
 HAVING å­—æ®µ
 ORDER BY å­—æ®µ
 LIMIT å­—æ®µ;
#LIMITæ°¸è¿œåœ¨æœ€å

#åº”ç”¨æ¡ˆä¾‹ ç»Ÿè®¡å„ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ å¹¶ä¸”æ˜¯å¹³å‡å·¥èµ„å¤§äº1000çš„æ‰ä¼šåŠ å…¥ç»Ÿè®¡ï¼Œå¹¶ä¸”æŒ‰ç…§å·¥èµ„ä»é«˜åˆ°ä½æ’åºï¼Œå–å‡ºå‰ä¸¤è¡Œè®°å½•
select avg(sal) as sal_avg,deptno from emp 
 group by deptno having sal_avg>1000
    order by sal_avg DESC
    limit 0,2;
+-------------+--------+
| sal_avg     | deptno |
+-------------+--------+
| 3946.766667 |     10 |
| 1690.005000 |     30 |
+-------------+--------+
```

# Select æŸ¥æ‰¾-å¤šè¡¨æŸ¥è¯¢

å®é™…ä¸Šå¼€å‘è¿‡ç¨‹ä¸­å¤šè¡¨ç”¨çš„å¤šä¸€äº›ï¼ˆæŒ‡ä¸ƒå…«ä¸ªè¡¨ä¸€å—æŸ¥..ï¼‰

![image-20211121223552978](/images/JavaSE/21-MySql/image-20211121223552978.png)

æ¥ä¸‹æ¥è¿‡ç¨‹ä¸­è¦ç”¨åˆ°çš„ä¸‰å¼ è¡¨

```sql
mysql> select * from dept;
+--------+------------+----------+
| deptno | dname      | loc      |
+--------+------------+----------+
|     10 | ACCOUNTING | NEW Work |
|     20 | RESEARCH   | DALLAS   |
|     30 | SALES      | CHICAGO  |
|     40 | OPERATIONS | BOSTON   |
+--------+------------+----------+
4 rows in set (0.00 sec)

mysql> select * from salgrade;
+-------+---------+---------+
| grade | losal   | hisal   |
+-------+---------+---------+
|     1 |  700.00 | 1200.00 |
|     2 | 1201.00 | 1400.00 |
|     3 | 1401.00 | 2000.00 |
|     4 | 2001.00 | 3000.00 |
|     5 | 3001.00 | 9999.00 |
+-------+---------+---------+
5 rows in set (0.00 sec)

mysql> select * from emp;
+-------+--------+-----------+------+------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate   | sal     | comm    | deptno |
+-------+--------+-----------+------+------------+---------+---------+--------+
|  7369 | SMITH  | CLERK     | 7902 | 1990-12-17 |  800.00 |    NULL |     20 |
|  7521 | WARD   | SALESMAN  | 7698 | 1991-02-20 | 1600.00 |  300.00 |     30 |
|  7566 | JONES  | SALESMAN  | 7698 | 1991-02-22 | 2100.02 |  500.00 |     30 |
|  7654 | MARTIN | MANAGER   | 7939 | 1991-09-28 |  645.20 |    NULL |     20 |
|  7782 | BLACK  | SALESMAN  | 7698 | 1995-10-17 |  625.00 | 1250.00 |     30 |
|  7788 | COALK  | MANAGER   | 7698 | 1997-04-19 | 3954.20 |    NULL |     10 |
|  7839 | SOCTT  | MANAGER   | 7939 | 1991-12-03 | 2681.30 | 2450.00 |     20 |
|  7844 | KING   | ANALYST   | 7566 | 1992-05-07 | 1564.60 |  211.00 |     10 |
|  7900 | TURNER | PRESIDENT | NULL | 1888-01-01 | 2435.00 |    NULL |     30 |
|  7902 | JAMES  | CLERK     | 7698 | 1996-01-13 |  433.10 |  255.52 |     20 |
|  7934 | FORD   | ANALYST   | 7566 | 1990-06-03 | 6321.50 |  153.03 |     10 |
|  7966 | MILLER | CLERK     | 7782 | 1991-10-12 |  735.05 |  453.25 |     20 |
|  7966 | MILLER | CLERK     | 7782 | 1991-10-12 |  735.05 |  453.25 |     20 |
+-------+--------+-----------+------+------------+---------+---------+--------+
13 rows in set (0.00 sec)
```

![image-20211121223951951](/images/JavaSE/21-MySql/image-20211121223951951.png)

![image-20211121224339699](/images/JavaSE/21-MySql/image-20211121224339699.png)

è¿™æ ·å¤šè¡¨æŸ¥è¯¢é»˜è®¤å¤„ç†è¿”å›çš„ç»“æœï¼Œç§°ä¸ºç¬›å¡å°”é›†

## å¤šè¡¨æŸ¥è¯¢-whereè¿‡æ»¤

è§£å†³è¿™ä¸ªå¤šè¡¨çš„å…³é”®å°±æ˜¯è¦å†™å‡ºæ­£ç¡®çš„è¿‡æ»¤æ¡ä»¶ where

![image-20211121230457415](/images/JavaSE/21-MySql/image-20211121230457415.png)

```sql

# emp.deptno = dept.deptno å³ä¸ºå»é‡
select * from emp,dept where emp.deptno = dept.deptno;
# æ­¤æ—¶è‹¥æƒ³è¦æ˜¾ç¤ºæŒ‡å®šå€¼åˆ™éœ€è¦ï¼š
select emp.ename,emp.deptno,dept.dname from emp,dept where emp.deptno = dept.deptno;
+--------+--------+------------+
| ename  | deptno | dname      |
+--------+--------+------------+
| SMITH  |     20 | RESEARCH   |
| WARD   |     30 | SALES      |
| JONES  |     30 | SALES      |
| MARTIN |     20 | RESEARCH   |
| BLACK  |     30 | SALES      |
| COALK  |     10 | ACCOUNTING |
| SOCTT  |     20 | RESEARCH   |
| KING   |     10 | ACCOUNTING |
| TURNER |     30 | SALES      |
| JAMES  |     20 | RESEARCH   |
| FORD   |     10 | ACCOUNTING |
| MILLER |     20 | RESEARCH   |
| MILLER |     20 | RESEARCH   |
+--------+--------+------------+


# æ˜¾ç¤ºéƒ¨é—¨å·ä¸º10çš„éƒ¨é—¨å å‘˜å·¥å å’Œå·¥èµ„
# å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥åœ¨fromå¤„å®šä¹‰åˆ«å
select d.dname,
 e.deptno,
 e.ename,
 e.sal 
 from emp as e ,dept as d where 
    e.deptno = d.deptno  and e.deptno=10;
+------------+--------+-------+---------+
| dname      | deptno | ename | sal     |
+------------+--------+-------+---------+
| ACCOUNTING |     10 | COALK | 3954.20 |
| ACCOUNTING |     10 | KING  | 1564.60 |
| ACCOUNTING |     10 | FORD  | 6321.50 |
+------------+--------+-------+---------+

# æ˜¾ç¤ºå„ä¸ªå‘˜å·¥çš„å§“åã€‚å·¥èµ„ï¼ŒåŠå·¥èµ„çº§åˆ« 

select e.ename,e.sal,s.grade
 from emp as e  ,salgrade as s
 where   e.sal BETWEEN s.losal and s.hisal;
+--------+---------+-------+
| ename  | sal     | grade |
+--------+---------+-------+
| SMITH  |  800.00 |     1 |
| WARD   | 1600.00 |     3 |
| JONES  | 2100.02 |     4 |
| COALK  | 3954.20 |     5 |
| SOCTT  | 2681.30 |     4 |
| KING   | 1564.60 |     3 |
| TURNER | 2435.00 |     4 |
| FORD   | 6321.50 |     5 |
| MILLER |  735.05 |     1 |
| MILLER |  735.05 |     1 |
+--------+---------+-------+

# æ˜¾ç¤ºé›‡å‘˜å é›‡å‘˜å·¥èµ„ åŠæ‰€åœ¨éƒ¨é—¨çš„åå­— å¹¶æŒ‰ç…§éƒ¨é—¨æ’åºï¼ˆé™åºæ’ï¼‰
# éƒ¨é—¨ç›¸åŒçš„ï¼ŒæŒ‰ç…§å·¥èµ„é™åºæ’
select e.ename,e.sal,e.deptno,d.dname 
 from emp as e,dept as d
 where e.deptno = d.deptno
 order by e.deptno desc,e.sal desc;
+--------+---------+--------+------------+
| ename  | sal     | deptno | dname      |
+--------+---------+--------+------------+
| TURNER | 2435.00 |     30 | SALES      |
| JONES  | 2100.02 |     30 | SALES      |
| WARD   | 1600.00 |     30 | SALES      |
| BLACK  |  625.00 |     30 | SALES      |
| SOCTT  | 2681.30 |     20 | RESEARCH   |
| SMITH  |  800.00 |     20 | RESEARCH   |
| MILLER |  735.05 |     20 | RESEARCH   |
| MILLER |  735.05 |     20 | RESEARCH   |
| MARTIN |  645.20 |     20 | RESEARCH   |
| JAMES  |  433.10 |     20 | RESEARCH   |
| FORD   | 6321.50 |     10 | ACCOUNTING |
| COALK  | 3954.20 |     10 | ACCOUNTING |
| KING   | 1564.60 |     10 | ACCOUNTING |
+--------+---------+--------+------------+

```

## Mysql å¤šè¡¨æŸ¥è¯¢-è‡ªè¿æ¥

è‡ªè¿æ¥æŒ‡çš„æ˜¯åœ¨åŒä¸€å¼ è¡¨çš„è¿æ¥æŸ¥è¯¢ä¸ªï¼ˆå°†åŒä¸€å¼ è¡¨çœ‹åšä¸¤å¼ è¡¨ï¼‰

```sql
# æ˜¾ç¤ºå…¬ç¤ºå‘˜å·¥å’Œä»–ä¸Šçº§çš„åå­—
# å‘˜å·¥çš„åå­—åœ¨ emp ä¸Šçº§çš„åå­— ä¹Ÿåœ¨emp å‘˜å·¥å’Œä¸Šçº§æ˜¯é€šè¿‡empè¡¨çš„mgrå­—æ®µå…³è”
# empno æ˜¯å‘˜å·¥å½“å‰é˜¶çº§  mgr æ˜¯å‘˜å·¥ä¸Šçº§é˜¶çº§
 +-------+--------+-----------+------+------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate   | sal     | comm    | deptno |
+-------+--------+-----------+------+------------+---------+---------+--------+
|  7369 | SMITH  | CLERK     | 7902 | 1990-12-17 |  800.00 |    NULL |     20 |
|  7521 | WARD   | SALESMAN  | 7698 | 1991-02-20 | 1600.00 |  300.00 |     30 |
|  7566 | JONES  | SALESMAN  | 7698 | 1991-02-22 | 2100.02 |  500.00 |     30 |
|  7654 | MARTIN | MANAGER   | 7939 | 1991-09-28 |  645.20 |    NULL |     20 |
|  7782 | BLACK  | SALESMAN  | 7698 | 1995-10-17 |  625.00 | 1250.00 |     30 |
|  7788 | COALK  | MANAGER   | 7698 | 1997-04-19 | 3954.20 |    NULL |     10 |
|  7839 | SOCTT  | MANAGER   | 7939 | 1991-12-03 | 2681.30 | 2450.00 |     20 |
|  7844 | KING   | ANALYST   | 7566 | 1992-05-07 | 1564.60 |  211.00 |     10 |
|  7900 | TURNER | PRESIDENT | NULL | 1888-01-01 | 2435.00 |    NULL |     30 |
|  7902 | JAMES  | CLERK     | 7698 | 1996-01-13 |  433.10 |  255.52 |     20 |
|  7934 | FORD   | ANALYST   | 7566 | 1990-06-03 | 6321.50 |  153.03 |     10 |
|  7966 | MILLER | CLERK     | 7782 | 1991-10-12 |  735.05 |  453.25 |     20 |
|  7966 | MILLER | CLERK     | 7782 | 1991-10-12 |  735.05 |  453.25 |     20 |
+-------+--------+-----------+------+------------+---------+---------+--------+

select work.ename "å‘˜å·¥å",boss.ename "ä¸Šçº§åç§°" from emp as work,emp as boss
 where work.mgr = boss.empno;
# å› ä¸ºè¡¨ä¸­è®¾è®¡äº†å¤§éƒ¨åˆ†äººçš„ä¸Šçº§éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥è¿™é‡Œåªè·å–åˆ°å‡ ä¸ªäººçš„ï¼Œä¸ºnullæˆ–è€…ä¸å­˜åœ¨çš„éƒ½ä¸ä¼šè®°å½•åœ¨å†…
# é€šè¿‡åˆ«åå³å¯è½»æ¾æ¥ä½¿ç”¨ åæ­£å¤šè¡¨æŸ¥è¯¢é€šå¸¸æƒ…å†µä¸‹åˆ†åˆ«å–ä¸ªåˆ«åå°±ä¸ä¼šé”™
+-----------+--------------+
| å‘˜å·¥å    | ä¸Šçº§åç§°     |
+-----------+--------------+
| FORD      | JONES        |
| KING      | JONES        |
| MILLER    | BLACK        |
| MILLER    | BLACK        |
| SMITH     | JAMES        |
+-----------+--------------+

```

## Mysqlå¤šè¡¨æŸ¥è¯¢-å­æŸ¥è¯¢-æŸ¥è¯¢ç»“æœå½“åšä¸´æ—¶è¡¨ä½¿ç”¨

å°±æ˜¯ç»“æœå½“æˆè¡¨æ¥ä½¿ç”¨

```sql
# æŸ¥è¯¢empå„ä¸ªcommåˆ†ç»„ä¸­ å·¥èµ„æœ€é«˜çš„äºº å¹¶æŒ‰ç…§ç±»åˆ«å‡åºæ’åº

# å…ˆå¾—åˆ° å„ä¸ªç±»åˆ«ä¸­çš„æœ€é«˜å·¥èµ„
select deptno,max(sal) from emp group by deptno;
+--------+----------+
| deptno | max(sal) |
+--------+----------+
|     20 |  2681.30 |
|     30 |  2435.00 |
|     10 |  6321.50 |
+--------+----------+

# ç„¶åå°†å…¶ç»“æœå½“åšä¸€å¼ è¡¨ æ¥ä¼ é€’ä½¿ç”¨
select e.deptno "ç±»åˆ«",e.ename "å‘˜å·¥åç§°",t.sal "å·¥èµ„"
 from emp as e , (select deptno,max(sal) as sal from emp group by deptno)as t
 where e.sal = t.sal
 order by e.deptno,t.deptno;
+--------+--------------+---------+
| ç±»åˆ«   | å‘˜å·¥åç§°     | å·¥èµ„    |
+--------+--------------+---------+
|     10 | FORD         | 6321.50 |
|     20 | SOCTT        | 2681.30 |
|     30 | TURNER       | 2435.00 |
+--------+--------------+---------+


```

## Mysqlå¤šè¡¨æŸ¥è¯¢-Allã€AnyåŒ¹é…æ“ä½œç¬¦

allå°±æ˜¯åŒ¹é…æŸä¸ªå€¼æ˜¯å¦ä¸ºå¦ä¸€ä¸ªåˆ—è¡¨è¿”å›çš„æ‰€æœ‰å­—æ®µæˆ–è€…ä¸€ä¸ªå­æŸ¥è¯¢è¿”å›çš„æ‰€æœ‰å­—æ®µçš„å€¼

allå‰é¢ä¸€èˆ¬æ˜¯å¤§äºå°äºæˆ–è€…ç­‰äºå·

all å°±æ˜¯åŒ¹é…å…¨éƒ¨

any å°±æ˜¯åŒ¹é…ä¸Šå…¶ä¸­ä¸€ä¸ªå³å¯

```sql
# æ˜¾ç¤ºå·¥èµ„æ¯”éƒ¨é—¨30çš„ æ‰€æœ‰å‘˜å·¥ çš„å·¥èµ„é«˜çš„å‘˜å·¥å§“åã€å·¥èµ„å’Œéƒ¨é—¨å·
select ename,sal,deptno from emp where
 sal>ALL(SELECT sal from emp where deptno =30);
#  ç¨å¾®çš„ç®€å†™
 sal>ALL(SELECT MAX(sal) from emp where deptno =30);
 +-------+---------+--------+
| ename | sal     | deptno |
+-------+---------+--------+
| COALK | 3954.20 |     10 |
| SOCTT | 2681.30 |     20 |
| FORD  | 6321.50 |     10 |
+-------+---------+--------+

# æ˜¾ç¤ºå·¥èµ„æ¯”éƒ¨é—¨30çš„å…¶ä¸­ ä»»ä½•ä¸€ä¸ªå‘˜å·¥ çš„å·¥èµ„é«˜çš„å‘˜å·¥
select ename,sal,deptno from emp where
 sal>ANY(SELECT sal from emp where deptno =30);
# ä¹Ÿå¯ä»¥ç•¥å¾®ç®€åŒ–
 sal>ANY(SELECT MIN(sal) from emp where deptno =30);
+--------+---------+--------+
| ename  | sal     | deptno |
+--------+---------+--------+
| SMITH  |  800.00 |     20 |
| WARD   | 1600.00 |     30 |
| JONES  | 2100.02 |     30 |
| MARTIN |  645.20 |     20 |
| COALK  | 3954.20 |     10 |
| SOCTT  | 2681.30 |     20 |
| KING   | 1564.60 |     10 |
| TURNER | 2435.00 |     30 |
| FORD   | 6321.50 |     10 |
| MILLER |  735.05 |     20 |
| MILLER |  735.05 |     20 |
+--------+---------+--------+
```

## Mysqlå¤šè¡¨æŸ¥è¯¢-å¤šåˆ—å­æŸ¥è¯¢

å°±æ˜¯å¤šä¸ªå€¼åŒæ—¶è¿›è¡ŒåŒ¹é…ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½æŸ¥è¯¢æ—¶å€™çš„èµ„æºæµªè´¹

```sql
#æŸ¥è¯¢ä¸ SMITH çš„éƒ¨é—¨å’Œå²—ä½å®Œå…¨ç›¸åŒçš„æ‰€æœ‰é›‡å‘˜ï¼ˆä¸åŒ…æ‹¬smithæœ¬äººï¼‰

# é¦–å…ˆè·å–å²å¯†æ–¯çš„éƒ¨é—¨å’Œå²—ä½
select deptno,job from emp where ename ='smith';
+--------+-------+
| deptno | job   |
+--------+-------+
|     20 | CLERK |
+--------+-------+

#å†æŠŠç»“æœå½“åšå­æŸ¥è¯¢æ¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šåˆ—å­æŸ¥è¯¢çš„æ¨¡å¼
select * from emp 
 where (deptno,job)= (select deptno,job from emp where ename ='smith') and ename != 'smith';
+-------+--------+-------+------+------------+--------+--------+--------+
| empno | ename  | job   | mgr  | hiredate   | sal    | comm   | deptno |
+-------+--------+-------+------+------------+--------+--------+--------+
|  7902 | JAMES  | CLERK | 7698 | 1996-01-13 | 433.10 | 255.52 |     20 |
|  7966 | MILLER | CLERK | 7782 | 1991-10-12 | 735.05 | 453.25 |     20 |
+-------+--------+-------+------+------------+--------+--------+--------+



# è·å–æ‰€æœ‰éƒ¨é—¨ä¸­å·¥èµ„é«˜äºè¯¥éƒ¨é—¨å¹³å‡å·¥èµ„çš„äºº

select deptno,avg(sal)as sal from emp group by deptno;

select e.ename 'å‘˜å·¥å§“å',e.sal 'å‘˜å·¥å·¥èµ„',e.deptno 'éƒ¨é—¨åç§°',g.sal "è¯¥éƒ¨é—¨å¹³å‡å·¥èµ„"
 from emp as e,(select deptno,avg(sal)as sal from emp group by deptno)as g
 where e.deptno=g.deptno and e.sal>g.sal
 order by e.deptno;
+--------------+--------------+--------------+-----------------------+
| å‘˜å·¥å§“å       | å‘˜å·¥å·¥èµ„      | éƒ¨é—¨åç§°      | è¯¥éƒ¨é—¨å¹³å‡å·¥èµ„          |
+--------------+--------------+--------------+-----------------------+
| COALK        |      3954.20 |           10 |           3946.766667 |
| FORD         |      6321.50 |           10 |           3946.766667 |
| SOCTT        |      2681.30 |           20 |           1004.950000 |
| JONES        |      2100.02 |           30 |           1690.005000 |
| TURNER       |      2435.00 |           30 |           1690.005000 |
+--------------+--------------+--------------+-----------------------+

# æŸ¥æ‰¾æ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„äººçš„è¯¦ç»†èµ„æ–™
select e.ename 'å‘˜å·¥å§“å',e.sal 'å‘˜å·¥å·¥èµ„',e.deptno 'éƒ¨é—¨åç§°',g.sal "è¯¥éƒ¨é—¨æœ€é«˜å·¥èµ„"
 from emp as e,(select deptno,max(sal)as sal from emp group by deptno)as g
 where e.deptno=g.deptno and e.sal=g.sal
 order by e.deptno;
+--------------+--------------+--------------+-----------------------+
| å‘˜å·¥å§“å     | å‘˜å·¥å·¥èµ„     | éƒ¨é—¨åç§°     | è¯¥éƒ¨é—¨æœ€é«˜å·¥èµ„        |
+--------------+--------------+--------------+-----------------------+
| FORD         |      6321.50 |           10 |               6321.50 |
| SOCTT        |      2681.30 |           20 |               2681.30 |
| TURNER       |      2435.00 |           30 |               2435.00 |
+--------------+--------------+--------------+-----------------------+
```

### å¤šè¡¨æŸ¥è¯¢ç»†èŠ‚1 -asçš„çœç•¥ï¼Œ*è¿”å›æŸä¸ªè¡¨çš„å…¨éƒ¨å†…å®¹

 ```sql
 # as å¯ä»¥çœç•¥
 select ename as name from xxx;
 #å¯ä»¥ç®€å†™ä¸º
 select ename  name;
 
 # å½“æŸ¥è¯¢å¤šä¸ªè¡¨çš„æ—¶å€™ï¼Œè¦è¾“å‡ºæŸä¸ªè¡¨çš„å…¨éƒ¨å†…å®¹
 # ä½¿ç”¨*å·å³å¯
 select emp.*,dept.dname from emp,dept;
 
 # ä¹Ÿå¯ä»¥*å·+ asç¼©å†™
 
 select e.* , d.dname from emp e,dept d;
 
 # æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„
 
 ```

## è¡¨å¤åˆ¶-è •è™«å¤åˆ¶ã€å¤åˆ¶è¡¨çš„ç»“æ„ã€å»é™¤è¡¨ä¸­çš„é‡å¤è®°å½•

æœ‰çš„æ—¶å€™ï¼Œä¸ºäº†å¯¹æŸä¸ªsqlè¯­å¥è¿›è¡Œæ•ˆç‡æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦æµ·é‡æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ä¸ºè¡¨åˆ›å»ºæµ·é‡æ•°æ®

### å¤åˆ¶è¡¨

- `insert into è¡¨1 select * from è¡¨1` è‡ªæˆ‘å¤åˆ¶
- `insert into è¡¨1(å­—æ®µ1 å­—æ®µ2...) select å­—æ®µ1,å­—æ®µ2... from è¡¨2` ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å¤åˆ¶
  - æŠŠè¡¨2ä¸­ç›¸åº”å­—æ®µçš„å€¼æŒ‰ç…§é¡ºåºå¤åˆ¶åˆ°è¡¨1çš„ç›¸åº”å­—æ®µï¼ˆæŒ‰ç…§å­—æ®µ1ï¼Œå­—æ®µ2ç›¸äº’ç›¸å¯¹åº”ï¼‰

```sql
# å…ˆæ¥ä¸ªæµ‹è¯•çš„è¡¨
create table my_table01( id int,name varchar(30) ,sal double,job varchar(32) ,deptno int);
desc my_table01;
+--------+-------------+------+-----+---------+-------+
| Field  | Type        | Null | Key | Default | Extra |
+--------+-------------+------+-----+---------+-------+
| id     | int         | YES  |     | NULL    |       |
| name   | varchar(30) | YES  |     | NULL    |       |
| sal    | double      | YES  |     | NULL    |       |
| job    | varchar(32) | YES  |     | NULL    |       |
| deptno | int         | YES  |     | NULL    |       |
+--------+-------------+------+-----+---------+-------+

# æŠŠempè¡¨çš„è®°å½•å¤åˆ¶åˆ°my_table01
insert into my_table01
 (id,name,sal,job,deptno) 
 (SELECT empno,ename,sal,job,deptno from emp);
 
+------+--------+---------+-----------+--------+
| id   | name   | sal     | job       | deptno |
+------+--------+---------+-----------+--------+
| 7369 | SMITH  |     800 | CLERK     |     20 |
| 7521 | WARD   |    1600 | SALESMAN  |     30 |
| 7566 | JONES  | 2100.02 | SALESMAN  |     30 |
......
13 rows in set (0.00 sec)

# è‡ªæˆ‘å¤åˆ¶
INSERT INTO my_table01 SELECT * FROM my_table01;

+------+--------+---------+-----------+--------+
| id   | name   | sal     | job       | deptno |
+------+--------+---------+-----------+--------+
| 7369 | SMITH  |     800 | CLERK     |     20 |
| 7521 | WARD   |    1600 | SALESMAN  |     30 |
| 7566 | JONES  | 2100.02 | SALESMAN  |     30 |
| 7654 | MARTIN |   645.2 | MANAGER   |     20 |
......
26 rows in set (0.00 sec)

# å†æ¬¡è‡ªæˆ‘å¤åˆ¶næ¬¡.
INSERT INTO my_table01 SELECT * FROM my_table01;
INSERT INTO my_table01 SELECT * FROM my_table01;
INSERT INTO my_table01 SELECT * FROM my_table01;
....
Query OK, 1703936 rows affected (16.21 sec)
# å¤åˆ¶äº†è¶Šæ¥è¶Šå¤šæ¬¡ï¼Œä¹Ÿå¯ä»¥æ˜æ˜¾çš„æ„Ÿè§‰åˆ°å¤åˆ¶çš„é€Ÿåº¦è¶Šæ¥è¶Šæ…¢
# æ¯æ¬¡å¤åˆ¶éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„2å€

```

### å¤åˆ¶è¡¨çš„ç»“æ„

è¯­æ³•ï¼š`create table è¡¨2 like è¡¨1` æŠŠè¡¨1çš„ç»“æ„å®Œæ•´çš„å¤åˆ¶ç»™è¡¨2

```sql
# å¤åˆ¶è¡¨çš„ç»“æ„
create table my_table02 like emp;
+----------+--------------------+------+-----+---------+-------+
| Field    | Type               | Null | Key | Default | Extra |
+----------+--------------------+------+-----+---------+-------+
| empno    | mediumint unsigned | NO   |     | 0       |       |
| ename    | varchar(20)        | NO   |     |         |       |
| job      | varchar(9)         | NO   |     |         |       |
| mgr      | mediumint unsigned | YES  |     | NULL    |       |
| hiredate | date               | NO   |     | NULL    |       |
| sal      | decimal(7,2)       | NO   |     | NULL    |       |
| comm     | decimal(7,2)       | YES  |     | NULL    |       |
| deptno   | mediumint unsigned | NO   |     | 0       |       |
+----------+--------------------+------+-----+---------+-------+

# å†æŠŠempå¤åˆ¶ç»™ä»–
insert into my_table02 select * from emp;
...
Query OK, 13 rows affected (0.01 sec)
#å†æ‰§è¡Œä¸€æ¬¡å¤åˆ¶å†…å®¹
Query OK, 26 rows affected (0.01 sec)

```

### è¡¨çš„å»é‡

å»é‡æ–¹å¼ç½‘ä¸Šåº”è¯¥æœ‰æ›´å¤šç§ï¼Œè¿™é‡Œä¸¾ä¾‹ä¸€ç§æœ€ç¬¨çš„æ–¹æ³•

```sql
# è¡¨çš„å»é‡

# 1. å…ˆåˆ›å»ºä¸€å¼ ä¸´æ—¶è¡¨my_emp è¯¥è¡¨çš„ç»“æ„å’Œmy_table02å®Œå…¨ç›¸åŒ
create table my_emp like my_table02;

# 2.æŠŠ my_table02çš„è®°å½•ï¼Œé€šè¿‡ distinct å…³é”®å­—å¤„ç†åï¼Œå¤åˆ¶ç»™my_emp;
insert into my_emp select DISTINCT * from my_table02;
...
Records: 12  Duplicates: 0  Warnings: 0

# 3. æ¸…é™¤æ‰ my_table02çš„æ‰€æœ‰è®°å½• è¿™é‡Œçš„deleteå¯ä»¥æ¢æˆtruncateä½¿å…¶ä¸ç¼“å­˜åˆ é™¤çš„æ•°æ®
delete from my_table02;

# 4. æŠŠmy_empçš„è¡¨å¤åˆ¶ç»™ my_table02;
insert into my_table02 select DISTINCT * from my_emp;

# 5. drop æ‰ ä¸´æ—¶è¡¨ my_emp;

drop table my_emp;

+-------+--------+-----------+------+------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate   | sal     | comm    | deptno |
+-------+--------+-----------+------+------------+---------+---------+--------+
|  7369 | SMITH  | CLERK     | 7902 | 1990-12-17 |  800.00 |    NULL |     20 |
|  7521 | WARD   | SALESMAN  | 7698 | 1991-02-20 | 1600.00 |  300.00 |     30 |
|  7566 | JONES  | SALESMAN  | 7698 | 1991-02-22 | 2100.02 |  500.00 |     30 |
|  7654 | MARTIN | MANAGER   | 7939 | 1991-09-28 |  645.20 |    NULL |     20 |
|  7782 | BLACK  | SALESMAN  | 7698 | 1995-10-17 |  625.00 | 1250.00 |     30 |
|  7788 | COALK  | MANAGER   | 7698 | 1997-04-19 | 3954.20 |    NULL |     10 |
|  7839 | SOCTT  | MANAGER   | 7939 | 1991-12-03 | 2681.30 | 2450.00 |     20 |
|  7844 | KING   | ANALYST   | 7566 | 1992-05-07 | 1564.60 |  211.00 |     10 |
|  7900 | TURNER | PRESIDENT | NULL | 1888-01-01 | 2435.00 |    NULL |     30 |
|  7902 | JAMES  | CLERK     | 7698 | 1996-01-13 |  433.10 |  255.52 |     20 |
|  7934 | FORD   | ANALYST   | 7566 | 1990-06-03 | 6321.50 |  153.03 |     10 |
|  7966 | MILLER | CLERK     | 7782 | 1991-10-12 |  735.05 |  453.25 |     20 |
+-------+--------+-----------+------+------------+---------+---------+--------+
```

## åˆå¹¶æŸ¥è¯¢-UNIONã€UNION ALL

![image-20211122154537661](/images/JavaSE/21-MySql/image-20211122154537661.png)

![image-20211122154637130](/images/JavaSE/21-MySql/image-20211122154637130.png)

## å¤šè¡¨æŸ¥è¯¢-å¤–è¿æ¥

![image-20211122154827000](/images/JavaSE/21-MySql/image-20211122154827000.png)

```sql
# è¿™é‡Œä½¿ç”¨mgr  ä¸Šçº§åç§°æ¥æ¼”ç¤º
select worker.ename as "å‘˜å·¥åç§°",worker.job "å‘˜å·¥å·¥ä½œ",worker.mgr "å‘˜å·¥ä¸Šçº§" ,boss.ename "ä¸Šçº§åç§°"
 from emp as worker,emp as boss
 where worker.mgr = boss.empno;

+--------------+--------------+--------------+--------------+
| å‘˜å·¥åç§°       | å‘˜å·¥å·¥ä½œ      | å‘˜å·¥ä¸Šçº§      | ä¸Šçº§åç§°     |
+--------------+--------------+--------------+--------------+
| FORD         | ANALYST      |         7566 | JONES        |
| KING         | ANALYST      |         7566 | JONES        |
| MILLER       | CLERK        |         7782 | BLACK        |
| MILLER       | CLERK        |         7782 | BLACK        |
| SMITH        | CLERK        |         7902 | JAMES        |
+--------------+--------------+--------------+--------------+
# å¯ä»¥çœ‹åˆ°ï¼Œæœ‰äº›æ²¡æœ‰ä¸Šçº§çš„å‘˜å·¥æ˜¯æ— æ³•æ˜¾ç¤ºçš„ï¼Œåªæ˜¾ç¤ºäº†æœ‰ä¸Šçº§çš„ï¼Œä¸ºæ­¤éœ€è¦å¤–è¿æ¥æ¥è®©å‘˜å·¥çš„ä¸Šçº§å¯ä»¥å®Œå…¨æ˜¾ç¤º
# å³ä½¿ä»–æ²¡æœ‰ä¸Šçº§ï¼Œä¹Ÿè¦æ˜¾ç¤ºnull
```

Mysqlä¸­å¤–è¿æ¥åˆ†ä¸ºä¸¤ç§

### å·¦å¤–è¿æ¥

- å·¦å¤–è¿æ¥ å¦‚æœ`å·¦ä¾§çš„è¡¨èƒ½å¤Ÿå®Œå…¨æ˜¾ç¤º`å°±æ˜¯å·¦å¤–è¿æ¥

  - **å·¦è¾¹çš„è¡¨å³ä½¿å’Œå³è¾¹çš„è¡¨**æ²¡æœ‰å®Œå…¨åŒ¹é…çš„è®°å½•ä¹Ÿèƒ½å®Œå…¨æ˜¾ç¤ºå‡ºæ¥

  - è¯­æ³•ï¼š

    ```sql
    select å­—æ®µ  from
     å·¦è¾¹çš„è¡¨ LEFT JOIN å³è¾¹çš„è¡¨
     ON å·¦è¾¹çš„è¡¨çš„æŸä¸ªå€¼ = å³è¾¹çš„è¡¨çš„æŸä¸ªå€¼;
    
    # ä½¿ç”¨å·¦å¤–è¿æ¥ï¼Œæ˜¾ç¤ºæ‰€æœ‰å‘˜å·¥çš„ä¸Šçº§ï¼ŒåŒ…æ‹¬æ²¡æœ‰ä¸Šçº§çš„å‘˜å·¥
    select worker.ename as "å‘˜å·¥åç§°",worker.job "å‘˜å·¥å·¥ä½œ",worker.mgr "å‘˜å·¥ä¸Šçº§" ,boss.ename "ä¸Šçº§åç§°"
     from emp as worker LEFT JOIN emp as boss
     ON worker.mgr = boss.empno;
    +--------------+--------------+--------------+--------------+
    | å‘˜å·¥åç§°      | å‘˜å·¥å·¥ä½œ       | å‘˜å·¥ä¸Šçº§      | ä¸Šçº§åç§°      |
    +--------------+--------------+--------------+--------------+
    | SMITH        | CLERK        |         7902 | JAMES        |
    | WARD         | SALESMAN     |         7698 | NULL         |
    | JONES        | SALESMAN     |         7698 | NULL         |
    | MARTIN       | MANAGER      |         7939 | NULL         |
    | BLACK        | SALESMAN     |         7698 | NULL         |
    | COALK        | MANAGER      |         7698 | NULL         |
    | SOCTT        | MANAGER      |         7939 | NULL         |
    | KING         | ANALYST      |         7566 | JONES        |
    | TURNER       | PRESIDENT    |         NULL | NULL         |
    | JAMES        | CLERK        |         7698 | NULL         |
    | FORD         | ANALYST      |         7566 | JONES        |
    | MILLER       | CLERK        |         7782 | BLACK        |
    | MILLER       | CLERK        |         7782 | BLACK        |
    +--------------+--------------+--------------+--------------+
    ```

### å³å¤–è¿æ¥

- å³å¤–è¿æ¥ å¦‚æœ`å³ä¾§çš„è¡¨èƒ½å®Œå…¨æ˜¾ç¤º`å°±æ˜¯å³å¤–è¿æ¥

  - **å³è¾¹çš„è¡¨å³ä½¿å’Œå·¦è¾¹çš„è¡¨**æ²¡æœ‰å®Œå…¨åŒ¹é…çš„è®°å½•ä¹Ÿèƒ½å®Œå…¨æ˜¾ç¤ºå‡ºæ¥

  - è¯­æ³•

    ```sql
    select å­—æ®µ  from
     å·¦è¾¹çš„è¡¨ RIGHT JOIN å³è¾¹çš„è¡¨
     ON å³è¾¹çš„è¡¨çš„æŸä¸ªå€¼ = å·¦è¾¹çš„è¡¨çš„æŸä¸ªå€¼;
    
    # ä½¿ç”¨å·¦å¤–è¿æ¥ï¼Œæ˜¾ç¤ºæ‰€æœ‰å‘˜å·¥çš„ä¸‹çº§ï¼Œå³ä½¿æ²¡æœ‰ä¸‹çº§
    select worker.ename as "ä¸‹çº§å‘˜å·¥åç§°",worker.job "ä¸‹çº§å‘˜å·¥å·¥ä½œ",worker.mgr "ç®¡ç†è€…ID" ,boss.ename "ç®¡ç†è€…åç§°"
     from emp as worker RIGHT JOIN emp as boss
     ON worker.mgr = boss.empno;
    +--------------------+--------------------+-------------+-----------------+
    | ä¸‹çº§å‘˜å·¥åç§°         | ä¸‹çº§å‘˜å·¥å·¥ä½œ         | ç®¡ç†è€…ID     | ç®¡ç†è€…åç§°       |
    +--------------------+--------------------+-------------+-----------------+
    | NULL               | NULL               |        NULL | SMITH           |
    | NULL               | NULL               |        NULL | WARD            |
    | FORD               | ANALYST            |        7566 | JONES           |
    | KING               | ANALYST            |        7566 | JONES           |
    | NULL               | NULL               |        NULL | MARTIN          |
    | MILLER             | CLERK              |        7782 | BLACK           |
    | MILLER             | CLERK              |        7782 | BLACK           |
    | NULL               | NULL               |        NULL | COALK           |
    | NULL               | NULL               |        NULL | SOCTT           |
    | NULL               | NULL               |        NULL | KING            |
    | NULL               | NULL               |        NULL | TURNER          |
    | SMITH              | CLERK              |        7902 | JAMES           |
    | NULL               | NULL               |        NULL | FORD            |
    | NULL               | NULL               |        NULL | MILLER          |
    | NULL               | NULL               |        NULL | MILLER          |
    +--------------------+--------------------+-------------+-----------------+
    
    ```

# Mysqlçº¦æŸ

å˜›ï¼Œè¿™ç©æ„å¯èƒ½æ˜¯sqlä¸­åˆ›å»ºè¡¨æ—¶å¿…å¤‡çš„ç©æ„äº†

## Primary key ä¸»é”®çº¦æŸ

è¯­æ³•ï¼š`å­—æ®µå å­—æ®µç±»å‹ PRIMARY KEY`

ç”¨äºå”¯ä¸€çš„æ ‡è¯†è¯¥å­—æ®µï¼ˆè¡¨è¡Œï¼‰çš„æ•°æ®å½“å®šä¹‰ä¸»é”®åï¼Œè¯¥åˆ—**ä¸èƒ½é‡å¤**

è¿™ä¸ª ã€‚ã€‚ã€‚åªèƒ½è¯´æ˜¯ä¸€å¼ è¡¨éƒ½å¾—ç”¨å®ƒ

![image-20211122163807238](/images/JavaSE/21-MySql/image-20211122163807238.png)

```sql
# å‰é¢æ·»åŠ ä¸»é”®
create table è¡¨å(
 id int primary key,
    email varchar(50)
);
# åé¢æ·»åŠ ä¸»é”®
create table è¡¨å(
 id int ,
    email varchar(50),
    PRIMARY KEY(id)
);

# ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤åˆä¸»é”®

create table è¡¨å(
 id int,
    email varchar(50),
 PRIMARY KEY(id,email)
);
# è®©è¿™ä¸¤ä¸ªå€¼éƒ½ä¸èƒ½é‡å¤

# ä½†æ˜¯ä¸èƒ½ä¸¤ç§æ–¹å¼ä¸€èµ·ç”¨

create table è¡¨å(
 id int PRIMARY KEY, -- ç»å¯¹ä¸èƒ½å…ˆåœ¨è¿™å®šä¹‰ä¸»é”®ååˆåœ¨å°¾éƒ¨å®šä¹‰ä¸»é”® åªèƒ½äºŒé€‰ä¸€
    name varchar(30);
    email varchar(50),
 PRIMARY KEY(id,name);
)
```

## NOT NULL éç©ºçº¦æŸ

è¿™ä¸ªä¸å¤šè¯´äº†

```sql
create table è¡¨å(
 å­—æ®µå å­—æ®µç±»å‹ NOT NULL
)
```

## UNIQUE å”¯ä¸€çº¦æŸ

è®©æŸä¸ªå­—æ®µä¸èƒ½æœ‰é‡å¤å€¼

æ³¨æ„ï¼Œè¿™ç©æ„ä¸€å®šè¦é…åˆéç©ºçº¦æŸ`not null`æ¥ä½¿ç”¨

å¦‚æœæ²¡æœ‰æŒ‡å®š`not null`ï¼Œåˆ™`unique`å­—æ®µå¯ä»¥æœ‰å¤šä¸ªnull

```sql
create table è¡¨å(
 å­—æ®µå€¼ å­—æ®µç±»å‹ NOT NULL UNIQUE
);
```

## FOREIGN KEY å¤–é”®çº¦æŸ

è¯­æ³•ï¼š`FOREIGN KEY (æœ¬è¡¨å­—æ®µå) REFERENCES ä¸»è¡¨å(ä¸»é”®åæˆ–UNIQUEå­—æ®µå)`

ç”¨è¯­å®šä¹‰ä¸»è¡¨å’Œä»è¡¨ä¹‹é—´ å…³ç³»ï¼Œå¤–é”®çº¦æŸè¦å®šä¹‰åœ¨ä»è¡¨ä¸Šï¼Œä¸”ä¸»è¡¨å¿…é¡»å…·æœ‰ä¸»é”®çº¦æŸæˆ–æ˜¯`unique`çº¦æŸï¼Œå½“å®šä¹‰å¤–é”®çº¦æŸåï¼Œè¦æ±‚å¤–é”®çº¦æŸçš„å­—æ®µï¼ˆåˆ—ï¼‰çš„æ•°æ®ï¼ˆå€¼ï¼‰å¿…é¡»åœ¨ä¸»è¡¨çš„ä¸»é”®åˆ—å­˜åœ¨æˆ–æ˜¯ä¸ºnull

å¤–é”®çº¦æŸå®šä¹‰åï¼Œè‹¥ä¸»è¡¨è¦åˆ é™¤æŸä¸ªå€¼ï¼Œä¸”è¯¥å€¼æ­£åœ¨å¤–ç•Œçº¦æŸçš„å½±å“ä¸‹ï¼Œä¸”ä»è¡¨æ­£åœ¨ä½¿ç”¨ä»–ï¼Œéœ€è¦å…ˆåˆ é™¤æ­£åœ¨ä½¿ç”¨å®ƒçš„ä»è¡¨ä¸­ç”¨äº†å®ƒçš„å†…å®¹ï¼Œæ‰èƒ½åˆ é™¤å®ƒçš„å€¼

**ä¸€ä¸ªä»è¡¨ä¸­ï¼Œå¤–é”®å¯ä»¥æœ‰å¤šä¸ªï¼Œä»»ä½•è¡¨éƒ½å¯ä»¥æ˜¯ä»è¡¨**

![image-20211122170615206](/images/JavaSE/21-MySql/image-20211122170615206.png)

![image-20211122164902068](/images/JavaSE/21-MySql/image-20211122164902068.png)

![image-20211122164935895](/images/JavaSE/21-MySql/image-20211122164935895.png)

```sql
create table class_tab(
 id int primary key,
    name varchar(30) not null default ""
);

#å­¦ç”Ÿè¡¨ï¼Œå¤–é”®çº¦æŸ
create table student_tab(
 id int primary key, 
    name varchar(32) not null default "",
    class_id int,
    FOREIGN KEY (class_id) REFERENCES class_tab (id)
);

# æµ‹è¯•æ•°æ®
insert into class_tab values(1,"1å¹´çº§1ç­"),(2,"2å¹´çº§2ç­");

insert into student_tab values(1,"å¼ ä¸‰",1),(2,"æå››",2);

#æ’å…¥è¿™æ¡å°†ä¼šæŠ¥é”™
insert into student_tab values(3,"ç‹è€äº”",3);
#Cannot add or update a child row: a foreign key constraint fails (`db1`.`student_tab`, CONSTRAINT `student_tab_ibfk_1` FOREIGN KEY (`class_id`) REFERENCES `class_tab` (`id`))

# æ’å…¥è¯¥ç­çº§åå†æ’å…¥å€¼ å°†å¯ä»¥æ­£å¸¸æ’å…¥
insert into class_tab values(3,"3å¹´çº§3ç­");

insert into student_tab values(3,"ç‹è€äº”",3);

# å½“ç„¶ï¼Œå¦‚æœåœ¨å›¾å½¢åŒ–è½¯ä»¶é‡Œé¢ï¼Œå¯ä»¥æ›´ç›´è§‚çš„çœ‹åˆ°å¤–é”®
+----+-------------+
| id | name        |
+----+-------------+
|  1 | 1å¹´çº§1ç­    |
|  2 | 2å¹´çº§2ç­    |
|  3 | 3å¹´çº§3ç­    |
+----+-------------+

+----+-----------+----------+
| id | name      | class_id |
+----+-----------+----------+
|  1 | å¼ ä¸‰      |        1 |
|  2 | æå››      |        2 |
|  3 | ç‹è€äº”    |        3 |
+----+-----------+----------+

```

 å›¾å½¢åŒ–ç•Œé¢å¯ä»¥è½»æ¾åœ°é€‰æ‹©å¤–é”®

![image-20211122170505505](/images/JavaSE/21-MySql/image-20211122170505505.png)

## Checkçº¦æŸ -è¦æ±‚å­—æ®µæ»¡è¶³æŒ‡å®šæ¡ä»¶ï¼ˆæšä¸¾çº¦å®šï¼‰

![image-20211122171017894](/images/JavaSE/21-MySql/image-20211122171017894.png)

åœ¨Mysql8.0ä¸­ï¼Œå·²ç»å¯ä»¥æ”¯æŒéªŒè¯äº†ï¼Œæ’å…¥ä¸åˆæ³•çš„å€¼ï¼Œå°†æ’å…¥å¤±æ•ˆ

åœ¨`oracle`ã€`sql server`ä¸­ï¼Œè¿™ä¸ªçº¦æŸæ˜¯ä¸€å®šä¼šç”Ÿæ•ˆçš„

```sql
create table my_test_nx(
 id int primary key,
    name varchar(32),
    sex varchar(6) CHECK (sex IN('man','woman')),
    sal double check(sal>1000 and sal<2000)
);
insert into my_test_nx values(1,'å¼ ä¸‰','man',1001);
insert into my_test_nx values(2,'æå››','woman',1999);

# mysql8 ä¸­ è¿™æ¡å°†æ’å…¥å¤±æ•ˆ
insert into my_test_nx values(3,'ç‹è€äº”','ç”·',1999);
# ERROR 3819 (HY000): Check constraint 'my_test_nx_chk_1' is violated.
# è¿™æ¡ä¹Ÿæ˜¯
insert into my_test_nx values(3,'ç‹è€äº”','man',22333);
# ERROR 3819 (HY000): Check constraint 'my_test_nx_chk_2' is violated.

+----+--------+-------+------+
| id | name   | sex   | sal  |
+----+--------+-------+------+
|  1 | å¼ ä¸‰   | man   | 1001 |
|  2 | æå››   | woman | 1999 |
+----+--------+-------+------+

```

## Auto_increment-è‡ªå¢é•¿

å¦‚å…¶åï¼Œè‡ªåŠ¨å¢é•¿ï¼Œé€‚ç”¨äºä¸»é”®ç­‰ é€šå¸¸æƒ…å†µä¸‹ä¸»é”®éƒ½ä¼šç”¨å®ƒ

ä¹Ÿå¾—åï¼šä¸»é”®è‡ªå¢

![image-20211122173148429](/images/JavaSE/21-MySql/image-20211122173148429.png)

```sql
#è‡ªå¢é•¿
create table test_auto(
 id int primary key auto_increment,
    name varchar(255)
);

# ä¿®æ”¹é»˜è®¤çš„è‡ªå¢é•¿å¼€å§‹çš„å€¼
# 1.åˆ›å»ºæ—¶æŒ‡å®š
create table test_auto(
 id int primary key auto_increment,
    name varchar(255)
)auto_increment=10001;
# 2 åˆ›å»ºåä¿®æ”¹
alter table test_auto AUTO_INCREMENT = 1000;

```

### è‡ªå¢é•¿å¢å½’é›¶

Â·å¦‚æœæ›¾ç»çš„æ•°æ®éƒ½ä¸éœ€è¦çš„è¯ï¼Œå¯ä»¥ç›´æ¥æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Œå¹¶å°†è‡ªå¢å­—æ®µæ¢å¤ä»1å¼€å§‹è®¡æ•°
`truncate table è¡¨å`

æˆ–è€…è¦ä¿ç•™æ•°æ®ï¼Œä½†æ˜¯åæ’å…¥çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§æ–°çš„å€¼æ¥å¼€å§‹è®¡ç®—

`ALTER TABLE è¡¨å AUTO_INCREMENT = å€¼;`

```sql
insert into test_auto(name) values('jock'),('having'),('booluse');
+------+---------+
| id   | name    |
+------+---------+
| 1000 | jock    |
| 1001 | having  |
| 1002 | booluse |
+------+---------+
ALTER TABLE test_auto AUTO_INCREMENT = 6666;
insert into test_auto(name) values('jiny'),('makr'),('ddd');
+------+---------+
| id   | name    |
+------+---------+
| 1000 | jock    |
| 1001 | having  |
| 1002 | booluse |
| 6666 | jiny    |
| 6667 | makr    |
| 6668 | ddd     |
+------+---------+

```

# Mysqlç´¢å¼•

![image-20211122173232565](/images/JavaSE/21-MySql/image-20211122173232565.png)

å…ˆæŒ‰ç…§[è¿™ä¸ªæ•™ç¨‹](https://blog.csdn.net/qq_40530040/article/details/107623254)åˆ›å»ºä¸€ä¸ªæµ·é‡è¡¨

æˆ–è€…æŒ‰ç…§ä¸‹æ–¹ä»£ç é¡ºåºçš„è¿è¡Œ( åˆ†å¼€è¿è¡Œ)

ç¬¬ä¸€æ­¥ï¼š è¿™ä¸€æ­¥å¯èƒ½ä¼šå‡ºé”™ï¼Œå‡ºé”™çš„è¯å°±ä¸‰ä¸ªå»ºè¡¨çš„åˆ†å¼€æ‰§è¡Œå³å¯

```sql
# ç¬¬ä¸€è¡Œä»£ç çš„ç”¨é€”ï¼šhttps://blog.csdn.net/topasstem8/article/details/8216740/
set global log_bin_trust_function_creators=TRUE;
CREATE TABLE dept( /*éƒ¨é—¨è¡¨*/
deptno MEDIUMINT   UNSIGNED  NOT NULL  DEFAULT 0,
dname VARCHAR(20)  NOT NULL  DEFAULT "",
loc VARCHAR(13) NOT NULL DEFAULT ""
) ;
ï¬#åˆ›å»ºè¡¨EMPé›‡å‘˜
CREATE TABLE emp
(empno  MEDIUMINT UNSIGNED  NOT NULL  DEFAULT 0, /*ç¼–å·*/
ename VARCHAR(20) NOT NULL DEFAULT "", /*åå­—*/
job VARCHAR(9) NOT NULL DEFAULT "",/*å·¥ä½œ*/
mgr MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,/*ä¸Šçº§ç¼–å·*/
hiredate DATE NOT NULL,/*å…¥èŒæ—¶é—´*/
sal DECIMAL(7,2)  NOT NULL,/*è–ªæ°´*/
comm DECIMAL(7,2) NOT NULL,/*çº¢åˆ©*/
deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0 /*éƒ¨é—¨ç¼–å·*/
) ;
#å·¥èµ„çº§åˆ«è¡¨
CREATE TABLE salgrade
(
grade MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
losal DECIMAL(17,2)  NOT NULL,
hisal DECIMAL(17,2)  NOT NULL
);
#æµ‹è¯•æ•°æ®
INSERT INTO salgrade VALUES (1,700,1200);
INSERT INTO salgrade VALUES (2,1201,1400);
INSERT INTO salgrade VALUES (3,1401,2000);
INSERT INTO salgrade VALUES (4,2001,3000);
INSERT INTO salgrade VALUES (5,3001,9999);
```

ç¬¬äºŒæ­¥

```sql
delimiter $$

#åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œåå­— rand_stringï¼Œå¯ä»¥éšæœºè¿”å›æˆ‘æŒ‡å®šçš„ä¸ªæ•°å­—ç¬¦ä¸²
create function rand_string(n INT)
returns varchar(255) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
begin
#å®šä¹‰äº†ä¸€ä¸ªå˜é‡ chars_strï¼Œ ç±»å‹  varchar(100)
#é»˜è®¤ç»™ chars_str åˆå§‹å€¼   'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ'
 declare chars_str varchar(100) default
   'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ'; 
 declare return_str varchar(255) default '';
 declare i int default 0; 
 while i < n 
 do
    # concat å‡½æ•° : è¿æ¥å‡½æ•°mysqlå‡½æ•°
   set return_str =concat(return_str,substring(chars_str,floor(1+rand()*52),1));
   set i = i + 1;
   end while;
  return return_str;
  end $$


#è¿™é‡Œæˆ‘ä»¬åˆè‡ªå®šäº†ä¸€ä¸ªå‡½æ•°,è¿”å›ä¸€ä¸ªéšæœºçš„éƒ¨é—¨å·
create function rand_num( )
returns int(5)
begin
declare i int default 0;
set i = floor(10+rand()*500);
return i;
end $$

 #åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œ å¯ä»¥æ·»åŠ é›‡å‘˜
create procedure insert_emp(in start int(10),in max_num int(10))
begin
declare i int default 0;
#set autocommit =0 æŠŠautocommitè®¾ç½®æˆ0
 #autocommit = 0 å«ä¹‰: ä¸è¦è‡ªåŠ¨æäº¤
 set autocommit = 0; #é»˜è®¤ä¸æäº¤sqlè¯­å¥
 repeat
 set i = i + 1;
 #é€šè¿‡å‰é¢å†™çš„å‡½æ•°éšæœºäº§ç”Ÿå­—ç¬¦ä¸²å’Œéƒ¨é—¨ç¼–å·ï¼Œç„¶ååŠ å…¥åˆ°empè¡¨
 insert into emp values ((start+i) ,rand_string(6),'SALESMAN',0001,curdate(),2000,400,rand_num());
  until i = max_num
 end repeat;
 #commitæ•´ä½“æäº¤æ‰€æœ‰sqlè¯­å¥ï¼Œæé«˜æ•ˆç‡
   commit;
 end $$

#è¿™é‡Œæˆ‘ä»¬åˆè‡ªå®šäº†ä¸€ä¸ªå‡½æ•°,è¿”å›ä¸€ä¸ªéšæœºçš„éƒ¨é—¨å·
create function rand_num( )
returns int(5)
begin
declare i int default 0;
set i = floor(10+rand()*500);
return i;
end $$

 #åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œ å¯ä»¥æ·»åŠ é›‡å‘˜
create procedure insert_emp(in start int(10),in max_num int(10))
begin
declare i int default 0;
#set autocommit =0 æŠŠautocommitè®¾ç½®æˆ0
 #autocommit = 0 å«ä¹‰: ä¸è¦è‡ªåŠ¨æäº¤
 set autocommit = 0; #é»˜è®¤ä¸æäº¤sqlè¯­å¥
 repeat
 set i = i + 1;
 #é€šè¿‡å‰é¢å†™çš„å‡½æ•°éšæœºäº§ç”Ÿå­—ç¬¦ä¸²å’Œéƒ¨é—¨ç¼–å·ï¼Œç„¶ååŠ å…¥åˆ°empè¡¨
 insert into emp values ((start+i) ,rand_string(6),'SALESMAN',0001,curdate(),2000,400,rand_num());
  until i = max_num
 end repeat;
 #commitæ•´ä½“æäº¤æ‰€æœ‰sqlè¯­å¥ï¼Œæé«˜æ•ˆç‡
   commit;
 end $$
```

ç¬¬ä¸‰æ­¥ï¼š

```sql
delimiter $$
# è¿™é‡Œæ˜¯ç”Ÿæˆçš„æ•°æ®é‡
CALL insert_emp ( 100001, 10000 ) $$
DELIMITER;
# è¿™é‡Œçš„10000 å¯ä»¥æ›¿æ¢ä¸ºè‡ªå·±æƒ³è¦çš„æ•°å€¼ï¼Œæˆ‘æ›¿æ¢çš„æ˜¯100w ç”¨æ—¶300s
```

å¯¹è‡ªå·±ç”µè„‘æœ‰ä¿¡å¿ƒçš„è¯å¯ä»¥1000wï¼Œåƒä¸‡ä¸è¦1ä¸ªäº¿ï¼Œé™¤éä½ çš„æ—¶é—´å’Œç¡¬ç›˜ç©ºé—´æ˜¯çœŸæ»´å¤š

æ¥ä¸‹æ¥å°è¯•æŸ¥è¯¢ä¸‹ï¼š

```sql
select * from emp where empno=123456;
+--------+--------+----------+------+------------+---------+--------+--------+
| empno  | ename  | job      | mgr  | hiredate   | sal     | comm   | deptno |
+--------+--------+----------+------+------------+---------+--------+--------+
| 123456 | qJxjJC | SALESMAN |    1 | 2021-11-22 | 2000.00 | 400.00 |    432 |
+--------+--------+----------+------+------------+---------+--------+--------+
1 row in set (0.75 sec)

# å¯ä»¥çœ‹åˆ°ï¼Œè¿™åªæ˜¯æ’å…¥äº†100wæ¡æ•°æ®ï¼ŒæŸ¥è¯¢çš„é€Ÿåº¦å°±å˜æˆäº†0.75s
# 1kwå¤§æ¦‚è¦5~10s
# å¦‚æœåœ¨å·¥ä½œä¸­ï¼ŒæŸ¥ä¸ªä¸œè¥¿ç»™ç”¨æˆ·è¦è¿™ä¹ˆä¹…æ—¶é—´ï¼Œä¼šè¢«éª‚æ­»..
# ä¸¾ä¸ªå½¢è±¡ç‚¹çš„ä¾‹å­ï¼Œæ‰“ä¸ªæ¸¸æˆï¼Œä¹°ä¸ªè£…å¤‡ï¼Œè¦åœ¨å•†åº—å‰ç­‰åˆ°5ç§’æ‰èƒ½æ‹¿åˆ°è£…å¤‡
# 5ç§’åœ¨é‚£é‡Œå¡ç€å¹²ç­‰ï¼Œä»€ä¹ˆéƒ½åšä¸äº†
```

æ¥ä¸‹æ¥ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–ä¸‹è¡¨

![image-20211122204414063](/images/JavaSE/21-MySql/image-20211122204414063.png)

ä¼˜åŒ–å‰ï¼Œè¿™ä¸ªè¡¨æ˜¯72mbï¼ŒæŸ¥è¯¢ä¸€æ¬¡å¤§æ¦‚è¦1sçš„æ—¶é—´

## åˆ›å»ºç´¢å¼•

è¯­æ³•ï¼š`CREATE INDEX ç´¢å¼•å ON è¡¨å(å­—æ®µ);`

ç´¢å¼•åˆ›å»ºéœ€è¦æ—¶é—´ï¼Œç´¢å¼•è·Ÿæ•°æ®ä¸€æ ·ï¼Œä¹Ÿå ç”¨ç©ºé—´

ä½†æ˜¯èƒ½å¯¹æŸ¥è¯¢é€Ÿåº¦æœ‰æ˜¾è‘—æå‡

```sql
CREATE INDEX empno_index ON emp(empno);
# empno_index ç´¢å¼•åç§°
# ON emp(empno) è¡¨ç¤ºåœ¨è¡¨empçš„empnoè¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•;
# æˆ‘è¿™é‡Œåˆ›å»ºç´¢å¼•èŠ±äº†3s
```

![image-20211122204942231](/images/JavaSE/21-MySql/image-20211122204942231.png)

åˆ›å»ºå®Œæ¯•åï¼Œæ–‡ä»¶å¤§äº†10mb

ç´¢å¼•æœ¬èº«ä¹Ÿæ˜¯ä¼šå ç”¨ç£ç›˜ç©ºé—´

æ¥ä¸‹æ¥å°è¯•æœç´¢ä¸‹

```sql
select * from emp where empno=123486;
+--------+--------+----------+-----+------------+---------+--------+--------+
| empno  | ename  | job      | mgr | hiredate   | sal     | comm   | deptno |
+--------+--------+----------+-----+------------+---------+--------+--------+
| 123486 | XHtVyJ | SALESMAN |   1 | 2021-11-22 | 2000.00 | 400.00 |    365 |
+--------+--------+----------+-----+------------+---------+--------+--------+
1 row in set (0.00 sec)
# ç¬é—´å®Œæˆ...
# å¦‚æœæ˜¯1000wæ¡æ•°æ®ï¼Œä¹Ÿæ˜¯å¯ä»¥è¿™æ ·å®Œæˆ ä¸ä¿¡çš„è¯è‡ªè¡Œå°è¯•...

# å½“ç„¶ï¼Œåˆ›å»ºç´¢å¼•åï¼Œåªå¯¹åˆ›å»ºäº†ç´¢å¼•çš„åˆ—æœ‰æ•ˆ
select * from emp where ename='SxKgBm';
mysql> select * from emp where ename='SxKgBm';
+--------+--------+----------+-----+------------+---------+--------+--------+
| empno  | ename  | job      | mgr | hiredate   | sal     | comm   | deptno |
+--------+--------+----------+-----+------------+---------+--------+--------+
| 114014 | SxKgBm | SALESMAN |   1 | 2021-11-22 | 2000.00 | 400.00 |    339 |
| 627592 | SxKgBm | SALESMAN |   1 | 2021-11-22 | 2000.00 | 400.00 |    326 |
+--------+--------+----------+-----+------------+---------+--------+--------+
2 rows in set (0.84 sec)
# æ²¡åˆ›å»ºç´¢å¼•çš„åˆ—ä¾æ—§è¦1så·¦å³çš„æ—¶é—´

# å¦‚æœä¸ºenmae ä¹Ÿåˆ›å»ºä¸ªç´¢å¼•ï¼š
CREATE INDEX ename_index ON emp(ename);
# åˆ›å»ºå®Œæ¯•åï¼Œæ–‡ä»¶å˜æˆäº†108MB
# æœç´¢
select * from emp where ename='SxKgBm';
+--------+--------+----------+-----+------------+---------+--------+--------+
| empno  | ename  | job      | mgr | hiredate   | sal     | comm   | deptno |
+--------+--------+----------+-----+------------+---------+--------+--------+
| 114014 | SxKgBm | SALESMAN |   1 | 2021-11-22 | 2000.00 | 400.00 |    339 |
| 627592 | SxKgBm | SALESMAN |   1 | 2021-11-22 | 2000.00 | 400.00 |    326 |
+--------+--------+----------+-----+------------+---------+--------+--------+
2 rows in set (0.00 sec)


```

å½“ç„¶ï¼Œç›®å‰ä¹Ÿæœ‰å¾ˆå¤šä¸è‰¯ç¨‹åºå‘˜ï¼Œä¼šç›´æ¥æŠŠäº§å“ç»™ç”¨æˆ·ç”¨ï¼Œç›´åˆ°ç”¨æˆ·å‘è§‰å¾ˆæ…¢çš„æ—¶å€™ï¼Œè®©ç”¨æˆ·åŠ é’±ä¼˜åŒ–

## ç´¢å¼•æœºåˆ¶

ä¸‹å›¾åˆ°æŸ¥è¯¢åˆ°1åä¸ç¡®å®šåé¢è¿˜æ²¡æœ‰æ²¡æœ‰id=1çš„ï¼Œæ‰€ä»¥è¦å…¨è¡¨æ‰«æ

![image-20211122211047180](/images/JavaSE/21-MySql/image-20211122211047180.png)

![image-20211122212123404](/images/JavaSE/21-MySql/image-20211122212123404.png)

ç´¢å¼•å¿«çš„åŸå› 

- å½¢æˆäº†äºŒå‰æ ‘æˆ–Bæ ‘ç­‰ æ•°æ®ç»“æ„ï¼Œè®©æŸ¥è¯¢èµ·æ¥å˜å¾—é«˜æ•ˆå¿«æ·
  - äºŒå‰æ ‘è¿™ç©æ„ä»¥åä¸€å®šå¾—å­¦

ç´¢å¼•çš„ä»£ä»·

- ç£ç›˜å ç”¨å¢åŠ 

  - ç´¢å¼•çš„æ•°æ®ç»“æ„ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„

- DML(update delete insert)æ•ˆç‡å˜æ…¢ï¼ˆå½±å“ä¸æ˜¯å¾ˆå¤§ï¼‰

  - å¢åˆ æ”¹ä¸€ä¸ªæ•°æ®åï¼Œè¦é‡æ–°çš„å»ç»´æŠ¤è¿™ä¸ªç´¢å¼•

  ![image-20211122212421742](/images/JavaSE/21-MySql/image-20211122212421742.png)

å½“ç„¶ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå®é™…ä¸Š90%å·¦å³çš„ä¸šåŠ¡éƒ½æ˜¯åœ¨è¿›è¡ŒæŸ¥è¯¢ï¼Œåªæœ‰10%å·¦å³çš„ä¸šåŠ¡åœ¨è¿›è¡Œå¢åˆ æ”¹

## ç´¢å¼•çš„ç±»å‹

1. ä¸»é”®ç´¢å¼•ï¼Œä¸»é”®è‡ªåŠ¨ä¸ºä¸»ç´¢å¼•ï¼ˆåŠ äº†`primary key`çš„å­—æ®µå°±ä¸éœ€è¦åŠ å…¶ä»–çš„ç´¢å¼•äº†ï¼‰

   ```sql
   crate table t1(
    id int PRIMARY KEY
       # ä¸»é”®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç´¢å¼•ï¼Œç§°ä¸ºä¸»é”®ç´¢å¼•
   )
   ```

2. å”¯ä¸€ç´¢å¼•`unique` åŒä¸Š

3. æ™®é€šç´¢å¼•`index`

   ```sql
   CREATE INDEX ç´¢å¼•å ON è¡¨å(å­—æ®µ);
   ```

4. å…¨æ–‡ç´¢å¼•(`fulltext`)

   - mysqè‡ªå¸¦è¿™ç©æ„ï¼Œä½†æ˜¯ä¸å¥½ç”¨ï¼Œæ•ˆç‡ä¹Ÿæ¯”è¾ƒä½
   - åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¾ˆå°‘ä¼šç”¨mysqlè‡ªå¸¦çš„å…¨æ–‡ç´¢å¼•ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨ä¸€äº›æ¡†æ¶çš„å…¨æ–‡æœç´¢ï¼š
     - æ¯”å¦‚Javaçš„`Solr`å’Œ`ElasticSearch`æ¡†æ¶
   - ä¸€èˆ¬å¼€å‘ä¸­ä¸ä½¿ç”¨mysqlè‡ªå¸¦çš„å…¨æ–‡ç´¢å¼•ï¼ˆä»»ä½•è¯­è¨€éƒ½æ˜¯å¦‚æ­¤ï¼‰

## å„ç§ç±»å‹çš„ç´¢å¼•æ·»åŠ ã€æŸ¥è¯¢ã€åˆ é™¤ã€ä¿®æ”¹

**æ·»åŠ ç´¢å¼•ï¼š**

`create [å¯é€‰ UNIQUE] index ç´¢å¼•å on è¡¨å(å­—æ®µ1 [å¯é€‰ï¼šlength]  [å¯é€‰ ASC|DESC], å­—æ®µ2...  )`

å¦‚æœæŸåˆ—çš„å€¼æ˜¯ä¸ä¼šé‡å¤çš„ï¼Œåˆ™ä¼˜å…ˆè€ƒè™‘uniqueç´¢å¼•

æ·»åŠ uniqueç´¢å¼•çš„åŒæ—¶ä¹Ÿä¼šæ·»åŠ å”¯ä¸€çº¦æŸ

æˆ–è€…

`alter table è¡¨å add index ç´¢å¼•å (å­—æ®µå...)`

è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æ·»åŠ ä¸»é”®ç´¢å¼•`alter table è¡¨å add primary key (å­—æ®µ);`

**æŸ¥çœ‹ç´¢å¼•ï¼š**

- `show index from  è¡¨å;`
- `show indexes from è¡¨å;`

- `show keys from è¡¨å`

ä¸‰ç§æ–¹å¼éƒ½æ˜¯ç›¸åŒçš„ç»“æœ

- `desc è¡¨å` ä¸­çš„KEYå­—æ®µå°±æ˜¯ç´¢å¼• é€šè¿‡è¿™ç§æ–¹å¼æŸ¥æ‰¾å‡ºæ¥çš„ç´¢å¼•ä¿¡æ¯æ²¡æœ‰å‰é¢çš„é‚£ä¹ˆè¯¦ç»†

**åˆ é™¤æ™®é€šç´¢å¼•ï¼š**

`drop index ç´¢å¼•åç§° on è¡¨å;`

åˆ é™¤ä¸»é”®ç´¢å¼•ï¼š`alter table è¡¨å drop primary key;`

ä¿®æ”¹ç´¢å¼•ï¼šå…ˆåˆ é™¤ï¼Œç„¶åæ·»åŠ æ–°çš„ç´¢å¼•~

```sql
create table ts(
 id int,
    name varchar(32)
);

#æŸ¥è¯¢ä¸€ä¸ªè¡¨æ˜¯å¦æœ‰ç´¢å¼•
SHOW INDEXES FROM ts;
#Empty set (0.00 sec)
# æ²¡æœ‰ä»»ä½•ç´¢å¼•

# æ·»åŠ å”¯ä¸€ç´¢å¼•
create unique index id_index ON ts(id);

# æ·»åŠ æ™®é€šç´¢å¼•-alteræ–¹å¼
alter table ts add index name_index (name);

# æ·»åŠ ä¸»é”®ç´¢å¼•
create table ts2(
 id int, # è¦ä¹ˆåœ¨è¿™é‡ŒåŠ 
    name varchar(32)
    #è¦ä¹ˆåœ¨è¿™é‡ŒåŠ 
);
# åˆ›å»ºæ—¶å€™æ²¡åŠ çš„è¯å°±ï¼š
alter table ts2 add primary key (id);

```

æ·»åŠ å®Œç´¢å¼•åæŸ¥çœ‹ï¼šå”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„ï¼š

![image-20211122220117209](/images/JavaSE/21-MySql/image-20211122220117209.png)

ä¸»é”®ç´¢å¼•çš„ï¼š

![image-20211122220509463](/images/JavaSE/21-MySql/image-20211122220509463.png)

```sql
# åˆ é™¤æ™®é€šç´¢å¼•
drop index id_index on ts;
drop index name_index on ts;

# åˆ é™¤ä¸»é”®ç´¢å¼•
alter table ts2 drop primary key;

```

## ç´¢å¼•ä½¿ç”¨åŸåˆ™

åˆ›å»ºç´¢å¼•å‰ï¼Œå…ˆçœ‹çœ‹æ˜¯å¦éµå¾ªä»¥ä¸‹åŸåˆ™ï¼ˆå½“ç„¶ä¸Šå¸ç‰¹åˆ«è¦æ±‚çš„ç©æ„çš„è¯ï¼Œå•¥ç´¢å¼•éƒ½å¯ä»¥æ”¾ä¸Šå»ï¼‰

1. è¾ƒé¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶å­—æ®µ**åº”è¯¥**åˆ›å»ºç´¢å¼•

   ```sql
   select * from emp where empno = 1;
   ```

2. å”¯ä¸€æ€§å¤ªå·®çš„å­—æ®µ**ä¸é€‚åˆ**å•ç‹¬åˆ›å»ºç´¢å¼•ï¼Œå³ä½¿è¯¥å­—æ®µé¢‘ç¹çš„ä½œä¸ºæŸ¥è¯¢æ¡ä»¶

   ```sql
   select * from emp where sex="ç”·";
   ```

3. æ›´æ–°éå¸¸é¢‘ç¹çš„å­—æ®µ**ä¸é€‚åˆ**åˆ›å»ºç´¢å¼•

   ```sql
   select * from emp where logincount = 1;
   ```

4. ä¸ä¼šå‡ºç°åœ¨whereå­—å¥ä¸­çš„å­—æ®µ**ä¸è¯¥**åˆ›å»ºç´¢å¼•

# Mysqläº‹åŠ¡

äº‹åŠ¡ç”¨äºä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå®ƒç”±ä¸€ç»„ç›¸å…³çš„dmlè¯­å¥æ„æˆï¼Œè¯¥ç»„çš„dmlè¯­å¥è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
å¦‚ï¼šè½¬è´¦å°±è¦ç”¨äº‹åŠ¡æ¥å¤„ç†ï¼Œç”¨ä»¥ç¡®ä¿äº‹åŠ¡çš„ä¸€è‡´æ€§

å½“æ‰§è¡Œäº‹åŠ¡æ“ä½œæ—¶(DMLè¯­å¥)ï¼ŒMYSQLä¼šåœ¨è¡¨ä¸ŠåŠ é”ï¼Œé˜²æ­¢å…¶ä»–ç”¨æˆ·ä¿®æ”¹è¡¨çš„æ•°æ®ï¼Œè¿™å¯¹ç”¨æˆ·æ¥è®²æ˜¯éå¸¸é‡è¦çš„

![image-20211122222616278](/images/JavaSE/21-MySql/image-20211122222616278.png)

ä½¿ç”¨MySQLçš„äº‹åŠ¡ï¼Œç¬¬ä¸€æ­¥**å¿…é¡»å¾—ç¡®ä¿**Mysqlå½“å‰æ˜¯æ˜¯innodbå¼•æ“ï¼ŒæŸ¥çœ‹æ–¹å¼

`show engines`

![image-20211122225446144](/images/JavaSE/21-MySql/image-20211122225446144.png)

çœ‹åˆ°innoDBè¿™é‡Œçš„supportæ˜¯defaultå³å¯ï¼›å¦‚æœä¸æ˜¯å°±è¦ç™¾åº¦è‡ªè¡Œå¼€å¯

## åŸºæœ¬è¯­æ³•

- `start transaction` å¼€å§‹ä¸€ä¸ªäº‹åŠ¡
  - æˆ–è€…`set autocommit=off`
- `savepoint` ä¿å­˜ç‚¹å è®¾ç½®ä¿å­˜ç‚¹
- `rollback to` ä¿å­˜ç‚¹å å›é€€äº‹åŠ¡
- `rollback` å›é€€å…¨éƒ¨äº‹ç‰©
- `commit` æäº¤äº‹åŠ¡ï¼Œæ‰€æœ‰çš„æ“ä½œç”Ÿæ•ˆï¼Œä¸èƒ½å›é€€

![image-20211122224421237](/images/JavaSE/21-MySql/image-20211122224421237.png)

![image-20211122223136404](/images/JavaSE/21-MySql/image-20211122223136404.png)

å›æ»šå¯ä»¥è®©äº‹åŠ¡èƒ½åƒåæ‚”è¯

```sql
# 1  æµ‹è¯•è¡¨
create table person(
 id int,
    name varchar(32)
);
# 2 å¼€å§‹äº‹åŠ¡
START TRANSACTION;
# 3 è®¾ç½®ä¿å­˜ç‚¹
SAVEPOINT a;
# æ‰§è¡Œdmlæ“ä½œ
INSERT INTO person values(100,'tom');
select * from person;
+------+------+
| id   | name |
+------+------+
|  100 | tom  |
+------+------+

# è®¾ç½®ç¬¬äºŒä¸ªä¿å­˜ç‚¹
savepoint b;
# æ‰§è¡Œdmlæ“ä½œ
INSERT INTO person values(200,'jack');
select * from person;
+------+------+
| id   | name |
+------+------+
|  100 | tom  |
|  200 | jack |
+------+------+

# å›é€€åˆ°Bä¿å­˜ç‚¹
ROLLBACK TO b;
select * from person;

+------+------+
| id   | name |
+------+------+
|  100 | tom  |
+------+------+

#ç»§ç»­å›é€€
rollback to a;
select * from person;
#--æ²¡æœ‰ä»»ä½•è®°å½•

#å¦‚æœç›´æ¥rollback
ROLLBACK; 
# ç›´æ¥å›é€€åˆ°äº‹ç‰©å¼€å§‹çš„çŠ¶æ€

INSERT INTO person values(200,'jack');

# æäº¤æ‰€æœ‰äº‹ç‰©ï¼Œè®©å…¶æ— æ³•å›é€€ å¹¶ä¸”å°†æ‰€æœ‰ä¿å­˜ç‚¹ä¸€å¹¶åˆ é™¤
commit;
select * from person;

#å¦‚æœè¯•å›¾å†æ¬¡å›é€€
rollback to a;
#ERROR 1305 (42000): SAVEPOINT a does not exist



```

## äº‹åŠ¡çš„ç»†èŠ‚

![image-20211122224643847](/images/JavaSE/21-MySql/image-20211122224643847.png)

æ•°æ®åº“çš„å­˜å‚¨å¼•æ“ä¸€å®šè¦æ˜¯innodbï¼

## Mysqlçš„äº‹åŠ¡éš”ç¦»çº§åˆ«

1. å¤šä¸ªè¿æ¥å¼€å¯å„è‡ªäº‹åŠ¡æ“ä½œæ•°æ®åº“ä¸­æ•°æ®æ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿè¦è´Ÿè´£éš”ç¦»æ€§ï¼Œä»¥ä¿è¯å„ä¸ªè¿æ¥åœ¨è·å–æ•°æ®æ—¶çš„å‡†ç¡®æ€§
2. å¦‚æœä¸è€ƒè™‘éš”ç¦»æ€§ï¼Œå¯èƒ½ä¼šå¼•å‘å¦‚ä¸‹é—®é¢˜ï¼š
   - è„è¯»
     å½“ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡å°šæœªæäº¤çš„æ”¹å˜(å¢åˆ æ”¹)æ—¶ï¼Œäº§ç”Ÿè„è¯»
   - ä¸å¯é‡å¤è¯»
     åŒä¸€æŸ¥è¯¢åœ¨åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¿›è¡Œï¼Œç”±äºå…¶ä»–æäº¤äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹æˆ–åˆ é™¤ï¼Œæ¯æ¬¡è¿”å›ä¸åŒçš„ç»“æœé›†ï¼Œæ­¤æ—¶å‘ç”Ÿä¸å¯é‡å¤åº¦
   - å¹»è¯»
     åŒä¸€æŸ¥è¯¢åœ¨åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¿›è¡Œï¼Œç”±äºå…¶ä»–æäº¤äº‹åŠ¡æ‰€åšçš„æ’å…¥æ“ä½œï¼Œæ¯æ¬¡è¿”å›ä¸åŒçš„ç»“æœï¼Œæ­¤æ—¶å‘ç”Ÿå¹»è¯»

![image-20211122230850135](/images/JavaSE/21-MySql/image-20211122230850135.png)

![image-20211122231201037](/images/JavaSE/21-MySql/image-20211122231201037.png)

æŸ¥çœ‹å½“å‰Mysqlçš„éš”ç¦»çº§åˆ«ï¼š

- Mysql5.7:
  - `select @@tx_isolation;`
- Mysql 8+:
  - `select @@transaction_isolation;`
  - `show variables like 'transaction_isolation';`

å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰Mysqlçš„éš”ç¦»çº§åˆ«æ˜¯(Mysql 8):

```sql
+-------------------------+
| @@transaction_isolation |
+-------------------------+
| REPEATABLE-READ         |
+-------------------------+
# é»˜è®¤çº§åˆ«-å¯é‡å¤åº¦
```

### è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰

ä¸ºäº†æ¼”ç¤ºï¼Œå…ˆæŠŠå…¶ä¸­ä¸€ä¸ªæ§åˆ¶å°ï¼ˆç¬¬äºŒä¸ªæ§åˆ¶å°ï¼‰çš„éš”ç¦»çº§åˆ«æ”¹æˆè¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰

```sql
SET SESSION TRANSACTION isolation LEVEL read uncommitted;
#isolationå°±æ˜¯éš”ç¦»çš„æ„æ€
# level å°±æ˜¯çº§åˆ«çš„æ„æ€
```

ç„¶åæŸ¥çœ‹å…¶éš”ç¦»çº§åˆ«ï¼š

```sql
# ç¬¬ä¸€ä¸ªæ§åˆ¶å°ï¼š å¯é‡å¤åº¦
+-----------------------+-----------------+
| Variable_name         | Value           |
+-----------------------+-----------------+
| transaction_isolation | REPEATABLE-READ |
+-----------------------+-----------------+

#ç¬¬äºŒä¸ªæ§åˆ¶å°ï¼š è¯»æœªæäº¤
+-----------------------+------------------+
| Variable_name         | Value            |
+-----------------------+------------------+
| transaction_isolation | READ-UNCOMMITTED |
+-----------------------+------------------+
```

éš”ç¦»çº§åˆ«æ˜¯è·Ÿäº‹åŠ¡ç›¸å…³çš„ï¼Œä¸€å®šè¦å…ˆå¯åŠ¨äº‹åŠ¡ï¼Œæ‰èƒ½è°ˆéš”ç¦»çº§åˆ«çš„é—®é¢˜ï¼Œç¦»å¼€äº‹åŠ¡å°±ä¸è¦è°ˆéš”ç¦»çº§åˆ«çš„é—®é¢˜

é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¡¨

```sql
use table db1;
create account(id int ,name varchar(32),money int);
```

ç„¶åä¸¤ä¸ªæ§åˆ¶å°å‡å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œ

```sql
start transaction;
```

ç„¶åconsole1 å†™å…¥ä¸€ä¸ªæ•°æ®

```
insert into account values(1,"å¼ ä¸‰",1000);
```

ç„¶åä¸¤ä¸ªè¡¨åŒæ—¶æŸ¥è¯¢è¿™ä¸€ä¸ªè¡¨ï¼Œå‘ç°ï¼š

```sql
# console 1
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
+------+--------+-------+

# console 2
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
+------+--------+-------+

```

è¿™å°±æ˜¯è„è¯»ï¼š**å½“ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡å°šæœªæäº¤çš„æ”¹å˜(å¢åˆ æ”¹)æ—¶ï¼Œäº§ç”Ÿè„è¯»**

ç„¶åæˆ‘å†å¾€console 1ä¸­ä¿®æ”¹ä¸‹å†…å®¹ï¼Œå†æ·»åŠ ä¸€ä¸ªæ–°çš„value

```sql
update account set money =800 where id = 100;
insert into account values(2,"jock",222);
```

æ­¤æ—¶å†æŸ¥çœ‹console2

```sql
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
|    2 | jock   |   222 |
+------+--------+-------+
```

å‘ç°ä»–è¿™ä¹‹ä¸­æ˜¾ç¤ºäº†console1å¯¹è¡¨æ“ä½œçš„ç»“æœ

è¿™ä¸ªæœ¬åº”è¯¥æ˜¯ä¸å­˜åœ¨çš„------

â€‹ è¿™é‡ŒæŠŠconsole 1 å«åšAï¼Œconsole 2å«åšB

â€‹ äº‹åŠ¡çš„æœ¬æ„(æ½œå°è¯)æ˜¯ï¼šè®©Båœ¨è¿›å…¥äº‹åŠ¡çš„æ—¶é—´ç‚¹ï¼Œåªå±•ç¤ºæ”¹æ—¶é—´ç‚¹æœ‰çš„å†…å®¹ï¼Œå³ï¼šä¸€ä¸ªç©ºçš„accountè¡¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡Aæ“ä½œï¼ŒBå°±èƒ½åŒæ­¥æ„ŸçŸ¥Aæ“ä½œçš„ç»“æœï¼Œè¿›è€Œå½±å“Bçš„æŸ¥è¯¢ï¼Œåªè¦Bè¿˜æ²¡æœ‰æäº¤`commit`ï¼ŒBè¯»å–åˆ°çš„å°±åº”è¯¥æ˜¯å®ƒå¼€å¯äº‹åŠ¡æ—¶SQLæ‰€æ‹¥æœ‰çš„æ•°æ®ï¼Œè€Œä¸å—åˆ°å…¶ä»–äº‹åŠ¡å¯¹SQLçš„å½±å“

â€‹ äº‹åŠ¡çš„æœ€ç†æƒ³æ•ˆæœï¼šå½“Bå¼€å¯åè¿æ¥åˆ°ACCOUNTè¡¨å¹¶å¯¹å…¶æ“ä½œæ—¶ï¼ŒBä¸ä¼šæ¥æ”¶åˆ°Aæ“ä½œå¸¦æ¥çš„å½±å“ï¼ŒBçš„æ“ä½œåŒæ—¶ä¹Ÿä¸å›å½±å“Aï¼Œä¹Ÿä¸å¸Œæœ›äº’ç›¸å½±å“åˆ°C ã€Dã€E.....çš„æ“ä½œå’Œå…¶å¸¦æ¥çš„å½±å“

å…¶å®åˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œå·²ç»å¯ä»¥å‘ç°ï¼Œè¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰å·²ç»å‡ºç°äº† è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»

### è¯»å·²æäº¤(Read committed)

â€‹  æ¥ä¸‹æ¥å°†Aå’ŒBçš„äº‹åŠ¡éƒ½æäº¤ï¼Œç„¶åAé‡æ–°å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼ŒBå°†éš”ç¦»çº§åˆ«æ”¹å˜ä¸ºè¯»å·²æäº¤(Read committed) å¹¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡

```sql
# A & B
commit;

# A
start transaction;

# B
SET SESSION TRANSACTION isolation LEVEL read committed;
start transaction;

```

ç„¶åAæ·»åŠ ä¸€æ¡æ•°æ®ï¼ŒAã€Bå†è¿›è¡ŒæŸ¥æ‰¾è¿™ä¸ªè¡¨

```sql
# A 
 insert into account values(3,'scott',8000);
 
# A
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
|    2 | jock   |   222 |
|    3 | scott  |  8000 |
+------+--------+-------+

# B
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
|    2 | jock   |   222 |
+------+--------+-------+
 
```

å¯ä»¥çœ‹åˆ°Bçš„è¡¨ä¸­å¹¶æ²¡æœ‰å‡ºç°Açš„è¡¨ä¸­æ‰€å‡ºç°çš„ç¬¬ä¸‰æ¡æ•°æ®ï¼Œå³ï¼šè¯»å·²æäº¤(Read committed)éš”ç¦»å¼€å¯åï¼Œå°†ä¸ä¼šå‡ºç°è„è¯»äº†

ç„¶åAå†ä¿®æ”¹ä¸€æ¡æ•°æ®å¹¶æäº¤ï¼ŒæŸ¥çœ‹Bæ­¤æ—¶çš„æ•°æ®ï¼š

```sql
# A
update account set money = 1800 where id = 2;
commit;


# B
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
|    2 | jock   |  1800 |
|    3 | scott  |  8000 |
+------+--------+-------+

# B

commit;

```

å¯ä»¥å‘ç° ï¼ŒBè¡¨ä¸­çš„ä¸å¯é‡å¤è¯»ï¼Œå’Œå¹»è¯»é—®é¢˜ä¾æ—§å­˜åœ¨

ç”±ä¸Šå¯çŸ¥ï¼Œåœ¨è¯»å·²æäº¤(Read committed)çº§åˆ«ä¸‹ï¼Œè„è¯»å·²ç»ä¸å¤å­˜åœ¨ï¼Œä½†æ˜¯ä¾æ—§å‡ºç°äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»

### å¯é‡å¤è¯»(Repeatable read)

 æ¥ä¸‹æ¥æŠŠBæ”¹ä¸ºå¯é‡å¤è¯»(Repeatable read)å¹¶å¼€å¯æ–°çš„äº‹åŠ¡

```sql
# A
 start transaction;
 
# B 
SET SESSION TRANSACTION isolation LEVEL Repeatable read
start transaction;
```

ç„¶åAæ·»åŠ ä¸€æ¡æ•°æ® ï¼ŒBè¿›è¡Œselect

```sql
# A
insert into account values(4,'milan',300);
# B
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
|    2 | jock   |  1800 |
|    3 | scott  |  8000 |
+------+--------+-------+
```

 å¯ä»¥çœ‹åˆ°å¹¶æœªå—Açš„å½±å“

ç„¶åAä¿®æ”¹ä¸€æ¡æ•°æ®

```sql
# A
update account set money = 100 where id = 3;

# B
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
|    2 | jock   |  1800 |
|    3 | scott  |  8000 |
+------+--------+-------+
# Bä¾æ—§æ²¡æœ‰æ”¶åˆ°å½±å“
```

ç„¶åA commit

```sql
# A 
commit;

# B
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |  1000 |
|    2 | jock   |  1800 |
|    3 | scott  |  8000 |
+------+--------+-------+
```

å¯ä»¥å‘ç°Bæ²¡æœ‰å—åˆ°å½±å“ï¼Œçœ‹ä¸åˆ°Açš„å˜åŒ–

è¿™å°±æ˜¯å¯é‡å¤è¯»(Repeatable read)ï¼Œå®ƒå°†ä¸ä¼šå‡ºç°ä»¥ä¸Šä¸‰ç§é—®é¢˜ï¼›

å½“ç„¶ï¼Œè¿˜æœ‰æœ€åä¸€ä¸ªï¼š

### å¯ä¸²è¡ŒåŒ–(Serializable)

â€‹ è¿™ä¸ªç»§æ‰¿äº†å¯é‡å¤è¯»(Repeatable read)çš„ä¼˜è‰¯ä¼ ç»Ÿï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ–°çš„ç‰¹ç‚¹ï¼šåŠ é”ï¼š

â€‹ å¦‚æœè¯´ä»–å‘ç°æœ‰ä¸€å¼ è¡¨æ­£åœ¨è¢«æ“ä½œä¸”æ²¡æœ‰è¢«æäº¤`commit`ï¼Œå®ƒä¼šå¡åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œä¸ä¼šå¯¹è¡¨è¿›è¡Œä»»ä½•å®é™…æ“ä½œï¼Œéå¸¸ç¥å¥‡

å°†Bè¡¨éš”ç¦»çº§åˆ«è®¾å®šä¸ºå¯ä¸²è¡ŒåŒ–ï¼ŒAè¡¨ä¸å˜

```sql
# A & B
commit;

# B 
SET SESSION TRANSACTION isolation LEVEL Serializable;
+-------------------------+
| @@transaction_isolation |
+-------------------------+
| SERIALIZABLE            |
+-------------------------+

# A & B

start transaction;

```

A æ·»åŠ å†…å®¹

 ```sql
 insert into account values(5,'trray',600);
 update account set money = 400 where id = 1;
 ```

æ­¤æ—¶ ï¼ŒBæŸ¥è¯¢å†…å®¹

```
select * from account;
```

å¯ä»¥å‘ç°ï¼ŒBçš„ç»ˆç«¯å¡ä½äº†ï¼Œå¹¶ä¸”è¿‡äº†ä¸€ä¼šå„¿å¼¹å‡ºï¼š

`ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction`

é”å®šç­‰å¾…è¶…æ—¶;è¯•ç€é‡æ–°å¯åŠ¨äº‹åŠ¡ï¼›

ç„¶åæˆ‘å†æ¬¡è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶åœ¨10sååœ¨Aä¸­commit

```sql
# B 
select * from account;

# A ç­‰å¾…10ç§’
commit;

#B
+------+--------+-------+
| id   | name   | money |
+------+--------+-------+
|    1 | å¼ ä¸‰   |   400 |
|    2 | jock   |  1800 |
|    3 | scott  |   100 |
|    4 | milan  |   300 |
|    5 | trray  |   600 |
+------+--------+-------+
5 rows in set (9.44 sec)

```

å¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¹æ˜¯Aä¸€æäº¤ï¼ŒBå°±å‡ºäº†ç»“æœ

è¿™å°±æ˜¯å¯ä¸²è¡ŒåŒ–(Serializable)

## äº‹åŠ¡éš”ç¦»çº§åˆ«-æŒ‡ä»¤

1. æŸ¥çœ‹å½“å‰å›è¯éš”ç¦»çº§åˆ«ï¼š

   - Mysql5.7:
     - `select @@tx_isolation;`

   - Mysql 8+:
     1. `select @@transaction_isolation;`
     2. ``show variables like 'transaction_isolation';`

2. æŸ¥çœ‹ç³»ç»Ÿå½“å‰éš”ç¦»çº§åˆ«

   - Mysql5.7
     - `select @@global.tx_isolation;`
   - Mysql8+
     - `select @@global.transaction_isolation;`

3. è®¾ç½®å½“å‰å›è¯éš”ç¦»çº§åˆ«

   - `SET session transaction isolation LEVEL éš”ç¦»çº§åˆ«`
     - è¯»æœªæäº¤ï¼ˆ`Read uncommitted`ï¼‰
     - è¯»å·²æäº¤(`Read committed`)
     - å¯é‡å¤è¯»(`Repeatable read`)
     - å¯ä¸²è¡ŒåŒ–(`Serializable`)

4. è®¾ç½®ç³»ç»Ÿå½“å‰éš”ç¦»çº§åˆ«

   - `set global transaction isolation level éš”ç¦»çº§åˆ«`

   - ä¹Ÿå¯ä»¥åœ¨`my.ini`æˆ–è€…`my.cfg`ä¸­çš„[mysqld]åŠ ä¸Šå¹¶é‡å¯mysqlæ¥è®¾ç½®å…¨å±€é»˜è®¤éš”ç¦»çº§åˆ«

     ```ini
     [mysqld]
     ...å…¶ä»–å†…å®¹
     transaction-isolation = éš”ç¦»çº§åˆ«
     # æ³¨æ„ è¿™é‡Œçš„éš”ç¦»çº§åˆ«è¦é‡‡ç”¨å…¨å¤§å†™æ¨ªçº¿çš„å‘½åæ–¹å¼ï¼š
     # å¦‚ï¼š
     Read committed--->  READ-COMMITTED
     ```

     ```sh
     # å¹¶é‡å¯mysql
     
     # windows
     net restart mysql;
     
     # linux /ubuntu
     sudo service mysql restart;
     
     # docker 
     docker restart mysql;
     ```

5. Mysqlé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ `repatable read`ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæ²¡æœ‰å¿…è¦ä¿®æ”¹ï¼ˆå› ä¸ºè¯¥çº§åˆ«å¯ä»¥æ»¡è¶³ç»å¤§éƒ¨é—¨é¡¹ç›®è¦æ±‚ï¼‰

### äº‹åŠ¡çš„ACIDç‰¹æ€§

![image-20211123004055233](/images/JavaSE/21-MySql/image-20211123004055233.png)

# Mysqlè¡¨ç±»å‹å’Œå­˜å‚¨å¼•æ“

1. Mysqlçš„è¡¨ç±»å‹ç”±å­˜å‚¨å¼•æ“ï¼ˆStorage Enginesï¼‰å†³å®šï¼Œä¸»è¦åŒ…æ‹¬MyISAMã€innoDBã€Memoryç­‰
2. Mysqlæ•°æ®è¡¨ä¸»è¦æ”¯æŒå…­ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼šCSVã€Memoryã€ARCHIVEã€MRG_MYISAMã€MYISAMã€InnoDB
3. è¿™å…­ç§åˆ†ä¸ºä¸¤ç±»
   - äº‹åŠ¡å®‰å…¨å‹(transaction-safe)---æ”¯æŒäº‹åŠ¡
     - innoDB ç³»ç»Ÿé»˜è®¤æ˜¯è¿™ä¸ª
   - éäº‹ç‰©å®‰å…¨å‹ï¼ˆnon-transaction-safeï¼‰---ä¸æ”¯æŒäº‹åŠ¡
     - CSV
     - Memory
     - ARCHIVE
     - MRG_MYISAM
     - MYISAM

- æŸ¥çœ‹æ‰€æœ‰å¼•æ“ï¼š`show engines;`
  ![image-20211123121320164](/images/JavaSE/21-MySql/image-20211123121320164.png)

## å¼•æ“çš„é€‰æ‹©

ä¸€èˆ¬æƒ…å†µä¼šé€‰æ‹©çš„

![image-20211123121826094](/images/JavaSE/21-MySql/image-20211123121826094.png)

![image-20211123122055639](/images/JavaSE/21-MySql/image-20211123122055639.png)

![image-20211123122248185](/images/JavaSE/21-MySql/image-20211123122248185.png)

![image-20211123132241153](/images/JavaSE/21-MySql/image-20211123132241153.png)

## å¼•æ“ä½¿ç”¨

```sql
# é»˜è®¤å°±æ˜¯innodbï¼Œè¿™é‡Œä¸åšæ¼”ç¤º


# åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œå¼•æ“ä¸ºmyisam
create table test_engine01(
 id int,
    name varchar(32)
)ENGINE myisam;
-- æ·»åŠ é€Ÿåº¦å¿«ï¼Œä¸æ”¯æŒå¤–é”®å’Œäº‹åŠ¡ï¼Œæ”¯æŒè¡¨é”

# memoryå¼•æ“
create table test_engine01(
 id int,
    name varchar(32)
)ENGINE memory;
# æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆå…³é—­æˆ–é‡å¯mysqlä¼šå¯¼è‡´æ‰€æœ‰æ•°æ®ä¸¢å¤±ï¼‰
# æ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ï¼ˆæ²¡æœ‰ioè¯»å†™ï¼‰
# é»˜è®¤æ”¯æŒç´¢å¼•ï¼ˆhash tableï¼‰

```

## ä¿®æ”¹å­˜å‚¨å¼•æ“

è¯­æ³•ï¼š`alter table è¡¨å engine = å­˜å‚¨å¼•æ“`

```sql
# ä¿®æ”¹å‰å¾—ç¡®å®šè¡¨æ˜¯å¦ç¬¦åˆè¦è½¬åˆ°çš„å¼•æ“çš„è§„å®š
alter table emp engine = myisam;
```

# è§†å›¾(View)

- å…ˆçœ‹ä¸€ä¸ªéœ€æ±‚ï¼šempè¡¨çš„åˆ—(å­—æ®µ)ä¿¡æ¯å¾ˆå¤šï¼Œæœ‰äº›ä¿¡æ¯æ˜¯ä¸ªäººé‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚salã€commã€mgrã€hiredate
  ![image-20211123132622996](/images/JavaSE/21-MySql/image-20211123132622996.png)
- å¦‚æœæˆ‘ä»¬å¸Œæœ›**æŸä¸ªç”¨æˆ·åªèƒ½æŸ¥è¯¢**empè¡¨çš„ empnoã€ enameã€jobå’Œdeptnoä¿¡æ¯
- è¿™ä¸ªæ—¶å€™æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œä½†æ˜¯æœ€å¥½ç”¨çš„å¤§æ¦‚å°±æ˜¯è§†å›¾äº†

è§†å›¾çš„åŸºæœ¬æ¦‚å¿µï¼š

1. è§†å›¾æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ã€‚å…¶å†…å®¹ç”±æŸ¥è¯¢å®šä¹‰ã€‚å’ŒçœŸå®çš„è¡¨ä¸€æ ·ï¼Œè§†å›¾åŒ…å«åˆ—(å­—æ®µ)ï¼Œ**å…¶æ•°æ®æ¥æºå¯¹åº”çœŸå®çš„è¡¨**(åŸºè¡¨)
2. è§†å›¾å’ŒåŸºè¡¨çš„å…³ç³»ç¤ºæ„å›¾
   ![image-20211123133743001](/images/JavaSE/21-MySql/image-20211123133743001.png)

## è§†å›¾çš„åŸºæœ¬ä½¿ç”¨

1. åˆ›å»º`create view è§†å›¾å as selectè¯­å¥`
2. ä¿®æ”¹(æ›´æ–°è§†å›¾) `alter view è§†å›¾å as selectè¯­å¥`
3. æ˜¾ç¤ºè§†å›¾çš„ç»“æ„`show create view è§†å›¾å`
4. åˆ é™¤è§†å›¾ `drop view è§†å›¾å1,è§†å›¾å2...`

```sql
# è§†å›¾çš„å¢åˆ æ”¹æŸ¥
# åªæŸ¥è¯¢empè¡¨çš„ empnoã€ enameã€jobå’Œdeptnoä¿¡æ¯
# åˆ›å»º
create view emp_view01 as select empno, ename,job,deptno from emp;

# æŸ¥çœ‹ç»“æ„
desc emp_view01;
+--------+--------------------+------+-----+---------+-------+
| Field  | Type               | Null | Key | Default | Extra |
+--------+--------------------+------+-----+---------+-------+
| empno  | mediumint unsigned | NO   |     | 0       |       |
| ename  | varchar(20)        | NO   |     |         |       |
| job    | varchar(9)         | NO   |     |         |       |
| deptno | mediumint unsigned | NO   |     | 0       |       |
+--------+--------------------+------+-----+---------+-------+

# æŸ¥
select * from emp_view01 limit 5,5;
+--------+--------+----------+--------+
| empno  | ename  | job      | deptno |
+--------+--------+----------+--------+
| 100007 | ofLpoA | SALESMAN |    360 |
| 100008 | ZSoQnR | SALESMAN |    213 |
| 100009 | BwDASN | SALESMAN |    132 |
| 100010 | WWRuxd | SALESMAN |     15 |
| 100011 | RipbkV | SALESMAN |    488 |
+--------+--------+----------+--------+

# æŸ¥çœ‹åˆ›å»ºè§†å›¾æ—¶çš„æŒ‡ä»¤ï¼š
show create view emp_view01;

# åˆ é™¤è§†å›¾
drop view emp_view01;
```

## è§†å›¾çš„ä½¿ç”¨ç»†èŠ‚

![image-20211123135455381](/images/JavaSE/21-MySql/image-20211123135455381.png)

![image-20211123140408719](/images/JavaSE/21-MySql/image-20211123140408719.png)

```sql
# è§†å›¾1å·
desc emp_view01;
+--------+--------------------+------+-----+---------+-------+
| Field  | Type               | Null | Key | Default | Extra |
+--------+--------------------+------+-----+---------+-------+
| empno  | mediumint unsigned | NO   |     | 0       |       |
| ename  | varchar(20)        | NO   |     |         |       |
| job    | varchar(9)         | NO   |     |         |       |
| deptno | mediumint unsigned | NO   |     | 0       |       |
+--------+--------------------+------+-----+---------+-------+

# æŠŠä»–çš„empnoå’Œenameåšæˆæ–°çš„è§†å›¾
create view emp_view02 as select empno,ename from emp_view01;

select * from emp_view02 limit 5,5;
+--------+--------+
| empno  | ename  |
+--------+--------+
| 100007 | ofLpoA |
| 100008 | ZSoQnR |
| 100009 | BwDASN |
| 100010 | WWRuxd |
| 100011 | RipbkV |
+--------+--------+


# ä¿®æ”¹view02 å°±ç›¸å½“äºæ›´è¯¥åŸºè¡¨emp;

update  emp_view02 set ename ="å¼ ä¸‰" where empno=100007;

select * from emp_view02 where empno = 100007;
+--------+--------+
| empno  | ename  |
+--------+--------+
| 100007 | å¼ ä¸‰   |
+--------+--------+
select * from emp_view01 where empno = 100007;
+--------+--------+----------+--------+
| empno  | ename  | job      | deptno |
+--------+--------+----------+--------+
| 100007 | å¼ ä¸‰   | SALESMAN |    360 |
+--------+--------+----------+--------+
select * from emp where empno = 100007;
+--------+--------+----------+-----+------------+---------+--------+--------+
| empno  | ename  | job      | mgr | hiredate   | sal     | comm   | deptno |
+--------+--------+----------+-----+------------+---------+--------+--------+
| 100007 | å¼ ä¸‰   | SALESMAN |   1 | 2021-11-22 | 2000.00 | 400.00 |    360 |
+--------+--------+----------+-----+------------+---------+--------+--------+
```

# Mysqlç®¡ç†-ç”¨æˆ·ç®¡ç†

mysqlä¸­çš„ç”¨æˆ·ï¼Œéƒ½å­˜å‚¨åœ¨ç³»ç»Ÿæ•°æ®åº“mysqlä¸­çš„userè¡¨ä¸­

![image-20211123140910846](/images/JavaSE/21-MySql/image-20211123140910846.png)

å…¶ä¸­userè¡¨çš„é‡è¦å­—æ®µè¯´æ˜ï¼š

1. `host`ï¼š è¿è¡Œç™»é™†çš„ä½ç½®ï¼Œlocalhostè¡¨ç¤ºæœ¬æœºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šIpåœ°å€ï¼Œæ¯”å¦‚ï¼š172.17.0.1ï¼Œ115.15.15.15....
2. `user`ï¼šç”¨æˆ·å
3. `authentication_string`å¯†ç 
   - Mysql8å‰ï¼Œæ˜¯é€šè¿‡Mysqlçš„password()å‡½æ•°åŠ å¯†ä¹‹åçš„å¯†ç ï¼ˆmysql_native_passwordï¼‰
   - Mysql8åï¼Œå¯ä»¥é€šè¿‡caching_sha2_passwordåŠ å¯†å¯†ç 
     - å½“ç„¶ï¼Œé»˜è®¤è¿˜æ˜¯(mysql_native_password)åŠ å¯†å¯†ç 
   - å¯†ç å­—æ®µå·¦è¾¹ä¼šæ˜¾ç¤ºå¯†ç çš„åŠ å¯†æ–¹å¼
     ![image-20211123143351050](/images/JavaSE/21-MySql/image-20211123143351050.png)

## åˆ›å»ºã€åˆ é™¤ç”¨æˆ·

å¦‚æœåˆ›å»ºçš„æ—¶å€™æ²¡æœ‰æŒ‡å®šhostï¼Œåˆ™é»˜è®¤ä¸º%:åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ç™»é™†

`create user xxx`;

æŒ‡å®šhostï¼š`create user 'xxx'@xxx`

- hostæŒ‡å®šæ–¹å¼ï¼š
  - `%` :æ‰€æœ‰åœ°æ–¹
  - `127.0.0.5` ç‰¹å®šåœ°æ–¹
  - `192.168.1.%` 192.168.1ä¸‹çš„æ‰€æœ‰åœ°å€éƒ½å¯é“¾æ¥
  - `255.255.%.%` 255.255ä¸‹çš„æ‰€æœ‰åœ°å€éƒ½å¯è¿æ¥

åœ¨åˆ é™¤ç”¨æˆ·çš„æ—¶å€™ï¼Œå¦‚æœhostä¸æ˜¯%ï¼Œåˆ™å¿…é¡»è¦æ˜ç¡®æŒ‡å®š`ç”¨æˆ·å@ç™»å½•ä½ç½®`

`drop user jack` ç­‰ä»·äº`drop user 'jack'@'%'`

```sql
# åˆ›å»ºç”¨æˆ·

create user `ç”¨æˆ·å`@`å…è®¸ç™»é™†ä½ç½®` identified by 'å¯†ç ';

# åˆ›å»ºç”¨æˆ· åŒæ—¶æŒ‡å®šå¯†ç  æ³¨æ„ `` è¿™ä¸ªç»å¯¹ä¸èƒ½çœç•¥ ä½†æ˜¯å¯ä»¥æ›¿æ¢æˆ''
# å¹¶ä¸” ç”¨æˆ·å@å¯†ç  @å‰åä¸èƒ½æœ‰ç©ºæ ¼

create user 'mycom'@'localhost'  identified by '123456';


# åˆ é™¤ç”¨æˆ·
drop user `ç”¨æˆ·å`@`å…è®¸ç™»å½•ä½ç½®`;

# åˆ é™¤çš„æ—¶å€™åŠ ä¸åŠ å¼•å·éƒ½å¯ä»¥ ä½†æ˜¯å»ºè®®åŠ ä¸Š
drop user mycom@localhost;

```

ç™»é™†ï¼š

```shell
mysql -u mycom -p123456;
```

## ä¿®æ”¹å¯†ç 

Mysql5.7

```sql
use mysql;
# ä¿®æ”¹è‡ªå·±çš„å¯†ç 
set password = password('æ–°å¯†ç ')ï¼›

#ä¿®æ”¹ä»–äººçš„å¯†ç 
set password for 'ç”¨æˆ·å'@'ç™»å½•ä½ç½®' = password('æ–°å¯†ç ');

# ä¿®æ”¹å®Œå¯†ç åéœ€è¦åˆ·æ–°æƒé™
flush privileges;

```

Mysql8+

```sql
ALTER USER 'ç”¨æˆ·å'@'ç™»é™†ä½ç½®' IDENTIFIED WITH MYSQL_NATIVE_PASSWORD BY 'æ–°å¯†ç ';
# MYSQL_NATIVE_PASSWORD æ˜¯å¯†ç æ ¡éªŒè§„åˆ™ ä¸å¯çœç•¥
# å¯ä»¥æ›¿æ¢æˆ caching_sha2_password

# ä¾‹å¦‚ï¼š
alter user 'mycom'@'localhost' IDENTIFIED WITH caching_sha2_password BY '1234';

# ä¿®æ”¹å®Œå¯†ç åéœ€è¦åˆ·æ–°æƒé™
flush privileges;

```

## ç”¨æˆ·æƒé™

åœ¨ç™»é™†åˆ°mycomç”¨æˆ·åï¼ŒæŸ¥çœ‹æ•°æ®åº“ï¼Œå‘ç°äº†å¦‚ä¸‹ä¿¡æ¯

```sql
show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
+--------------------+
```

![image-20211123144656109](/images/JavaSE/21-MySql/image-20211123144656109.png)

Mysqlçš„æƒé™å¤§æ¦‚æœ‰è¿™äº›ï¼š

![image-20211123145819580](/images/JavaSE/21-MySql/image-20211123145819580.png)

### ç»™ç”¨æˆ·æˆæƒã€å›æ”¶æƒé™

#### æˆæƒ

è¯­æ³•ï¼š`grant  æƒé™å¯¹è±¡ on åº“.å¯¹è±¡å to 'ç”¨æˆ·å'@'ç™»å½•ä½ç½®'`

åœ¨mysql5.7ä¸­åœ¨æˆæƒæ—¶å¯ä»¥ä¿®æ”¹å¯†ç :

`grant  æƒé™å¯¹è±¡ on åº“.å¯¹è±¡å to 'ç”¨æˆ·å'@'ç™»å½•ä½ç½®' [identified by 'å¯†ç ']`

- identified byå¯ä»¥çœç•¥å°±æ˜¯ä¿®æ”¹ç”¨æˆ·å¯†ç 
  - å¦‚æœè¯¥ç”¨æˆ·å­˜åœ¨ï¼Œå°±ä¿®æ”¹ç”¨æˆ·çš„å¯†ç 
  - å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºè¯¥ç”¨æˆ·
- åœ¨mysql8ä¹‹å‰åº”è¯¥éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œmysql8åä¸å…è®¸è¿™æ ·ï¼Œæˆæƒï¼Œåˆ›å»ºç”¨æˆ·ï¼Œç»™ç”¨æˆ·ä¿®æ”¹å¯†ç æ˜¯ä¸‰æ¡£äº‹æƒ…

`æƒé™åˆ—è¡¨`ï¼Œå¤šä¸ªæƒé™ç”¨é€—å·åˆ†å¼€

```sql
grant select on ......
grant select,delete,create on ......

#èµ‹äºˆç”¨æˆ·åœ¨è¯¥å¯¹è±¡ä¸Šçš„æ‰€æœ‰æƒé™ï¼Œall privileges  å¿…é¡»ä¸€å—ä½¿ç”¨ ä¸èƒ½å•ç‹¬ all on æˆ–è€… privileges  on
grant all privileges  on ....
```

`åº“.å¯¹è±¡å`çš„ç‰¹åˆ«è¯´æ˜

- `*.*` ï¼šä»£è¡¨æœ¬ç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰å¯¹è±¡ï¼ˆè¡¨ï¼Œè§†å›¾ï¼Œå­˜å‚¨è¿‡ç¨‹ç­‰ï¼‰
- `åº“å.*` ï¼šè¡¨ç¤ºæŸä¸ªæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®å¯¹è±¡ï¼ˆè¡¨ï¼Œè§†å›¾ï¼Œå­˜å‚¨è¿‡ç¨‹ç­‰ï¼‰
- `åº“å.å¯¹è±¡å`: è¡¨ç¤ºæŸä¸ªæ•°æ®åº“ä¸­çš„å•ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡åå¯ä»¥æ˜¯è¡¨ï¼Œè§†å›¾ï¼Œå­˜å‚¨è¿‡ç¨‹ç­‰ ï¼Œä¸€èˆ¬éƒ½æ˜¯è¡¨å

æˆæƒå®Œæ¯•å¦‚æœæ²¡æœ‰ç”Ÿæ•ˆçš„è¯ï¼šåˆ·æ–°æƒé™`flush privileges;`

#### å›æ”¶æƒé™

åŸºæœ¬è¯­æ³•: `revoke æƒé™åˆ—è¡¨ on åº“.å¯¹è±¡å from 'ç”¨æˆ·å'@'ç™»å½•ä½ç½®'`

ä¹Ÿå¯ä»¥ï¼š`revoke all on åº“.å¯¹è±¡å from 'ç”¨æˆ·å'@'ç™»å½•ä½ç½®'` ç›´æ¥å›æ”¶æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æƒé™

æ’¤é”€æˆæƒåå¦‚æœæ²¡æœ‰ç”Ÿæ•ˆçš„è¯ï¼šåˆ·æ–°æƒé™`flush privileges;`

![image-20211123152210307](/images/JavaSE/21-MySql/image-20211123152210307.png)

```sql
# mysql8.0.1 ROOT USER
create user 'a'@'localhost'  identified by '123';
create database testdb;
use testdb;
create table news(
 id int primary key Auto_increment,
    author varchar(32),
    title varchar(50),
    body text
)Auto_increment=1001;

#æˆæƒ
grant insert,select,update,delete on testdb.news to 'a'@'localhost';

#ä¿®æ”¹å¯†ç 
ALTER USER 'a'@'localhost' IDENTIFIED WITH MYSQL_NATIVE_PASSWORD BY '12345';

```

ç„¶åç”¨æˆ·ç™»é™†

```shell
mysql -ua - p 12345;
```

è¿›å…¥åå¢åˆ æ”¹æŸ¥æ•°æ®

```sql
show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| testdb             |
+--------------------+
use testdb;

show tables;
+------------------+
| Tables_in_testdb |
+------------------+
| news             |
+------------------+

## æ·»åŠ æ•°æ®
insert into news(author,title,body) values
 ("å‘¨æ ‘äºº","ç‹‚äººæ—¥è®°","æŸå›æ˜†ä»²ï¼Œä»Šéšå…¶åï¼Œçš†ä½™æ˜”æ—¥åœ¨ä¸­å­¦æ—¶è‰¯å‹ï¼›åˆ†éš”å¤šå¹´ï¼Œæ¶ˆæ¯æ¸é˜™ã€‚æ—¥å‰å¶é—»å…¶ä¸€å¤§ç—…..."),
 ("é²è¿…","å½·å¾¨","å¯‚å¯æ–°æ–‡è‹‘ï¼Œå¹³å®‰æ—§æˆ˜åœºï¼Œä¸¤é—´ä½™ä¸€å’ï¼Œè·æˆŸç‹¬å½·å¾¨ã€‚");


# ä¿®æ”¹æ•°æ®
update news set body = "123" where author ="å‘¨æ ‘äºº";
update news set body = "456" where author ="é²è¿…";
select * from news;
+------+-----------+--------------+------+
| id   | author    | title        | body |
+------+-----------+--------------+------+
| 1001 | å‘¨æ ‘äºº    | ç‹‚äººæ—¥è®°     | 123  |
| 1002 | é²è¿…      | å½·å¾¨         | 456  |
+------+-----------+--------------+------+

# åˆ é™¤
delete from news where author ="å‘¨æ ‘äºº";
select * from news;
+------+--------+--------+------+
| id   | author | title  | body |
+------+--------+--------+------+
| 1002 | é²è¿…   | å½·å¾¨   | 456  |
+------+--------+--------+------+

# è§†å›¾åˆ›å»ºè¡¨
create table tt(id int);
#ERROR 1142 (42000): CREATE command denied to user 'a'@'localhost' for table 'tt'

# é€€å‡º
exit;
```

ä½¿ç”¨rootç”¨æˆ·åˆ é™¤è¯¥ç”¨æˆ·;

```sql
## ROOT 
# å…ˆå–æ¶ˆæˆæƒ
revoke all on testdb.news from 'a'@'localhost'ï¼›

# å†åˆ é™¤ç”¨æˆ·
drop user `a`@`localhost`;
```

è‡ªæ­¤ï¼ŒMysqlåˆçº§éƒ¨åˆ†å°±è¿‡å®Œäº†ï¼ŒMysqlå®é™…ä¸Šè¿˜æœ‰å¤æ‚çš„ä¸œè¥¿ï¼Œä»¥åæœ‰æœºä¼šçš„è¯å»äº†è§£ä¸‹;
